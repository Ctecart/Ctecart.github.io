System.register("chunks:///_virtual/BGMManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var o,t,e,u,n,a,r,s,l,c;return{setters:[function(i){o=i.applyDecoratedDescriptor,t=i.inheritsLoose,e=i.initializerDefineProperty,u=i.assertThisInitialized},function(i){n=i.cclegacy,a=i._decorator,r=i.AudioClip,s=i.AudioSource,l=i.tween,c=i.Component}],execute:function(){var d,h,p,f,m,S,g,b,v,y,M,w,B,D,P;n._RF.push({},"87aec0EdWVDn44cFPbeNL+m","BGMManager",void 0);var C=a.ccclass,G=a.property;i("BGMManager",(d=C("BGMManager"),h=G({type:r,tooltip:"背景音乐音频文件"}),p=G({range:[0,1,.1],tooltip:"音量 (0-1)"}),f=G({tooltip:"是否循环播放"}),m=G({tooltip:"场景开始时自动播放"}),S=G({tooltip:"淡入时长（秒）"}),g=G({tooltip:"淡出时长（秒）"}),d((y=o((v=function(i){function o(){for(var o,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return o=i.call.apply(i,[this].concat(n))||this,e(o,"bgmClip",y,u(o)),e(o,"volume",M,u(o)),e(o,"loop",w,u(o)),e(o,"playOnStart",B,u(o)),e(o,"fadeInDuration",D,u(o)),e(o,"fadeOutDuration",P,u(o)),o.audioSource=null,o.fadeTween=null,o.isPaused=!1,o}t(o,i);var n=o.prototype;return n.onLoad=function(){this.audioSource=this.node.getComponent(s),this.audioSource||(this.audioSource=this.node.addComponent(s)),this.bgmClip&&(this.audioSource.clip=this.bgmClip),this.audioSource.loop=this.loop,this.audioSource.volume=0},n.start=function(){this.playOnStart&&this.bgmClip&&this.play()},n.onDestroy=function(){this.stopFade(),this.stop()},n.play=function(){this.audioSource&&this.bgmClip?(this.audioSource.clip=this.bgmClip,this.audioSource.loop=this.loop,this.audioSource.volume=0,this.audioSource.play(),this.isPaused=!1,this.fadeIn(),console.log("[BGM] 开始播放")):console.warn("[BGM] 未设置音频文件")},n.stop=function(){var i=this;this.audioSource&&this.fadeOut((function(){i.audioSource.stop(),console.log("[BGM] 停止播放")}))},n.stopImmediate=function(){this.stopFade(),this.audioSource&&this.audioSource.stop()},n.pause=function(){this.audioSource&&!this.isPaused&&(this.audioSource.pause(),this.isPaused=!0,console.log("[BGM] 暂停"))},n.resume=function(){this.audioSource&&this.isPaused&&(this.audioSource.play(),this.isPaused=!1,console.log("[BGM] 恢复播放"))},n.toggle=function(){this.isPaused?this.resume():this.pause()},n.setVolume=function(i){this.volume=Math.max(0,Math.min(1,i)),this.audioSource&&(this.audioSource.volume=this.volume)},n.getVolume=function(){return this.audioSource?this.audioSource.volume:this.volume},n.mute=function(i){this.audioSource&&(this.audioSource.volume=i?0:this.volume)},n.fadeIn=function(){this.stopFade(),this.fadeInDuration<=0?this.audioSource.volume=this.volume:this.fadeTween=l(this.audioSource).to(this.fadeInDuration,{volume:this.volume},{easing:"sineOut"}).start()},n.fadeOut=function(i){if(this.stopFade(),this.fadeOutDuration<=0)return this.audioSource.volume=0,void(null==i||i());this.fadeTween=l(this.audioSource).to(this.fadeOutDuration,{volume:0},{easing:"sineIn"}).call((function(){null==i||i()})).start()},n.stopFade=function(){this.fadeTween&&(this.fadeTween.stop(),this.fadeTween=null)},n.changeBGM=function(i){var o=this;i?this.fadeOut((function(){o.audioSource.stop(),o.bgmClip=i,o.audioSource.clip=i,o.audioSource.volume=0,o.audioSource.play(),o.fadeIn(),console.log("[BGM] 切换音乐")})):console.warn("[BGM] 新音频文件为空")},n.isPlaying=function(){return!!this.audioSource&&this.audioSource.playing},n.getIsPaused=function(){return this.isPaused},o}(c)).prototype,"bgmClip",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=o(v.prototype,"volume",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),w=o(v.prototype,"loop",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),B=o(v.prototype,"playOnStart",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D=o(v.prototype,"fadeInDuration",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),P=o(v.prototype,"fadeOutDuration",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),b=v))||b));n._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,a,o,r,s,c,u,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,s=t.Node,c=t.tween,u=t.Vec3,l=t.UIOpacity,h=t.Component}],execute:function(){var p,f,d,m,y,b,v;o._RF.push({},"fd0daWSVDREuaDo3PMUjNuH","CharacterAnimation",void 0);var g=r.ccclass,w=r.property;t("CharacterAnimation",(p=g("CharacterAnimation"),f=w(s),d=w(s),p((b=e((y=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,i(e,"huangNode",b,a(e)),i(e,"liRouNode",v,a(e)),e.initialPositions=new Map,e}n(e,t);var o=e.prototype;return o.start=function(){this.initialPositions.set("黄超雄",this.huangNode.position.clone()),this.initialPositions.set("李柔",this.liRouNode.position.clone()),this.liRouNode.setPosition(0,1762)},o.playAnimation=function(t,e,n){void 0===n&&(n=.5);var i=this.getCharacterNode(t);i&&(Array.isArray(e)?this.playComboAnimation(i,t,e,n):this.playSingleAnimation(i,t,e,n))},o.playComboAnimation=function(t,e,n,i){var a=this,o=c(t),r=[],s=[];n.forEach((function(t){"fadeIn"===t||"fadeOut"===t?r.push(t):s.push(t)}));var l={};s.forEach((function(t){switch(t){case"moveIn":var n=a.initialPositions.get(e);n&&(l.position=n);break;case"scaleUp":l.scale=new u(1.5,1.5,1);break;case"scaleDown":l.scale=new u(1.2,1.2,1);break;case"rotate":l.angle=360}})),Object.keys(l).length>0&&o.to(i,l).start(),r.forEach((function(e){"fadeIn"===e?a.fadeIn(t,i):"fadeOut"===e&&a.fadeOut(t,i)}))},o.playSingleAnimation=function(t,e,n,i){switch(n){case"fadeIn":this.fadeIn(t,i);break;case"fadeOut":this.fadeOut(t,i);break;case"moveIn":this.moveIn(t,e,i);break;case"shake":this.shake(t,i);break;case"jump":this.jump(t,i);break;case"scaleUp":this.scale(t,new u(1,1,1),i);break;case"scaleDown":this.scale(t,new u(1.2,1.2,1),i)}},o.getCharacterNode=function(t){switch(t){case"黄超雄":return this.huangNode;case"李柔":return this.liRouNode;default:return null}},o.fadeIn=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),n.opacity=0,c(n).to(e,{opacity:255}).start()},o.fadeOut=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),c(n).to(e,{opacity:0}).start()},o.moveIn=function(t,e,n){var i=this.initialPositions.get(e);i&&c(t).to(n,{position:i}).start()},o.shake=function(t,e){for(var n=t.position.clone(),i=c(t),a=0;a<5;a++){var o=10*(Math.random()-.5),r=10*(Math.random()-.5);i=i.to(e/5,{position:new u(n.x+o,n.y+r,0)})}i.to(.1,{position:n}).start()},o.jump=function(t,e){c(t).by(e/2,{position:new u(0,50,0)}).by(e/2,{position:new u(0,-50,0)}).start()},o.scale=function(t,e,n){c(t).to(n,{scale:e}).start()},e}(h)).prototype,"huangNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"liRouNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=y))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueData.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"8db46z9IL9AHbbihU0woZPn","DialogueData",void 0);e("DialogueData",function(){function e(){}return e.getDialogues=function(e){switch(e){case"npc_lirou":return this.getLiRouDialogues();case"main":default:return this.getLiRouDialogues()}},e.getLiRouDialogues=function(){return[{id:"start",speaker:"李柔",text:"你要去哪？"},{id:"choice1",type:"choice",choices:[{text:"「出去走走。」",nextId:"hint1"},{text:"「不关你的事。」",nextId:"choice1_b"},{text:"（沉默）",nextId:"hint1"}]},{id:"hint1",type:"narration",text:"提示：李柔已经看见了你背着的包。"},{id:"lirou_notice",speaker:"李柔",text:"你收拾东西了。"},{speaker:"李柔",text:"你是不是想着去复仇？"},{type:"narration",text:"你没有否认。"},{id:"you_letgo",speaker:"黄超雄",text:"让开。"},{id:"lirou_warn",speaker:"李柔",text:"你知道你这样做就回不去了吗？"},{type:"narration",text:"他一步挡在你面前。"},{type:"narration",text:"那一刻，我第一次在他脸上看到害怕的神情。",highlight:!0},{speaker:"李柔",text:"黄超雄。"},{speaker:"李柔",text:"你爸妈的事，我知道你难受。"},{speaker:"李柔",text:"可你不能这样。"},{speaker:"李柔",text:"…法律会替你审判他的！",highlight:!0},{id:"choice2",type:"choice",choices:[{text:"「你根本不懂。」",nextId:"you_angry"},{text:"「你走开！」",nextId:"you_angry"},{text:"「法律有用？」",nextId:"you_angry"}]},{id:"you_angry",type:"narration",image:"image2"},{speaker:"黄超雄",text:"他是精神病！"},{speaker:"黄超雄",text:"杀了我爸妈，坐牢都不用坐！",highlight:!0},{speaker:"黄超雄",text:"你让我怎么咽得下这口气？",highlight:!0},{type:"narration",text:"你的声音越来越大。"},{id:"lirou_close",type:"narration",image:"image3"},{speaker:"李柔",text:"那你就要拿自己未来去换吗？！"},{speaker:"李柔",text:"你一走，这辈子就完了！"},{id:"choice3",type:"choice",choices:[{text:"「完了就完了。」",nextId:"you_cold"},{text:"「你给我滚远点。」",nextId:"choice3_b"},{text:"「如果是你家人，你还能这么冷静吗？」",nextId:"you_cold"}]},{id:"choice3_b",type:"narration",text:"李柔明显被刺痛。"},{speaker:"李柔",text:"你什么意思？"},{speaker:"李柔",text:"我只是不想让你后悔！"},{type:"narration",text:"他第一次语气失控。"},{id:"you_cold",speaker:"黄超雄",text:"你什么也不懂。"},{speaker:"黄超雄",text:"事情没发生在你身上，你只是站着说话不腰疼而已。"},{speaker:"李柔",text:"所以你就选择堕落下去？"},{speaker:"李柔",text:"也许，我看错你了。",highlight:!0},{speaker:"黄超雄",text:"这是我的事。"},{speaker:"黄超雄",text:"别管我。"},{id:"choice4",type:"choice",choices:[{text:"「让开。」",nextId:"ending"},{text:"「别再来找我。」",nextId:"ending"},{text:"「我们已经不是一路人了。」",nextId:"ending"}]},{id:"ending",type:"narration",image:"image4"},{type:"narration",text:"我背着包，从他身边走过去。"},{type:"narration",text:"他没有拦我。"},{type:"narration",text:"也没有再叫我的名字。"}]},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueData.ts","./CharacterAnimation.ts"],(function(i){var e,t,n,a,o,r,s,h,l,u,c,g,d,f,p,v,C,m,b,I,y;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,n=i.initializerDefineProperty,a=i.assertThisInitialized},function(i){o=i.cclegacy,r=i._decorator,s=i.Node,h=i.Label,l=i.RichText,u=i.SpriteFrame,c=i.Sprite,g=i.Prefab,d=i.UIOpacity,f=i.tween,p=i.instantiate,v=i.UITransform,C=i.Color,m=i.Button,b=i.Component},function(i){I=i.DialogueData},function(i){y=i.CharacterAnimation}],execute:function(){var x,w,D,k,A,T,E,U,N,S,B,z,R,O,L,M,P,_,H,F,j,K,Q,V,W,Y,q,G,J,X,Z,$,ii,ei,ti;o._RF.push({},"6de0bjbfp1N05Yh6Qf54/OA","DialogueManager",void 0);var ni=r.ccclass,ai=r.property;i("DialogueManager",(x=ni("DialogueManager"),w=ai(s),D=ai(h),k=ai(l),A=ai(s),T=ai(s),E=ai(s),U=ai(u),N=ai(u),S=ai(u),B=ai(u),z=ai(s),R=ai(c),O=ai({type:[u],tooltip:"插图列表"}),L=ai(s),M=ai(g),P=ai(y),x((F=e((H=function(i){function e(){for(var e,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return e=i.call.apply(i,[this].concat(o))||this,n(e,"dialogueUI",F,a(e)),n(e,"speakerLabel",j,a(e)),n(e,"contentRichText",K,a(e)),n(e,"speakerAvatar",Q,a(e)),n(e,"background",V,a(e)),n(e,"dialogueNextButton",W,a(e)),n(e,"huangAvatar",Y,a(e)),n(e,"liRouAvatar",q,a(e)),n(e,"custumerAvatar",G,a(e)),n(e,"youAvatar",J,a(e)),n(e,"imageContainer",X,a(e)),n(e,"imageDisplay",Z,a(e)),n(e,"images",$,a(e)),n(e,"choiceContainer",ii,a(e)),n(e,"choiceButtonPrefab",ei,a(e)),n(e,"animationManager",ti,a(e)),e.currentIndex=0,e.dialogues=[],e.dialogueMap=new Map,e.isTyping=!1,e.typingScheduleId=null,e.canProceed=!1,e.isDialogueActive=!1,e.onDialogueEndCallback=null,e.isClickCooldown=!1,e.isShowingChoice=!1,e}t(e,i);var o=e.prototype;return o.start=function(){this.hideAll()},o.onDestroy=function(){this.unscheduleAllCallbacks(),this.removeClickListener()},o.hideAll=function(){this.dialogueUI&&(this.dialogueUI.active=!1),this.dialogueNextButton&&(this.dialogueNextButton.active=!1),this.imageContainer&&(this.imageContainer.active=!1),this.choiceContainer&&(this.choiceContainer.active=!1)},o.startDialogue=function(i,e){if(this.isDialogueActive)console.warn("[Dialogue] 对话已在进行中");else{if(this.isDialogueActive=!0,this.onDialogueEndCallback=e,this.isShowingChoice=!1,this.dialogues=I.getDialogues(i),0===this.dialogues.length)return console.warn("[Dialogue] 没有对话数据"),void this.endDialogue();this.buildDialogueMap(),this.currentIndex=0,this.addClickListener(),this.showCurrentEntry(),console.log("[Dialogue] 对话开始")}},o.buildDialogueMap=function(){this.dialogueMap.clear();for(var i=0;i<this.dialogues.length;i++){var e=this.dialogues[i];e.id&&this.dialogueMap.set(e.id,i)}},o.getIsDialogueActive=function(){return this.isDialogueActive},o.forceEndDialogue=function(){this.isDialogueActive&&this.endDialogue()},o.addClickListener=function(){this.background&&this.background.on(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.on(s.EventType.TOUCH_END,this.onNextClick,this),this.imageContainer&&this.imageContainer.on(s.EventType.TOUCH_END,this.onNextClick,this)},o.removeClickListener=function(){this.background&&this.background.off(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.off(s.EventType.TOUCH_END,this.onNextClick,this),this.imageContainer&&this.imageContainer.off(s.EventType.TOUCH_END,this.onNextClick,this)},o.onNextClick=function(){var i=this;!this.isDialogueActive||this.isClickCooldown||this.isShowingChoice||(this.isClickCooldown=!0,this.scheduleOnce((function(){i.isClickCooldown=!1}),.2),this.isTyping?(this.unschedule(this.typingScheduleId),this.showFullText(),this.isTyping=!1,this.canProceed=!1,this.scheduleOnce((function(){i.canProceed=!0,i.showDialogueNextButton()}),.1)):this.canProceed&&(this.canProceed=!1,this.goToNextEntry()))},o.fadeOutDialogueUIThen=function(i){var e=this;if(this.dialogueUI&&this.dialogueUI.active){var t=this.dialogueUI.getComponent(d);t?f(t).to(.2,{opacity:0}).call((function(){e.dialogueUI.active=!1,e.contentRichText.string="",e.speakerLabel.string="",i()})).start():(this.dialogueUI.active=!1,this.contentRichText.string="",this.speakerLabel.string="",i())}else i()},o.showCurrentEntry=function(){var i=this;if(this.currentIndex>=this.dialogues.length)this.endDialogue();else{var e=this.dialogues[this.currentIndex],t=e.type||"dialogue";switch(this.hideDialogueNextButton(),t){case"choice":this.fadeOutDialogueUIThen((function(){i.hideImage(),i.showChoices(e.choices)}));break;case"narration":this.hideChoices(),e.image?this.fadeOutDialogueUIThen((function(){i.showImage(e.image,e.text)})):(this.hideImage(),this.showNarration(e.text,e.highlight));break;case"dialogue":default:this.hideChoices(),e.image?this.fadeOutDialogueUIThen((function(){i.showImage(e.image,e.text)})):(this.hideImage(),this.showDialogue(e))}e.animation&&this.animationManager&&this.animationManager.playAnimation(e.animation.character,e.animation.action,e.animation.duration)}},o.goToNextEntry=function(){var i=this.dialogues[this.currentIndex];if(i.nextId){var e=this.dialogueMap.get(i.nextId);void 0!==e?this.currentIndex=e:this.currentIndex++}else this.currentIndex++;this.showCurrentEntry()},o.showDialogue=function(i){var e=this;this.dialogueUI&&(this.speakerLabel.string=i.speaker||"",this.speakerAvatar&&(this.speakerAvatar.active=!0,this.updateSpeakerAvatar(i.speaker)),this.dialogueUI.active?this.typewriterEffect(i.text,i.highlight):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){e.typewriterEffect(i.text,i.highlight)}))))},o.showNarration=function(i,e){var t=this;this.dialogueUI&&(this.speakerLabel.string="",this.speakerAvatar&&(this.speakerAvatar.active=!1),this.dialogueUI.active?this.typewriterEffect(i,e):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){t.typewriterEffect(i,e)}))))},o.hideDialogueUI=function(){if(this.dialogueUI){this.dialogueUI.active=!1,this.contentRichText.string="",this.speakerLabel.string="";var i=this.dialogueUI.getComponent(d);i&&(i.opacity=255)}},o.updateSpeakerAvatar=function(i){var e,t=null==(e=this.speakerAvatar)?void 0:e.getComponent(c);if(t)switch(i){case"黄超雄":t.spriteFrame=this.huangAvatar;break;case"李柔":t.spriteFrame=this.liRouAvatar;break;case"你":t.spriteFrame=this.youAvatar||this.huangAvatar;break;default:t.spriteFrame=this.custumerAvatar}},o.showImage=function(i,e){var t=this;if(this.imageContainer&&this.imageDisplay){var n=this.getImageIndex(i);n>=0&&n<this.images.length&&(this.imageDisplay.spriteFrame=this.images[n]),this.imageContainer.active=!0,this.fadeIn(this.imageContainer,(function(){t.canProceed=!0,t.showDialogueNextButton()}))}},o.getImageIndex=function(i){var e=i.match(/image(\d+)/);return e?parseInt(e[1])-1:-1},o.hideImage=function(){this.imageContainer&&(this.imageContainer.active=!1)},o.showChoices=function(i){var e=this;this.choiceContainer&&i&&0!==i.length&&(this.isShowingChoice=!0,this.choiceContainer.removeAllChildren(),i.forEach((function(i,t){e.createChoiceButton(i,t)})),this.choiceContainer.active=!0,this.fadeIn(this.choiceContainer))},o.createChoiceButton=function(i,e){var t,n=this;if((t=this.choiceButtonPrefab?p(this.choiceButtonPrefab):this.createDefaultButton(i.text,e)).parent=this.choiceContainer,this.choiceButtonPrefab){var a=t.getComponentInChildren(h);a&&(a.string=i.text)}t.on(s.EventType.TOUCH_END,(function(){n.onChoiceSelected(i)}),this)},o.createDefaultButton=function(i,e){var t=new s("Choice_"+e);t.addComponent(v).setContentSize(500,60),t.addComponent(c).color=new C(50,50,50,200);var n=t.addComponent(m);n.transition=m.Transition.SCALE,n.zoomScale=.95;var a=new s("Label");a.parent=t,a.addComponent(v).setContentSize(480,50);var o=a.addComponent(h);return o.string=i,o.fontSize=28,o.color=C.WHITE,o.horizontalAlign=h.HorizontalAlign.CENTER,o.verticalAlign=h.VerticalAlign.CENTER,o.overflow=h.Overflow.SHRINK,t},o.onChoiceSelected=function(i){if(console.log("[Dialogue] 选择: "+i.text),this.isShowingChoice=!1,this.hideChoices(),i.nextId){var e=this.dialogueMap.get(i.nextId);if(void 0!==e)return this.currentIndex=e,void this.showCurrentEntry()}this.currentIndex++,this.showCurrentEntry()},o.hideChoices=function(){this.choiceContainer&&(this.choiceContainer.active=!1,this.choiceContainer.removeAllChildren()),this.isShowingChoice=!1},o.typewriterEffect=function(i,e){var t=this;this.typingScheduleId&&this.unschedule(this.typingScheduleId),this.isTyping=!0,this.canProceed=!1,this.contentRichText.string="";var n=e?"<b>"+i+"</b>":i,a=0,o=function i(){if(a<n.length){if("<"===n[a]){var e=n.indexOf(">",a);if(-1!==e)return t.contentRichText.string+=n.substring(a,e+1),void(a=e+1)}t.contentRichText.string+=n[a],a++}else t.isTyping=!1,t.unschedule(i),t.scheduleOnce((function(){t.canProceed=!0,t.showDialogueNextButton()}),.1)};this.typingScheduleId=o,this.schedule(o,.05)},o.showFullText=function(){var i=this.dialogues[this.currentIndex];if(i&&i.text){var e=i.highlight?"<b>"+i.text+"</b>":i.text;this.contentRichText.string=e}},o.showDialogueNextButton=function(){this.dialogueNextButton&&!this.isShowingChoice&&(this.dialogueNextButton.active=!0)},o.hideDialogueNextButton=function(){this.dialogueNextButton&&(this.dialogueNextButton.active=!1)},o.fadeIn=function(i,e){var t=i.getComponent(d);t||(t=i.addComponent(d)),t.opacity=0,i.active=!0,f(t).to(.3,{opacity:255}).call((function(){null==e||e()})).start()},o.endDialogue=function(){console.log("[Dialogue] 对话结束"),this.isDialogueActive=!1,this.isShowingChoice=!1,this.removeClickListener(),this.hideAll(),this.onDialogueEndCallback&&(this.onDialogueEndCallback(),this.onDialogueEndCallback=null)},e}(b)).prototype,"dialogueUI",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(H.prototype,"speakerLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(H.prototype,"contentRichText",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(H.prototype,"speakerAvatar",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(H.prototype,"background",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(H.prototype,"dialogueNextButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(H.prototype,"huangAvatar",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(H.prototype,"liRouAvatar",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(H.prototype,"custumerAvatar",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(H.prototype,"youAvatar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(H.prototype,"imageContainer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(H.prototype,"imageDisplay",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(H.prototype,"images",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ii=e(H.prototype,"choiceContainer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ei=e(H.prototype,"choiceButtonPrefab",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ti=e(H.prototype,"animationManager",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=H))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BGMManager.ts","./CharacterAnimation.ts","./DialogueData.ts","./DialogueManager.ts","./StartSceneController.ts","./StreetWalkController.ts","./WalkAnimationController.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/StartSceneController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,i,o,r,a,l,u,s,c,p,g,f;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.Node,u=t.SpriteFrame,s=t.Sprite,c=t.director,p=t.UIOpacity,g=t.tween,f=t.Component}],execute:function(){var b,h,d,y,S,m,T,B,C,D,v,O,w,z,N,F,k,I,E,_,U,q,H,P,A,L,R,j,x;r._RF.push({},"37f86XY1CdPc7AI/iaQNB72","StartSceneController",void 0);var M=a.ccclass,Q=a.property;t("StartSceneController",(b=M("StartSceneController"),h=Q(l),d=Q(l),y=Q(l),S=Q(u),m=Q(u),T=Q(l),B=Q({tooltip:"标题淡入延迟（秒）"}),C=Q({tooltip:"标题淡入时长（秒）"}),D=Q({tooltip:"开始按钮淡入延迟（秒）"}),v=Q({tooltip:"开始按钮淡入时长（秒）"}),O=Q({tooltip:"背景切换时长（秒）"}),w=Q({tooltip:"切换场景前等待时间（秒）"}),z=Q({tooltip:"目标场景名称"}),b((k=n((F=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return n=t.call.apply(t,[this].concat(r))||this,i(n,"background",k,o(n)),i(n,"title",I,o(n)),i(n,"startButton",E,o(n)),i(n,"bgStart",_,o(n)),i(n,"bgTransition",U,o(n)),i(n,"bgTransitionNode",q,o(n)),i(n,"titleDelay",H,o(n)),i(n,"titleFadeDuration",P,o(n)),i(n,"startButtonDelay",A,o(n)),i(n,"startButtonFadeDuration",L,o(n)),i(n,"bgTransitionDuration",R,o(n)),i(n,"sceneChangeDelay",j,o(n)),i(n,"targetSceneName",x,o(n)),n.isTransitioning=!1,n}e(n,t);var r=n.prototype;return r.start=function(){this.initUI(),this.playOpeningSequence()},r.initUI=function(){if(this.background&&this.bgStart){var t=this.background.getComponent(s);t&&(t.spriteFrame=this.bgStart)}if(this.title&&this.setOpacity(this.title,0),this.startButton&&this.setOpacity(this.startButton,0),this.bgTransitionNode&&(this.setOpacity(this.bgTransitionNode,0),this.bgTransition)){var n=this.bgTransitionNode.getComponent(s);n&&(n.spriteFrame=this.bgTransition)}},r.playOpeningSequence=function(){var t=this;this.scheduleOnce((function(){t.fadeIn(t.title,t.titleFadeDuration,(function(){console.log("[Start] 标题显示完成")}))}),this.titleDelay),this.scheduleOnce((function(){t.fadeIn(t.startButton,t.startButtonFadeDuration,(function(){console.log("[Start] 开始按钮显示完成"),t.bindStartButtonEvent()}))}),this.startButtonDelay)},r.bindStartButtonEvent=function(){this.startButton&&this.startButton.on(l.EventType.TOUCH_END,this.onStartButtonClick,this)},r.onStartButtonClick=function(){this.isTransitioning||(this.isTransitioning=!0,console.log("[Start] 点击开始游戏"),this.startButton.off(l.EventType.TOUCH_END,this.onStartButtonClick,this),this.playTransitionSequence())},r.playTransitionSequence=function(){var t=this;this.fadeOut(this.title,2),this.fadeOut(this.startButton,2),this.crossFadeBackground((function(){t.scheduleOnce((function(){t.loadTargetScene()}),t.sceneChangeDelay)}))},r.crossFadeBackground=function(t){if(this.bgTransitionNode)this.fadeIn(this.bgTransitionNode,this.bgTransitionDuration,(function(){console.log("[Start] 背景切换完成"),null==t||t()}));else{if(this.background&&this.bgTransition){var n=this.background.getComponent(s);n&&(n.spriteFrame=this.bgTransition)}null==t||t()}},r.loadTargetScene=function(){console.log("[Start] 切换到场景: "+this.targetSceneName),c.loadScene(this.targetSceneName)},r.setOpacity=function(t,n){if(t){var e=t.getComponent(p);e||(e=t.addComponent(p)),e.opacity=n}},r.fadeIn=function(t,n,e){if(t){var i=t.getComponent(p);i||(i=t.addComponent(p)),i.opacity=0,g(i).to(n,{opacity:255},{easing:"sineOut"}).call((function(){null==e||e()})).start()}else null==e||e()},r.fadeOut=function(t,n,e){if(t){var i=t.getComponent(p);i||((i=t.addComponent(p)).opacity=255),g(i).to(n,{opacity:0},{easing:"sineIn"}).call((function(){null==e||e()})).start()}else null==e||e()},n}(f)).prototype,"background",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(F.prototype,"title",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(F.prototype,"startButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(F.prototype,"bgStart",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(F.prototype,"bgTransition",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(F.prototype,"bgTransitionNode",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(F.prototype,"titleDelay",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),P=n(F.prototype,"titleFadeDuration",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),A=n(F.prototype,"startButtonDelay",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),L=n(F.prototype,"startButtonFadeDuration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),R=n(F.prototype,"bgTransitionDuration",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),j=n(F.prototype,"sceneChangeDelay",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),x=n(F.prototype,"targetSceneName",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Scene1"}}),N=F))||N));r._RF.pop()}}}));

System.register("chunks:///_virtual/StreetWalkController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueManager.ts","./WalkAnimationController.ts"],(function(i){var t,e,n,a,c,r,o,l,s,h,p,u,g,f,d,b,m,N;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,a=i.assertThisInitialized},function(i){c=i.cclegacy,r=i._decorator,o=i.Node,l=i.SpriteFrame,s=i.UITransform,h=i.Sprite,p=i.UIOpacity,u=i.Graphics,g=i.Color,f=i.Vec3,d=i.tween,b=i.Component},function(i){m=i.DialogueManager},function(i){N=i.WalkAnimationController}],execute:function(){var w,S,I,y,C,v,k,H,T,A,F,M,D,x,z,B,P,R,O,G,W,E,U,_,X,Y,L,Z,j,K,V,q,J,Q,$,ii,ti,ei,ni,ai,ci,ri,oi,li,si,hi,pi,ui,gi,fi,di,bi,mi,Ni,wi,Si,Ii;c._RF.push({},"2ae864vzZBC273s6gaj29ll","StreetWalkController",void 0);var yi=r.ccclass,Ci=r.property;i("StreetWalkController",(w=yi("StreetWalkController"),S=Ci(o),I=Ci(o),y=Ci(o),C=Ci({type:l,tooltip:"NPC 默认图像"}),v=Ci({type:l,tooltip:"NPC 高亮图像"}),k=Ci({tooltip:"NPC 碰撞范围宽度"}),H=Ci({tooltip:"NPC 碰撞范围高度"}),T=Ci({tooltip:"NPC 碰撞范围 X 偏移"}),A=Ci({tooltip:"NPC 碰撞范围 Y 偏移"}),F=Ci({tooltip:"对话距离（玩家与NPC的间隔）"}),M=Ci({tooltip:"是否绘制 NPC 碰撞范围（调试用）"}),D=Ci({type:l,tooltip:"点击反馈圆圈图片"}),x=Ci({tooltip:"圆圈显示时长（秒）"}),z=Ci({tooltip:"圆圈初始大小"}),B=Ci({tooltip:"左边界"}),P=Ci({tooltip:"右边界"}),R=Ci({tooltip:"上边界（远处）"}),O=Ci({tooltip:"下边界（近处）"}),G=Ci({tooltip:"最远处（top）的缩放乘数"}),W=Ci({tooltip:"最近处（bottom）的缩放乘数"}),E=Ci({tooltip:"移动速度（像素/秒）"}),U=Ci({tooltip:"是否根据移动方向翻转角色"}),_=Ci({tooltip:"翻转动画时长（秒）"}),X=Ci({tooltip:"NPC 翻转动画时长（秒）"}),Y=Ci({tooltip:"是否绘制可行走区域边框"}),L=Ci(m),Z=Ci(N),w((V=t((K=function(i){function t(){for(var t,e=arguments.length,c=new Array(e),r=0;r<e;r++)c[r]=arguments[r];return t=i.call.apply(i,[this].concat(c))||this,n(t,"character",V,a(t)),n(t,"npc",q,a(t)),n(t,"touchArea",J,a(t)),n(t,"npcNormalSprite",Q,a(t)),n(t,"npcHighlightSprite",$,a(t)),n(t,"npcHitWidth",ii,a(t)),n(t,"npcHitHeight",ti,a(t)),n(t,"npcHitOffsetX",ei,a(t)),n(t,"npcHitOffsetY",ni,a(t)),n(t,"dialogueDistance",ai,a(t)),n(t,"debugDrawNpcHitArea",ci,a(t)),n(t,"clickIndicatorSprite",ri,a(t)),n(t,"clickIndicatorDuration",oi,a(t)),n(t,"clickIndicatorScale",li,a(t)),n(t,"leftBound",si,a(t)),n(t,"rightBound",hi,a(t)),n(t,"topBound",pi,a(t)),n(t,"bottomBound",ui,a(t)),n(t,"minScaleMultiplier",gi,a(t)),n(t,"maxScaleMultiplier",fi,a(t)),n(t,"moveSpeed",di,a(t)),n(t,"flipOnMove",bi,a(t)),n(t,"flipDuration",mi,a(t)),n(t,"npcFlipDuration",Ni,a(t)),n(t,"debugDraw",wi,a(t)),n(t,"dialogueManager",Si,a(t)),n(t,"walkAnimation",Ii,a(t)),t.currentTween=null,t.flipTween=null,t.npcFlipTween=null,t.isMoving=!1,t.isFlipping=!1,t.isNpcFlipping=!1,t.isFacingRight=!0,t.isNpcFacingRight=!1,t.characterInitialScale=new f(1,1,1),t.npcInitialScale=new f(1,1,1),t.clickIndicatorNode=null,t.clickIndicatorTween=null,t.opacityTween=null,t.npcHitAreaGraphics=null,t.isNpcHighlighted=!1,t.isGoingToNpc=!1,t.touchEnabled=!0,t}e(t,i);var c=t.prototype;return c.start=function(){this.initCharactersInfo(),this.initClickIndicator(),this.initNpcSprite(),this.updateAllCharacters(),this.touchArea.on(o.EventType.TOUCH_END,this.onTouchEnd,this),this.debugDraw&&this.drawDebugRect(),this.debugDrawNpcHitArea&&this.drawNpcHitArea()},c.onDestroy=function(){var i;this.stopMoving(),this.stopFlip(),this.stopNpcFlip(),null==(i=this.touchArea)||i.off(o.EventType.TOUCH_END,this.onTouchEnd,this),this.clickIndicatorNode&&this.clickIndicatorNode.destroy()},c.initCharactersInfo=function(){this.characterInitialScale=this.character.scale.clone(),this.isFacingRight=this.characterInitialScale.x>=0,this.characterInitialScale.x=Math.abs(this.characterInitialScale.x),this.characterInitialScale.y=Math.abs(this.characterInitialScale.y),this.characterInitialScale.z=Math.abs(this.characterInitialScale.z),this.npc&&(this.npcInitialScale=this.npc.scale.clone(),this.isNpcFacingRight=this.npcInitialScale.x>=0,this.npcInitialScale.x=Math.abs(this.npcInitialScale.x),this.npcInitialScale.y=Math.abs(this.npcInitialScale.y),this.npcInitialScale.z=Math.abs(this.npcInitialScale.z)),console.log("[Walk] 玩家朝向: "+(this.isFacingRight?"右":"左")),console.log("[Walk] NPC朝向: "+(this.isNpcFacingRight?"右":"左"))},c.initClickIndicator=function(){this.clickIndicatorSprite&&(this.clickIndicatorNode=new o("ClickIndicator"),this.clickIndicatorNode.parent=this.touchArea,this.clickIndicatorNode.addComponent(s),this.clickIndicatorNode.addComponent(h).spriteFrame=this.clickIndicatorSprite,this.clickIndicatorNode.addComponent(p),this.clickIndicatorNode.active=!1)},c.initNpcSprite=function(){if(this.npc&&this.npcNormalSprite){var i=this.npc.getComponent(h);i&&(i.spriteFrame=this.npcNormalSprite)}},c.drawDebugRect=function(){var i=this.node.getComponent(u);i||(i=this.node.addComponent(u)),i.clear(),i.strokeColor=new g(255,0,0,255),i.lineWidth=4,i.moveTo(this.leftBound,this.topBound),i.lineTo(this.rightBound,this.topBound),i.lineTo(this.rightBound,this.bottomBound),i.lineTo(this.leftBound,this.bottomBound),i.close(),i.stroke()},c.drawNpcHitArea=function(){if(this.npc){var i=this.npc.getChildByName("HitAreaDebug");i||((i=new o("HitAreaDebug")).parent=this.npc,i.addComponent(s)),this.npcHitAreaGraphics=i.getComponent(u),this.npcHitAreaGraphics||(this.npcHitAreaGraphics=i.addComponent(u)),this.updateNpcHitAreaDebug()}},c.updateNpcHitAreaDebug=function(){if(this.npcHitAreaGraphics){this.npcHitAreaGraphics.clear(),this.npcHitAreaGraphics.strokeColor=new g(0,255,0,200),this.npcHitAreaGraphics.fillColor=new g(0,255,0,50),this.npcHitAreaGraphics.lineWidth=2;var i=this.npcHitWidth/2,t=this.npcHitHeight/2,e=this.npcHitOffsetX,n=this.npcHitOffsetY;this.npcHitAreaGraphics.rect(e-i,n-t,this.npcHitWidth,this.npcHitHeight),this.npcHitAreaGraphics.fill(),this.npcHitAreaGraphics.stroke()}},c.setTouchEnabled=function(i){this.touchEnabled=i},c.onTouchEnd=function(i){if(this.touchEnabled){var t=this.touchArea.getComponent(s),e=i.getUILocation(),n=t.convertToNodeSpaceAR(new f(e.x,e.y,0));if(this.isPointInNpcHitArea(n))this.onNpcClicked();else{this.resetNpcHighlight(),this.isGoingToNpc=!1,this.showClickIndicator(n);var a=this.clampToRect(n);this.moveCharacterTo(a)}}},c.isPointInNpcHitArea=function(i){if(!this.npc)return!1;var t=this.npc.position,e=this.npc.scale,n=this.npcHitWidth*Math.abs(e.x),a=this.npcHitHeight*Math.abs(e.y),c=this.npcHitOffsetX*e.x,r=this.npcHitOffsetY*Math.abs(e.y),o=t.x+c,l=t.y+r,s=o-n/2,h=o+n/2,p=l-a/2,u=l+a/2;return i.x>=s&&i.x<=h&&i.y>=p&&i.y<=u},c.onNpcClicked=function(){var i=this;console.log("[NPC] NPC 被点击"),this.setNpcHighlight(!0),this.isGoingToNpc=!0;var t=this.calculateDialoguePosition();this.moveCharacterTo(t,(function(){i.faceEachOther((function(){i.triggerNpcDialogue()}))}))},c.calculateDialoguePosition=function(){var i,t=this.npc.position;i=this.character.position.x<t.x?t.x-this.dialogueDistance:t.x+this.dialogueDistance;var e=t.y+25;return this.clampToRect(new f(i,e,0))},c.faceEachOther=function(i){var t=this.character.position,e=this.npc.position,n=t.x<e.x,a=n,c=!1,r=!1,o=function(){c&&r&&(null==i||i())};this.isFacingRight!==n?this.flipCharacter(n,(function(){c=!0,o()})):c=!0,this.isNpcFacingRight!==a?this.flipNpc(a,(function(){r=!0,o()})):r=!0,o()},c.setNpcHighlight=function(i){if(this.npc){this.isNpcHighlighted=i;var t=this.npc.getComponent(h);t&&(i&&this.npcHighlightSprite?(t.spriteFrame=this.npcHighlightSprite,console.log("[NPC] 高亮开启")):!i&&this.npcNormalSprite&&(t.spriteFrame=this.npcNormalSprite,console.log("[NPC] 高亮关闭")))}},c.resetNpcHighlight=function(){this.isNpcHighlighted&&this.setNpcHighlight(!1)},c.triggerNpcDialogue=function(){var i=this;if(console.log("[NPC] 触发对话"),!this.dialogueManager)return console.warn("[NPC] 未设置 DialogueManager"),void this.node.emit("npc-dialogue-start",this.npc);this.setTouchEnabled(!1),this.dialogueManager.startDialogue("main",(function(){i.onDialogueEnd()}))},c.flipNpc=function(i,t){var e=this;if(this.npc)if(i!==this.isNpcFacingRight){this.stopNpcFlip(),this.isNpcFlipping=!0;var n=this.npc.position.y,a=this.getScaleMultiplier(n),c=this.npcInitialScale.x*a*(i?1:-1),r=this.npcInitialScale.y*a,o=this.npcFlipDuration/2;this.npcFlipTween=d(this.npc).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isNpcFacingRight=i})).to(o,{scale:new f(c,r,1)},{easing:"sineOut"}).call((function(){e.isNpcFlipping=!1,null==t||t()})).start()}else null==t||t();else null==t||t()},c.stopNpcFlip=function(){this.npcFlipTween&&(this.npcFlipTween.stop(),this.npcFlipTween=null),this.isNpcFlipping=!1},c.showClickIndicator=function(i){var t=this;if(this.clickIndicatorNode){this.clickIndicatorTween&&(this.clickIndicatorTween.stop(),this.clickIndicatorTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.clickIndicatorNode.setPosition(i),this.clickIndicatorNode.setScale(this.clickIndicatorScale,this.clickIndicatorScale,1);var e=this.clickIndicatorNode.getComponent(p);e.opacity=255,this.clickIndicatorNode.active=!0;var n=this.clickIndicatorDuration,a=1.5*this.clickIndicatorScale;this.clickIndicatorTween=d(this.clickIndicatorNode).to(n,{scale:new f(a,a,1)},{easing:"sineOut"}).call((function(){t.clickIndicatorNode.active=!1})).start(),this.opacityTween=d(e).to(n,{opacity:0},{easing:"sineIn"}).start()}},c.clampToRect=function(i){return new f(Math.max(this.leftBound,Math.min(this.rightBound,i.x)),Math.max(this.bottomBound,Math.min(this.topBound,i.y)),0)},c.getScaleMultiplier=function(i){if(this.topBound===this.bottomBound)return this.maxScaleMultiplier;var t=(i-this.bottomBound)/(this.topBound-this.bottomBound),e=Math.max(0,Math.min(1,t));return this.maxScaleMultiplier-e*(this.maxScaleMultiplier-this.minScaleMultiplier)},c.updateAllCharacters=function(){this.updateCharacterScale(),this.updateNpcScale(),this.updateCharactersZOrder()},c.updateCharacterScale=function(){if(this.isFlipping){var i=this.character.position.y,t=this.getScaleMultiplier(i),e=this.characterInitialScale.y*t,n=this.character.scale.x;this.character.setScale(n,e,1)}else{var a=this.character.position.y,c=this.getScaleMultiplier(a),r=this.characterInitialScale.x*c*(this.isFacingRight?1:-1),o=this.characterInitialScale.y*c;this.character.setScale(r,o,1)}},c.updateNpcScale=function(){if(this.npc&&!this.isNpcFlipping){var i=this.npc.position.y,t=this.getScaleMultiplier(i),e=this.npcInitialScale.x*t*(this.isNpcFacingRight?1:-1),n=this.npcInitialScale.y*t;this.npc.setScale(e,n,1)}},c.updateCharactersZOrder=function(){this.npc&&(this.character.position.y<this.npc.position.y+28?this.ensureOrder(this.npc,this.character):this.ensureOrder(this.character,this.npc))},c.ensureOrder=function(i,t){var e=i.parent;if(e&&t.parent===e){var n=i.getSiblingIndex();n>t.getSiblingIndex()&&t.setSiblingIndex(n)}},c.flipCharacter=function(i,t){var e=this;if(i!==this.isFacingRight){this.stopFlip(),this.isFlipping=!0;var n=this.character.position.y,a=this.getScaleMultiplier(n),c=this.characterInitialScale.x*a*(i?1:-1),r=this.characterInitialScale.y*a,o=this.flipDuration/2;this.flipTween=d(this.character).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isFacingRight=i})).to(o,{scale:new f(c,r,1)},{easing:"sineOut"}).call((function(){e.isFlipping=!1,null==t||t()})).start()}else null==t||t()},c.stopFlip=function(){this.flipTween&&(this.flipTween.stop(),this.flipTween=null),this.isFlipping=!1},c.moveCharacterTo=function(i,t){var e=this;this.stopMovingKeepAnimation();var n=this.character.position,a=f.distance(n,i);if(a<1)return this.walkAnimation&&this.walkAnimation.stopWalk(),void(null==t||t());var c=a/this.moveSpeed,r=this.flipOnMove&&i.x!==n.x,o=i.x>n.x,l=function(){e.isMoving=!0,e.walkAnimation&&e.walkAnimation.startWalk(),e.currentTween=d(e.character).to(c,{position:i},{easing:"linear",onUpdate:function(){return e.updateAllCharacters()}}).call((function(){e.isMoving=!1,e.walkAnimation&&e.walkAnimation.stopWalk(),null==t||t()})).start()};r&&o!==this.isFacingRight?this.flipCharacter(o,l):l()},c.stopMovingKeepAnimation=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1},c.stopMoving=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1,this.walkAnimation&&this.walkAnimation.stopWalk()},c.getIsMoving=function(){return this.isMoving},c.setCharacterPosition=function(i){var t=this.clampToRect(i);this.character.setPosition(t),this.updateAllCharacters()},c.setNpcPosition=function(i){if(this.npc){var t=this.clampToRect(i);this.npc.setPosition(t),this.updateAllCharacters()}},c.setFacingDirection=function(i){this.flipCharacter(i)},c.setFacingDirectionImmediate=function(i){this.isFacingRight=i,this.updateCharacterScale()},c.setNpcFacingDirection=function(i){this.flipNpc(i)},c.setNpcFacingDirectionImmediate=function(i){this.isNpcFacingRight=i,this.updateNpcScale()},c.refreshAllCharacters=function(){this.updateAllCharacters()},c.getIsNpcHighlighted=function(){return this.isNpcHighlighted},c.getIsGoingToNpc=function(){return this.isGoingToNpc},c.onDialogueEnd=function(){console.log("[NPC] 对话结束，重置状态"),this.resetNpcHighlight(),this.isGoingToNpc=!1,this.setTouchEnabled(!0)},t}(b)).prototype,"character",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(K.prototype,"npc",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(K.prototype,"touchArea",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(K.prototype,"npcNormalSprite",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(K.prototype,"npcHighlightSprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=t(K.prototype,"npcHitWidth",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ti=t(K.prototype,"npcHitHeight",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),ei=t(K.prototype,"npcHitOffsetX",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ni=t(K.prototype,"npcHitOffsetY",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ai=t(K.prototype,"dialogueDistance",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),ci=t(K.prototype,"debugDrawNpcHitArea",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ri=t(K.prototype,"clickIndicatorSprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=t(K.prototype,"clickIndicatorDuration",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),li=t(K.prototype,"clickIndicatorScale",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),si=t(K.prototype,"leftBound",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),hi=t(K.prototype,"rightBound",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),pi=t(K.prototype,"topBound",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ui=t(K.prototype,"bottomBound",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-300}}),gi=t(K.prototype,"minScaleMultiplier",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),fi=t(K.prototype,"maxScaleMultiplier",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),di=t(K.prototype,"moveSpeed",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),bi=t(K.prototype,"flipOnMove",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mi=t(K.prototype,"flipDuration",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Ni=t(K.prototype,"npcFlipDuration",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),wi=t(K.prototype,"debugDraw",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Si=t(K.prototype,"dialogueManager",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ii=t(K.prototype,"walkAnimation",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=K))||j));c._RF.pop()}}}));

System.register("chunks:///_virtual/WalkAnimationController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,a,n,l,s,o,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,s=e.Sprite,o=e.SpriteFrame,m=e.Component}],execute:function(){var u,h,c,p,F,k,f,w,g,d,b,W,y,x,I,D,C;n._RF.push({},"c3339T38jNCeLCcoWDbueEs","WalkAnimationController",void 0);var v=l.ccclass,S=l.property;e("WalkAnimationController",(u=v("WalkAnimationController"),h=S(s),c=S({type:o,tooltip:"站立（默认姿势）"}),p=S({type:o,tooltip:"左脚向前迈"}),F=S({type:o,tooltip:"并步1"}),k=S({type:o,tooltip:"右脚向前迈"}),f=S({type:o,tooltip:"并步2"}),w=S({tooltip:"每帧持续时间（秒）"}),u((b=t((d=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,i(t,"characterSprite",b,a(t)),i(t,"idleFrame",W,a(t)),i(t,"walkFrame1",y,a(t)),i(t,"walkFrame2",x,a(t)),i(t,"walkFrame3",I,a(t)),i(t,"walkFrame4",D,a(t)),i(t,"frameDuration",C,a(t)),t.walkFrames=[],t.currentFrameIndex=0,t.isWalking=!1,t.frameTimer=0,t}r(t,e);var n=t.prototype;return n.start=function(){this.initWalkFrames(),this.showIdle()},n.update=function(e){this.isWalking&&(this.frameTimer+=e,this.frameTimer>=this.frameDuration&&(this.frameTimer=0,this.nextFrame()))},n.initWalkFrames=function(){this.walkFrames=[],this.walkFrame1&&this.walkFrames.push(this.walkFrame1),this.walkFrame2&&this.walkFrames.push(this.walkFrame2),this.walkFrame3&&this.walkFrames.push(this.walkFrame3),this.walkFrame4&&this.walkFrames.push(this.walkFrame4),console.log("[WalkAnim] 初始化完成，共 "+this.walkFrames.length+" 帧")},n.showIdle=function(){this.isWalking=!1,this.frameTimer=0,this.currentFrameIndex=0,this.characterSprite&&this.idleFrame&&(this.characterSprite.spriteFrame=this.idleFrame)},n.startWalk=function(){this.isWalking||0!==this.walkFrames.length&&(this.isWalking=!0,this.frameTimer=0,this.currentFrameIndex=0,this.showCurrentFrame(),console.log("[WalkAnim] 开始步行动画"))},n.continueWalk=function(){0!==this.walkFrames.length&&(this.isWalking||(this.isWalking=!0,this.frameTimer=0,this.showCurrentFrame()))},n.stopWalk=function(){this.isWalking&&(this.showIdle(),console.log("[WalkAnim] 停止步行动画"))},n.nextFrame=function(){this.currentFrameIndex++,this.currentFrameIndex>=this.walkFrames.length&&(this.currentFrameIndex=0),this.showCurrentFrame()},n.showCurrentFrame=function(){this.characterSprite&&this.walkFrames[this.currentFrameIndex]&&(this.characterSprite.spriteFrame=this.walkFrames[this.currentFrameIndex])},n.getIsWalking=function(){return this.isWalking},n.setFrameDuration=function(e){this.frameDuration=Math.max(.05,e)},n.adjustSpeedByMovement=function(e,t){void 0===t&&(t=250);var r=e/t;this.frameDuration=.15/r,this.frameDuration=Math.max(.08,Math.min(.25,this.frameDuration))},t}(m)).prototype,"characterSprite",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(d.prototype,"idleFrame",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(d.prototype,"walkFrame1",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(d.prototype,"walkFrame2",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(d.prototype,"walkFrame3",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(d.prototype,"walkFrame4",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(d.prototype,"frameDuration",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),g=d))||g));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});