System.register("chunks:///_virtual/BGMManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var o,t,e,u,n,a,r,s,l,c;return{setters:[function(i){o=i.applyDecoratedDescriptor,t=i.inheritsLoose,e=i.initializerDefineProperty,u=i.assertThisInitialized},function(i){n=i.cclegacy,a=i._decorator,r=i.AudioClip,s=i.AudioSource,l=i.tween,c=i.Component}],execute:function(){var d,h,p,f,m,S,g,b,v,y,M,w,B,D,P;n._RF.push({},"87aec0EdWVDn44cFPbeNL+m","BGMManager",void 0);var C=a.ccclass,G=a.property;i("BGMManager",(d=C("BGMManager"),h=G({type:r,tooltip:"背景音乐音频文件"}),p=G({range:[0,1,.1],tooltip:"音量 (0-1)"}),f=G({tooltip:"是否循环播放"}),m=G({tooltip:"场景开始时自动播放"}),S=G({tooltip:"淡入时长（秒）"}),g=G({tooltip:"淡出时长（秒）"}),d((y=o((v=function(i){function o(){for(var o,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return o=i.call.apply(i,[this].concat(n))||this,e(o,"bgmClip",y,u(o)),e(o,"volume",M,u(o)),e(o,"loop",w,u(o)),e(o,"playOnStart",B,u(o)),e(o,"fadeInDuration",D,u(o)),e(o,"fadeOutDuration",P,u(o)),o.audioSource=null,o.fadeTween=null,o.isPaused=!1,o}t(o,i);var n=o.prototype;return n.onLoad=function(){this.audioSource=this.node.getComponent(s),this.audioSource||(this.audioSource=this.node.addComponent(s)),this.bgmClip&&(this.audioSource.clip=this.bgmClip),this.audioSource.loop=this.loop,this.audioSource.volume=0},n.start=function(){this.playOnStart&&this.bgmClip&&this.play()},n.onDestroy=function(){this.stopFade(),this.stop()},n.play=function(){this.audioSource&&this.bgmClip?(this.audioSource.clip=this.bgmClip,this.audioSource.loop=this.loop,this.audioSource.volume=0,this.audioSource.play(),this.isPaused=!1,this.fadeIn(),console.log("[BGM] 开始播放")):console.warn("[BGM] 未设置音频文件")},n.stop=function(){var i=this;this.audioSource&&this.fadeOut((function(){i.audioSource.stop(),console.log("[BGM] 停止播放")}))},n.stopImmediate=function(){this.stopFade(),this.audioSource&&this.audioSource.stop()},n.pause=function(){this.audioSource&&!this.isPaused&&(this.audioSource.pause(),this.isPaused=!0,console.log("[BGM] 暂停"))},n.resume=function(){this.audioSource&&this.isPaused&&(this.audioSource.play(),this.isPaused=!1,console.log("[BGM] 恢复播放"))},n.toggle=function(){this.isPaused?this.resume():this.pause()},n.setVolume=function(i){this.volume=Math.max(0,Math.min(1,i)),this.audioSource&&(this.audioSource.volume=this.volume)},n.getVolume=function(){return this.audioSource?this.audioSource.volume:this.volume},n.mute=function(i){this.audioSource&&(this.audioSource.volume=i?0:this.volume)},n.fadeIn=function(){this.stopFade(),this.fadeInDuration<=0?this.audioSource.volume=this.volume:this.fadeTween=l(this.audioSource).to(this.fadeInDuration,{volume:this.volume},{easing:"sineOut"}).start()},n.fadeOut=function(i){if(this.stopFade(),this.fadeOutDuration<=0)return this.audioSource.volume=0,void(null==i||i());this.fadeTween=l(this.audioSource).to(this.fadeOutDuration,{volume:0},{easing:"sineIn"}).call((function(){null==i||i()})).start()},n.stopFade=function(){this.fadeTween&&(this.fadeTween.stop(),this.fadeTween=null)},n.changeBGM=function(i){var o=this;i?this.fadeOut((function(){o.audioSource.stop(),o.bgmClip=i,o.audioSource.clip=i,o.audioSource.volume=0,o.audioSource.play(),o.fadeIn(),console.log("[BGM] 切换音乐")})):console.warn("[BGM] 新音频文件为空")},n.isPlaying=function(){return!!this.audioSource&&this.audioSource.playing},n.getIsPaused=function(){return this.isPaused},o}(c)).prototype,"bgmClip",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=o(v.prototype,"volume",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),w=o(v.prototype,"loop",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),B=o(v.prototype,"playOnStart",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D=o(v.prototype,"fadeInDuration",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),P=o(v.prototype,"fadeOutDuration",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),b=v))||b));n._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,a,o,r,s,c,u,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,s=t.Node,c=t.tween,u=t.Vec3,l=t.UIOpacity,h=t.Component}],execute:function(){var p,f,d,m,y,b,v;o._RF.push({},"fd0daWSVDREuaDo3PMUjNuH","CharacterAnimation",void 0);var g=r.ccclass,w=r.property;t("CharacterAnimation",(p=g("CharacterAnimation"),f=w(s),d=w(s),p((b=e((y=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,i(e,"huangNode",b,a(e)),i(e,"liRouNode",v,a(e)),e.initialPositions=new Map,e}n(e,t);var o=e.prototype;return o.start=function(){this.initialPositions.set("黄超雄",this.huangNode.position.clone()),this.initialPositions.set("李柔",this.liRouNode.position.clone()),this.liRouNode.setPosition(0,1762)},o.playAnimation=function(t,e,n){void 0===n&&(n=.5);var i=this.getCharacterNode(t);i&&(Array.isArray(e)?this.playComboAnimation(i,t,e,n):this.playSingleAnimation(i,t,e,n))},o.playComboAnimation=function(t,e,n,i){var a=this,o=c(t),r=[],s=[];n.forEach((function(t){"fadeIn"===t||"fadeOut"===t?r.push(t):s.push(t)}));var l={};s.forEach((function(t){switch(t){case"moveIn":var n=a.initialPositions.get(e);n&&(l.position=n);break;case"scaleUp":l.scale=new u(1.5,1.5,1);break;case"scaleDown":l.scale=new u(1.2,1.2,1);break;case"rotate":l.angle=360}})),Object.keys(l).length>0&&o.to(i,l).start(),r.forEach((function(e){"fadeIn"===e?a.fadeIn(t,i):"fadeOut"===e&&a.fadeOut(t,i)}))},o.playSingleAnimation=function(t,e,n,i){switch(n){case"fadeIn":this.fadeIn(t,i);break;case"fadeOut":this.fadeOut(t,i);break;case"moveIn":this.moveIn(t,e,i);break;case"shake":this.shake(t,i);break;case"jump":this.jump(t,i);break;case"scaleUp":this.scale(t,new u(1,1,1),i);break;case"scaleDown":this.scale(t,new u(1.2,1.2,1),i)}},o.getCharacterNode=function(t){switch(t){case"黄超雄":return this.huangNode;case"李柔":return this.liRouNode;default:return null}},o.fadeIn=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),n.opacity=0,c(n).to(e,{opacity:255}).start()},o.fadeOut=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),c(n).to(e,{opacity:0}).start()},o.moveIn=function(t,e,n){var i=this.initialPositions.get(e);i&&c(t).to(n,{position:i}).start()},o.shake=function(t,e){for(var n=t.position.clone(),i=c(t),a=0;a<5;a++){var o=10*(Math.random()-.5),r=10*(Math.random()-.5);i=i.to(e/5,{position:new u(n.x+o,n.y+r,0)})}i.to(.1,{position:n}).start()},o.jump=function(t,e){c(t).by(e/2,{position:new u(0,50,0)}).by(e/2,{position:new u(0,-50,0)}).start()},o.scale=function(t,e,n){c(t).to(n,{scale:e}).start()},e}(h)).prototype,"huangNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"liRouNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=y))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueData.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"8db46z9IL9AHbbihU0woZPn","DialogueData",void 0);t("DialogueData",function(){function t(){}return t.getDialogues=function(){return[{speaker:"黄超雄",text:"来来来，正宗炒螺蛳粉，独家秘方！"},{speaker:"顾客",text:"黄老板，来一份加辣加酸笋，多放点花生米！"},{speaker:"黄超雄",text:"好嘞！马上就好",animation:{character:"黄超雄",action:"jump"}},{speaker:"李柔",text:"黄超雄……",animation:{character:"李柔",action:["fadeIn","moveIn","scaleUp"],duration:3}},{speaker:"黄超雄",text:"不好，是李柔。快跑！！！",animation:{character:"黄超雄",action:"shake"}}]},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueData.ts","./CharacterAnimation.ts"],(function(e){var t,i,n,a,r,o,u,l,s,c,h,g,p,d,f,b,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,u=e.Node,l=e.Label,s=e.RichText,c=e.SpriteFrame,h=e.Color,g=e.UIOpacity,p=e.tween,d=e.Sprite,f=e.Component},function(e){b=e.DialogueData},function(e){m=e.CharacterAnimation}],execute:function(){var y,v,x,D,I,A,w,T,k,C,R,S,z,P,N,B,L,M,U,F,O,_,E;r._RF.push({},"6de0bjbfp1N05Yh6Qf54/OA","DialogueManager",void 0);var j=o.ccclass,H=o.property;e("DialogueManager",(y=j("DialogueManager"),v=H(u),x=H(l),D=H(s),I=H(u),A=H(u),w=H(c),T=H(c),k=H(c),C=H(m),R=H(u),y((P=t((z=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,n(t,"dialogueUI",P,a(t)),n(t,"speakerLabel",N,a(t)),n(t,"contentRichText",B,a(t)),n(t,"speakerAvatar",L,a(t)),n(t,"background",M,a(t)),n(t,"huangAvatar",U,a(t)),n(t,"custumerAvatar",F,a(t)),n(t,"liRouAvatar",O,a(t)),n(t,"animationManager",_,a(t)),n(t,"dialogueNextButton",E,a(t)),t.mainScene=null,t.currentIndex=0,t.dialogues=[],t.isTyping=!1,t.typingScheduleId=null,t.canProceed=!1,t.dialoguePauseTime=[.2,.2,.2,1,.2],t}i(t,e);var r=t.prototype;return r.init=function(e){this.mainScene=e,this.dialogues=b.getDialogues()},r.startDialogue=function(){var e=this;this.currentIndex=0;var t=this.dialogues[this.currentIndex];this.speakerLabel.string=t.speaker,this.contentRichText.string="",this.contentRichText.fontColor=h.BLACK;var i=this.dialogueUI.getComponent(g);i||(i=this.dialogueUI.addComponent(g)),i.opacity=0,this.dialogueUI.active=!0,this.scheduleOnce((function(){p(i).to(1,{opacity:255}).call((function(){e.showDialogue()})).start()}),1),this.background.on(u.EventType.TOUCH_END,this.onNextClick,this)},r.showDialogue=function(){if(this.currentIndex>=this.dialogues.length)this.endDialogue();else{var e=this.dialogues[this.currentIndex];this.speakerLabel.string=e.speaker;var t=this.speakerAvatar.getComponent(d);switch(e.speaker){case"黄超雄":t.spriteFrame=this.huangAvatar;break;case"李柔":t.spriteFrame=this.liRouAvatar;break;default:t.spriteFrame=this.custumerAvatar}this.typewriterEffect(e.text)}},r.typewriterEffect=function(e,t){var i=this;this.typingScheduleId&&this.unschedule(this.typingScheduleId),this.isTyping=!0,this.canProceed=!1,this.contentRichText.string="",this.contentRichText.fontColor=h.BLACK;var n=0,a=function a(){n<e.length?(i.contentRichText.string+=e[n],n++):(i.isTyping=!1,i.unschedule(a),i.dialoguePause(),t&&t())};this.typingScheduleId=a,this.schedule(a,.05)},r.dialoguePause=function(){var e=this;this.scheduleOnce((function(){e.canProceed=!0,e.showDialogueNextButton()}),this.dialoguePauseTime[this.currentIndex])},r.showDialogueNextButton=function(){this.dialogueNextButton.active=!0},r.playAnimation=function(){if(this.currentIndex>=this.dialogues.length)this.endDialogue();else{var e=this.dialogues[this.currentIndex];e.animation&&this.animationManager.playAnimation(e.animation.character,e.animation.action,e.animation.duration)}},r.onNextClick=function(){this.isTyping?(this.unschedule(this.typingScheduleId),this.contentRichText.string=this.dialogues[this.currentIndex].text,this.isTyping=!1,this.canProceed=!1,this.dialoguePause()):this.canProceed&&(this.currentIndex++,this.dialogueNextButton.active=!1,this.playAnimation(),this.showDialogue())},r.endDialogue=function(){console.log("对话结束"),this.dialogueUI.active=!1,this.mainScene&&this.mainScene.switchToGameScene()},r.onDestroy=function(){this.unscheduleAllCallbacks()},t}(f)).prototype,"dialogueUI",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(z.prototype,"speakerLabel",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(z.prototype,"contentRichText",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(z.prototype,"speakerAvatar",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(z.prototype,"background",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(z.prototype,"huangAvatar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(z.prototype,"custumerAvatar",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(z.prototype,"liRouAvatar",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(z.prototype,"animationManager",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(z.prototype,"dialogueNextButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=z))||S));r._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueManager.ts"],(function(e){var i,n,t,a,r,o,c,u;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,c=e.Component},function(e){u=e.DialogueManager}],execute:function(){var l,s,g,p,f;r._RF.push({},"6d55elQuNpPV65xENq0o7Qy","DialogueScene",void 0);var h=o.ccclass,d=o.property;e("DialogueScene",(l=h("DialogueScene"),s=d(u),l((f=i((p=function(e){function i(){for(var i,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=e.call.apply(e,[this].concat(r))||this,t(i,"dialogueManager",f,a(i)),i}n(i,e);var r=i.prototype;return r.start=function(){this.initScene(),this.dialogueManager.startDialogue()},r.initScene=function(){this.dialogueManager.init(this)},r.switchToGameScene=function(){},i}(c)).prototype,"dialogueManager",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=p))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./BGMManager.ts","./CharacterAnimation.ts","./DialogueData.ts","./DialogueManager.ts","./DialogueScene.ts","./StreetWalkController.ts"],(function(){return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/StreetWalkController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,e,n,c,a,r,o,l,s,p,h,u,g,f,d,b;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,c=i.assertThisInitialized},function(i){a=i.cclegacy,r=i._decorator,o=i.Node,l=i.SpriteFrame,s=i.UITransform,p=i.Sprite,h=i.UIOpacity,u=i.Graphics,g=i.Color,f=i.Vec3,d=i.tween,b=i.Component}],execute:function(){var N,m,S,I,w,y,C,v,H,T,F,k,M,x,D,A,z,B,R,P,O,G,W,E,U,_,X,Y,L,Z,j,V,q,J,K,Q,$,ii,ti,ei,ni,ci,ai,ri,oi,li,si,pi,hi,ui,gi,fi,di;a._RF.push({},"2ae864vzZBC273s6gaj29ll","StreetWalkController",void 0);var bi=r.ccclass,Ni=r.property;i("StreetWalkController",(N=bi("StreetWalkController"),m=Ni(o),S=Ni(o),I=Ni(o),w=Ni({type:l,tooltip:"NPC 默认图像"}),y=Ni({type:l,tooltip:"NPC 高亮图像"}),C=Ni({tooltip:"NPC 碰撞范围宽度"}),v=Ni({tooltip:"NPC 碰撞范围高度"}),H=Ni({tooltip:"NPC 碰撞范围 X 偏移"}),T=Ni({tooltip:"NPC 碰撞范围 Y 偏移"}),F=Ni({tooltip:"对话距离（玩家与NPC的间隔）"}),k=Ni({tooltip:"是否绘制 NPC 碰撞范围（调试用）"}),M=Ni({type:l,tooltip:"点击反馈圆圈图片"}),x=Ni({tooltip:"圆圈显示时长（秒）"}),D=Ni({tooltip:"圆圈初始大小"}),A=Ni({tooltip:"左边界"}),z=Ni({tooltip:"右边界"}),B=Ni({tooltip:"上边界（远处）"}),R=Ni({tooltip:"下边界（近处）"}),P=Ni({tooltip:"最远处（top）的缩放乘数"}),O=Ni({tooltip:"最近处（bottom）的缩放乘数"}),G=Ni({tooltip:"移动速度（像素/秒）"}),W=Ni({tooltip:"是否根据移动方向翻转角色"}),E=Ni({tooltip:"翻转动画时长（秒）"}),U=Ni({tooltip:"NPC 翻转动画时长（秒）"}),_=Ni({tooltip:"是否绘制可行走区域边框"}),N((L=t((Y=function(i){function t(){for(var t,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return t=i.call.apply(i,[this].concat(a))||this,n(t,"character",L,c(t)),n(t,"npc",Z,c(t)),n(t,"touchArea",j,c(t)),n(t,"npcNormalSprite",V,c(t)),n(t,"npcHighlightSprite",q,c(t)),n(t,"npcHitWidth",J,c(t)),n(t,"npcHitHeight",K,c(t)),n(t,"npcHitOffsetX",Q,c(t)),n(t,"npcHitOffsetY",$,c(t)),n(t,"dialogueDistance",ii,c(t)),n(t,"debugDrawNpcHitArea",ti,c(t)),n(t,"clickIndicatorSprite",ei,c(t)),n(t,"clickIndicatorDuration",ni,c(t)),n(t,"clickIndicatorScale",ci,c(t)),n(t,"leftBound",ai,c(t)),n(t,"rightBound",ri,c(t)),n(t,"topBound",oi,c(t)),n(t,"bottomBound",li,c(t)),n(t,"minScaleMultiplier",si,c(t)),n(t,"maxScaleMultiplier",pi,c(t)),n(t,"moveSpeed",hi,c(t)),n(t,"flipOnMove",ui,c(t)),n(t,"flipDuration",gi,c(t)),n(t,"npcFlipDuration",fi,c(t)),n(t,"debugDraw",di,c(t)),t.currentTween=null,t.flipTween=null,t.npcFlipTween=null,t.isMoving=!1,t.isFlipping=!1,t.isNpcFlipping=!1,t.isFacingRight=!0,t.isNpcFacingRight=!1,t.characterInitialScale=new f(1,1,1),t.npcInitialScale=new f(1,1,1),t.clickIndicatorNode=null,t.clickIndicatorTween=null,t.opacityTween=null,t.npcHitAreaGraphics=null,t.isNpcHighlighted=!1,t.isGoingToNpc=!1,t}e(t,i);var a=t.prototype;return a.start=function(){this.initCharactersInfo(),this.initClickIndicator(),this.initNpcSprite(),this.updateAllCharacters(),this.touchArea.on(o.EventType.TOUCH_END,this.onTouchEnd,this),this.debugDraw&&this.drawDebugRect(),this.debugDrawNpcHitArea&&this.drawNpcHitArea()},a.onDestroy=function(){var i;this.stopMoving(),this.stopFlip(),this.stopNpcFlip(),null==(i=this.touchArea)||i.off(o.EventType.TOUCH_END,this.onTouchEnd,this),this.clickIndicatorNode&&this.clickIndicatorNode.destroy()},a.initCharactersInfo=function(){this.characterInitialScale=this.character.scale.clone(),this.isFacingRight=this.characterInitialScale.x>=0,this.characterInitialScale.x=Math.abs(this.characterInitialScale.x),this.characterInitialScale.y=Math.abs(this.characterInitialScale.y),this.characterInitialScale.z=Math.abs(this.characterInitialScale.z),this.npc&&(this.npcInitialScale=this.npc.scale.clone(),this.isNpcFacingRight=this.npcInitialScale.x>=0,this.npcInitialScale.x=Math.abs(this.npcInitialScale.x),this.npcInitialScale.y=Math.abs(this.npcInitialScale.y),this.npcInitialScale.z=Math.abs(this.npcInitialScale.z)),console.log("[Walk] 玩家朝向: "+(this.isFacingRight?"右":"左")),console.log("[Walk] NPC朝向: "+(this.isNpcFacingRight?"右":"左"))},a.initClickIndicator=function(){this.clickIndicatorSprite&&(this.clickIndicatorNode=new o("ClickIndicator"),this.clickIndicatorNode.parent=this.touchArea,this.clickIndicatorNode.addComponent(s),this.clickIndicatorNode.addComponent(p).spriteFrame=this.clickIndicatorSprite,this.clickIndicatorNode.addComponent(h),this.clickIndicatorNode.active=!1)},a.initNpcSprite=function(){if(this.npc&&this.npcNormalSprite){var i=this.npc.getComponent(p);i&&(i.spriteFrame=this.npcNormalSprite)}},a.drawDebugRect=function(){var i=this.node.getComponent(u);i||(i=this.node.addComponent(u)),i.clear(),i.strokeColor=new g(255,0,0,255),i.lineWidth=4,i.moveTo(this.leftBound,this.topBound),i.lineTo(this.rightBound,this.topBound),i.lineTo(this.rightBound,this.bottomBound),i.lineTo(this.leftBound,this.bottomBound),i.close(),i.stroke()},a.drawNpcHitArea=function(){if(this.npc){var i=this.npc.getChildByName("HitAreaDebug");i||((i=new o("HitAreaDebug")).parent=this.npc,i.addComponent(s)),this.npcHitAreaGraphics=i.getComponent(u),this.npcHitAreaGraphics||(this.npcHitAreaGraphics=i.addComponent(u)),this.updateNpcHitAreaDebug()}},a.updateNpcHitAreaDebug=function(){if(this.npcHitAreaGraphics){this.npcHitAreaGraphics.clear(),this.npcHitAreaGraphics.strokeColor=new g(0,255,0,200),this.npcHitAreaGraphics.fillColor=new g(0,255,0,50),this.npcHitAreaGraphics.lineWidth=2;var i=this.npcHitWidth/2,t=this.npcHitHeight/2,e=this.npcHitOffsetX,n=this.npcHitOffsetY;this.npcHitAreaGraphics.rect(e-i,n-t,this.npcHitWidth,this.npcHitHeight),this.npcHitAreaGraphics.fill(),this.npcHitAreaGraphics.stroke()}},a.onTouchEnd=function(i){var t=this.touchArea.getComponent(s),e=i.getUILocation(),n=t.convertToNodeSpaceAR(new f(e.x,e.y,0));if(this.isPointInNpcHitArea(n))this.onNpcClicked();else{this.resetNpcHighlight(),this.isGoingToNpc=!1,this.showClickIndicator(n);var c=this.clampToRect(n);this.moveCharacterTo(c)}},a.isPointInNpcHitArea=function(i){if(!this.npc)return!1;var t=this.npc.position,e=this.npc.scale,n=this.npcHitWidth*Math.abs(e.x),c=this.npcHitHeight*Math.abs(e.y),a=this.npcHitOffsetX*e.x,r=this.npcHitOffsetY*Math.abs(e.y),o=t.x+a,l=t.y+r,s=o-n/2,p=o+n/2,h=l-c/2,u=l+c/2;return i.x>=s&&i.x<=p&&i.y>=h&&i.y<=u},a.onNpcClicked=function(){var i=this;console.log("[NPC] NPC 被点击"),this.setNpcHighlight(!0),this.isGoingToNpc=!0;var t=this.calculateDialoguePosition();this.moveCharacterTo(t,(function(){i.faceEachOther((function(){i.triggerNpcDialogue()}))}))},a.calculateDialoguePosition=function(){var i,t=this.npc.position;i=this.character.position.x<t.x?t.x-this.dialogueDistance:t.x+this.dialogueDistance;var e=t.y+25;return this.clampToRect(new f(i,e,0))},a.faceEachOther=function(i){var t=this.character.position,e=this.npc.position,n=t.x<e.x,c=n,a=!1,r=!1,o=function(){a&&r&&(null==i||i())};this.isFacingRight!==n?this.flipCharacter(n,(function(){a=!0,o()})):a=!0,this.isNpcFacingRight!==c?this.flipNpc(c,(function(){r=!0,o()})):r=!0,o()},a.setNpcHighlight=function(i){if(this.npc){this.isNpcHighlighted=i;var t=this.npc.getComponent(p);t&&(i&&this.npcHighlightSprite?(t.spriteFrame=this.npcHighlightSprite,console.log("[NPC] 高亮开启")):!i&&this.npcNormalSprite&&(t.spriteFrame=this.npcNormalSprite,console.log("[NPC] 高亮关闭")))}},a.resetNpcHighlight=function(){this.isNpcHighlighted&&this.setNpcHighlight(!1)},a.triggerNpcDialogue=function(){console.log("[NPC] 触发对话"),this.node.emit("npc-dialogue-start",this.npc)},a.flipNpc=function(i,t){var e=this;if(this.npc)if(i!==this.isNpcFacingRight){this.stopNpcFlip(),this.isNpcFlipping=!0;var n=this.npc.position.y,c=this.getScaleMultiplier(n),a=this.npcInitialScale.x*c*(i?1:-1),r=this.npcInitialScale.y*c,o=this.npcFlipDuration/2;this.npcFlipTween=d(this.npc).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isNpcFacingRight=i})).to(o,{scale:new f(a,r,1)},{easing:"sineOut"}).call((function(){e.isNpcFlipping=!1,null==t||t()})).start()}else null==t||t();else null==t||t()},a.stopNpcFlip=function(){this.npcFlipTween&&(this.npcFlipTween.stop(),this.npcFlipTween=null),this.isNpcFlipping=!1},a.showClickIndicator=function(i){var t=this;if(this.clickIndicatorNode){this.clickIndicatorTween&&(this.clickIndicatorTween.stop(),this.clickIndicatorTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.clickIndicatorNode.setPosition(i),this.clickIndicatorNode.setScale(this.clickIndicatorScale,this.clickIndicatorScale,1);var e=this.clickIndicatorNode.getComponent(h);e.opacity=255,this.clickIndicatorNode.active=!0;var n=this.clickIndicatorDuration,c=1.5*this.clickIndicatorScale;this.clickIndicatorTween=d(this.clickIndicatorNode).to(n,{scale:new f(c,c,1)},{easing:"sineOut"}).call((function(){t.clickIndicatorNode.active=!1})).start(),this.opacityTween=d(e).to(n,{opacity:0},{easing:"sineIn"}).start()}},a.clampToRect=function(i){return new f(Math.max(this.leftBound,Math.min(this.rightBound,i.x)),Math.max(this.bottomBound,Math.min(this.topBound,i.y)),0)},a.getScaleMultiplier=function(i){if(this.topBound===this.bottomBound)return this.maxScaleMultiplier;var t=(i-this.bottomBound)/(this.topBound-this.bottomBound),e=Math.max(0,Math.min(1,t));return this.maxScaleMultiplier-e*(this.maxScaleMultiplier-this.minScaleMultiplier)},a.updateAllCharacters=function(){this.updateCharacterScale(),this.updateNpcScale(),this.updateCharactersZOrder()},a.updateCharacterScale=function(){if(this.isFlipping){var i=this.character.position.y,t=this.getScaleMultiplier(i),e=this.characterInitialScale.y*t,n=this.character.scale.x;this.character.setScale(n,e,1)}else{var c=this.character.position.y,a=this.getScaleMultiplier(c),r=this.characterInitialScale.x*a*(this.isFacingRight?1:-1),o=this.characterInitialScale.y*a;this.character.setScale(r,o,1)}},a.updateNpcScale=function(){if(this.npc&&!this.isNpcFlipping){var i=this.npc.position.y,t=this.getScaleMultiplier(i),e=this.npcInitialScale.x*t*(this.isNpcFacingRight?1:-1),n=this.npcInitialScale.y*t;this.npc.setScale(e,n,1)}},a.updateCharactersZOrder=function(){this.npc&&(this.character.position.y<this.npc.position.y+25?this.ensureOrder(this.npc,this.character):this.ensureOrder(this.character,this.npc))},a.ensureOrder=function(i,t){var e=i.parent;if(e&&t.parent===e){var n=i.getSiblingIndex();n>t.getSiblingIndex()&&t.setSiblingIndex(n)}},a.flipCharacter=function(i,t){var e=this;if(i!==this.isFacingRight){this.stopFlip(),this.isFlipping=!0;var n=this.character.position.y,c=this.getScaleMultiplier(n),a=this.characterInitialScale.x*c*(i?1:-1),r=this.characterInitialScale.y*c,o=this.flipDuration/2;this.flipTween=d(this.character).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isFacingRight=i})).to(o,{scale:new f(a,r,1)},{easing:"sineOut"}).call((function(){e.isFlipping=!1,null==t||t()})).start()}else null==t||t()},a.stopFlip=function(){this.flipTween&&(this.flipTween.stop(),this.flipTween=null),this.isFlipping=!1},a.moveCharacterTo=function(i,t){var e=this;this.stopMoving();var n=this.character.position,c=f.distance(n,i);if(c<1)null==t||t();else{var a=c/this.moveSpeed,r=this.flipOnMove&&i.x!==n.x,o=i.x>n.x,l=function(){e.isMoving=!0,e.currentTween=d(e.character).to(a,{position:i},{easing:"linear",onUpdate:function(){return e.updateAllCharacters()}}).call((function(){e.isMoving=!1,null==t||t()})).start()};r&&o!==this.isFacingRight?this.flipCharacter(o,l):l()}},a.stopMoving=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1},a.getIsMoving=function(){return this.isMoving},a.setCharacterPosition=function(i){var t=this.clampToRect(i);this.character.setPosition(t),this.updateAllCharacters()},a.setNpcPosition=function(i){if(this.npc){var t=this.clampToRect(i);this.npc.setPosition(t),this.updateAllCharacters()}},a.setFacingDirection=function(i){this.flipCharacter(i)},a.setFacingDirectionImmediate=function(i){this.isFacingRight=i,this.updateCharacterScale()},a.setNpcFacingDirection=function(i){this.flipNpc(i)},a.setNpcFacingDirectionImmediate=function(i){this.isNpcFacingRight=i,this.updateNpcScale()},a.refreshAllCharacters=function(){this.updateAllCharacters()},a.getIsNpcHighlighted=function(){return this.isNpcHighlighted},a.getIsGoingToNpc=function(){return this.isGoingToNpc},a.onDialogueEnd=function(){this.resetNpcHighlight(),this.isGoingToNpc=!1},t}(b)).prototype,"character",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(Y.prototype,"npc",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(Y.prototype,"touchArea",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(Y.prototype,"npcNormalSprite",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(Y.prototype,"npcHighlightSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(Y.prototype,"npcHitWidth",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),K=t(Y.prototype,"npcHitHeight",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Q=t(Y.prototype,"npcHitOffsetX",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$=t(Y.prototype,"npcHitOffsetY",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ii=t(Y.prototype,"dialogueDistance",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),ti=t(Y.prototype,"debugDrawNpcHitArea",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ei=t(Y.prototype,"clickIndicatorSprite",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ni=t(Y.prototype,"clickIndicatorDuration",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ci=t(Y.prototype,"clickIndicatorScale",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),ai=t(Y.prototype,"leftBound",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),ri=t(Y.prototype,"rightBound",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),oi=t(Y.prototype,"topBound",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),li=t(Y.prototype,"bottomBound",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-300}}),si=t(Y.prototype,"minScaleMultiplier",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),pi=t(Y.prototype,"maxScaleMultiplier",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),hi=t(Y.prototype,"moveSpeed",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),ui=t(Y.prototype,"flipOnMove",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gi=t(Y.prototype,"flipDuration",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),fi=t(Y.prototype,"npcFlipDuration",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),di=t(Y.prototype,"debugDraw",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),X=Y))||X));a._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});