System.register("chunks:///_virtual/AfterOrderSceneController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,o,r,a,c,s,l,u,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,c=e.Node,s=e.director,l=e.UIOpacity,u=e.tween,h=e.Component}],execute:function(){var p,f,y,g,C,d,T,m,b,v,S,D,E,k,A;r._RF.push({},"80139yG4Q9EWpO7AaMEt7YJ","AfterOrderSceneController",void 0);var O=a.ccclass,x=a.property;e("AfterOrderSceneController",(p=O("AfterOrderSceneController"),f=x(c),y=x({tooltip:"场景淡入时长（秒）"}),g=x({tooltip:"场景淡出时长（秒）"}),C=x({tooltip:"进入后停留时长（秒）"}),d=x({tooltip:"下一个场景名称"}),T=x({type:c,tooltip:"点击区域（全屏）"}),p((v=t((b=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,i(t,"sceneTransition",v,o(t)),i(t,"sceneEnterDuration",S,o(t)),i(t,"sceneExitDuration",D,o(t)),i(t,"stayDuration",E,o(t)),i(t,"nextSceneName",k,o(t)),i(t,"touchArea",A,o(t)),t.canClick=!1,t.isSceneChanging=!1,t}n(t,e);var r=t.prototype;return r.start=function(){this.initUI(),this.playSceneEnter()},r.onDestroy=function(){this.touchArea&&this.touchArea.isValid&&this.touchArea.off(c.EventType.TOUCH_END,this.onClick,this)},r.initUI=function(){this.sceneTransition&&(this.sceneTransition.active=!0,this.setOpacity(this.sceneTransition,255))},r.playSceneEnter=function(){var e=this;this.fadeFromBlack((function(){e.scheduleOnce((function(){e.canClick=!0,e.registerClick(),console.log("[Chapter1Opening] 可以点击了")}),e.stayDuration)}))},r.registerClick=function(){this.touchArea&&this.touchArea.on(c.EventType.TOUCH_END,this.onClick,this)},r.onClick=function(){this.canClick&&!this.isSceneChanging&&(this.isSceneChanging=!0,this.canClick=!1,this.touchArea&&this.touchArea.off(c.EventType.TOUCH_END,this.onClick,this),this.goToNextScene())},r.goToNextScene=function(){var e=this;this.fadeToBlack((function(){console.log("[Chapter1Opening] 切换到场景: "+e.nextSceneName),s.loadScene(e.nextSceneName)}))},r.fadeFromBlack=function(e){var t=this;if(this.sceneTransition){var n=this.sceneTransition.getComponent(l);n||(n=this.sceneTransition.addComponent(l)),n.opacity=255,u(n).to(this.sceneEnterDuration,{opacity:0},{easing:"sineOut"}).call((function(){t.sceneTransition.active=!1,null==e||e()})).start()}else null==e||e()},r.fadeToBlack=function(e){if(this.sceneTransition){this.sceneTransition.active=!0;var t=this.sceneTransition.getComponent(l);t||(t=this.sceneTransition.addComponent(l)),t.opacity=0,u(t).to(this.sceneExitDuration,{opacity:255},{easing:"sineIn"}).call((function(){null==e||e()})).start()}else null==e||e()},r.setOpacity=function(e,t){var n=e.getComponent(l);n||(n=e.addComponent(l)),n.opacity=t},t}(h)).prototype,"sceneTransition",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=t(b.prototype,"sceneEnterDuration",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),D=t(b.prototype,"sceneExitDuration",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),E=t(b.prototype,"stayDuration",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),k=t(b.prototype,"nextSceneName",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Scene1"}}),A=t(b.prototype,"touchArea",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=b))||m));r._RF.pop()}}}));

System.register("chunks:///_virtual/Chapter1OpeningController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Scene1_DialogueManager.ts"],(function(e){var n,t,i,o,a,r,c,s,l,u,p,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,c=e.Node,s=e.director,l=e.UIOpacity,u=e.tween,p=e.Component},function(e){g=e.DialogueManager}],execute:function(){var f,h,y,d,T,m,C,v,b,D,O,S,x;a._RF.push({},"8a639aCTOtPbKOIumaCG3qT","Chapter1OpeningController",void 0);var E=r.ccclass,M=r.property;e("Chapter1OpeningController",(f=E("Chapter1OpeningController"),h=M(g),y=M(c),d=M({tooltip:"场景淡入时长（秒）"}),T=M({tooltip:"场景淡出时长（秒）"}),m=M({tooltip:"下一个场景名称"}),f((b=n((v=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return n=e.call.apply(e,[this].concat(a))||this,i(n,"dialogueManager",b,o(n)),i(n,"sceneTransition",D,o(n)),i(n,"sceneEnterDuration",O,o(n)),i(n,"sceneExitDuration",S,o(n)),i(n,"nextSceneName",x,o(n)),n}t(n,e);var a=n.prototype;return a.start=function(){this.initUI(),this.playSceneEnter()},a.initUI=function(){this.sceneTransition&&(this.sceneTransition.active=!0,this.setOpacity(this.sceneTransition,255))},a.playSceneEnter=function(){var e=this;this.fadeFromBlack((function(){e.playOpeningDialogue()}))},a.playOpeningDialogue=function(){var e=this;if(!this.dialogueManager)return console.error("[Chapter1Opening] DialogueManager 未设置"),void this.goToNextScene();this.dialogueManager.startDialogue("chapter1_opening",(function(){console.log("[Chapter1Opening] 开场对话结束"),e.goToNextScene()}))},a.goToNextScene=function(){var e=this;this.fadeToBlack((function(){console.log("[Chapter1Opening] 切换到场景: "+e.nextSceneName),s.loadScene(e.nextSceneName)}))},a.fadeFromBlack=function(e){var n=this;if(this.sceneTransition){var t=this.sceneTransition.getComponent(l);t||(t=this.sceneTransition.addComponent(l)),t.opacity=255,u(t).to(this.sceneEnterDuration,{opacity:0},{easing:"sineOut"}).call((function(){n.sceneTransition.active=!1,null==e||e()})).start()}else null==e||e()},a.fadeToBlack=function(e){if(this.sceneTransition){this.sceneTransition.active=!0;var n=this.sceneTransition.getComponent(l);n||(n=this.sceneTransition.addComponent(l)),n.opacity=0,u(n).to(this.sceneExitDuration,{opacity:255},{easing:"sineIn"}).call((function(){null==e||e()})).start()}else null==e||e()},a.setOpacity=function(e,n){var t=e.getComponent(l);t||(t=e.addComponent(l)),t.opacity=n},n}(p)).prototype,"dialogueManager",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=n(v.prototype,"sceneTransition",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=n(v.prototype,"sceneEnterDuration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),S=n(v.prototype,"sceneExitDuration",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),x=n(v.prototype,"nextSceneName",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Scene1"}}),C=v))||C));a._RF.pop()}}}));

System.register("chunks:///_virtual/CharacterAnimation.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,i,a,o,r,s,c,u,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,s=t.Node,c=t.tween,u=t.Vec3,l=t.UIOpacity,h=t.Component}],execute:function(){var p,f,d,m,y,b,v;o._RF.push({},"fd0daWSVDREuaDo3PMUjNuH","CharacterAnimation",void 0);var g=r.ccclass,w=r.property;t("CharacterAnimation",(p=g("CharacterAnimation"),f=w(s),d=w(s),p((b=e((y=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,i(e,"huangNode",b,a(e)),i(e,"liRouNode",v,a(e)),e.initialPositions=new Map,e}n(e,t);var o=e.prototype;return o.start=function(){this.initialPositions.set("黄超雄",this.huangNode.position.clone()),this.initialPositions.set("李柔",this.liRouNode.position.clone()),this.liRouNode.setPosition(0,1762)},o.playAnimation=function(t,e,n){void 0===n&&(n=.5);var i=this.getCharacterNode(t);i&&(Array.isArray(e)?this.playComboAnimation(i,t,e,n):this.playSingleAnimation(i,t,e,n))},o.playComboAnimation=function(t,e,n,i){var a=this,o=c(t),r=[],s=[];n.forEach((function(t){"fadeIn"===t||"fadeOut"===t?r.push(t):s.push(t)}));var l={};s.forEach((function(t){switch(t){case"moveIn":var n=a.initialPositions.get(e);n&&(l.position=n);break;case"scaleUp":l.scale=new u(1.5,1.5,1);break;case"scaleDown":l.scale=new u(1.2,1.2,1);break;case"rotate":l.angle=360}})),Object.keys(l).length>0&&o.to(i,l).start(),r.forEach((function(e){"fadeIn"===e?a.fadeIn(t,i):"fadeOut"===e&&a.fadeOut(t,i)}))},o.playSingleAnimation=function(t,e,n,i){switch(n){case"fadeIn":this.fadeIn(t,i);break;case"fadeOut":this.fadeOut(t,i);break;case"moveIn":this.moveIn(t,e,i);break;case"shake":this.shake(t,i);break;case"jump":this.jump(t,i);break;case"scaleUp":this.scale(t,new u(1,1,1),i);break;case"scaleDown":this.scale(t,new u(1.2,1.2,1),i)}},o.getCharacterNode=function(t){switch(t){case"黄超雄":return this.huangNode;case"李柔":return this.liRouNode;default:return null}},o.fadeIn=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),n.opacity=0,c(n).to(e,{opacity:255}).start()},o.fadeOut=function(t,e){var n=t.getComponent(l);n||(n=t.addComponent(l)),c(n).to(e,{opacity:0}).start()},o.moveIn=function(t,e,n){var i=this.initialPositions.get(e);i&&c(t).to(n,{position:i}).start()},o.shake=function(t,e){for(var n=t.position.clone(),i=c(t),a=0;a<5;a++){var o=10*(Math.random()-.5),r=10*(Math.random()-.5);i=i.to(e/5,{position:new u(n.x+o,n.y+r,0)})}i.to(.1,{position:n}).start()},o.jump=function(t,e){c(t).by(e/2,{position:new u(0,50,0)}).by(e/2,{position:new u(0,-50,0)}).start()},o.scale=function(t,e,n){c(t).to(n,{scale:e}).start()},e}(h)).prototype,"huangNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"liRouNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=y))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueData.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"8db46z9IL9AHbbihU0woZPn","DialogueData",void 0);e("DialogueData",function(){function e(){}return e.getDialogues=function(e){switch(e){case"npc_lirou":return this.getLiRouDialogues();case"main":default:return this.getLiRouDialogues()}},e.getLiRouDialogues=function(){return[{id:"start",speaker:"李柔",text:"你要去哪？"},{id:"choice1",type:"choice",choices:[{text:"「出去走走。」",nextId:"hint1"},{text:"「不关你的事。」",nextId:"choice1_b"},{text:"（沉默）",nextId:"hint1"}]},{id:"hint1",type:"narration",text:"提示：李柔已经看见了你背着的包。"},{id:"lirou_notice",speaker:"李柔",text:"你收拾东西了。"},{speaker:"李柔",text:"你是不是想着去复仇？"},{type:"narration",text:"你没有否认。"},{id:"you_letgo",speaker:"黄超雄",text:"让开。"},{id:"lirou_warn",speaker:"李柔",text:"你知道你这样做就回不去了吗？"},{type:"narration",text:"他一步挡在你面前。"},{type:"narration",text:"那一刻，我第一次在他脸上看到害怕的神情。",highlight:!0},{speaker:"李柔",text:"黄超雄。"},{speaker:"李柔",text:"你爸妈的事，我知道你难受。"},{speaker:"李柔",text:"可你不能这样。"},{speaker:"李柔",text:"…法律会替你审判他的！",highlight:!0},{id:"choice2",type:"choice",choices:[{text:"「你根本不懂。」",nextId:"you_angry"},{text:"「你走开！」",nextId:"you_angry"},{text:"「法律有用？」",nextId:"you_angry"}]},{id:"you_angry",type:"narration",image:"image2"},{speaker:"黄超雄",text:"他是精神病！"},{speaker:"黄超雄",text:"杀了我爸妈，坐牢都不用坐！",highlight:!0},{speaker:"黄超雄",text:"你让我怎么咽得下这口气？",highlight:!0},{type:"narration",text:"你的声音越来越大。"},{id:"lirou_close",type:"narration",image:"image3"},{speaker:"李柔",text:"那你就要拿自己未来去换吗？！"},{speaker:"李柔",text:"你一走，这辈子就完了！"},{id:"choice3",type:"choice",choices:[{text:"「完了就完了。」",nextId:"you_cold"},{text:"「你给我滚远点。」",nextId:"choice3_b"},{text:"「如果是你家人，你还能这么冷静吗？」",nextId:"you_cold"}]},{id:"choice3_b",type:"narration",text:"李柔明显被刺痛。"},{speaker:"李柔",text:"你什么意思？"},{speaker:"李柔",text:"我只是不想让你后悔！"},{type:"narration",text:"他第一次语气失控。"},{id:"you_cold",speaker:"黄超雄",text:"你什么也不懂。"},{speaker:"黄超雄",text:"事情没发生在你身上，你只是站着说话不腰疼而已。"},{speaker:"李柔",text:"所以你就选择堕落下去？"},{speaker:"李柔",text:"也许，我看错你了。",highlight:!0},{speaker:"黄超雄",text:"这是我的事。"},{speaker:"黄超雄",text:"别管我。"},{id:"choice4",type:"choice",choices:[{text:"「让开。」",nextId:"ending"},{text:"「别再来找我。」",nextId:"ending"},{text:"「我们已经不是一路人了。」",nextId:"ending"}]},{id:"ending",type:"narration",image:"image4"},{type:"narration",text:"我背着包，从他身边走过去。"},{type:"narration",text:"他没有拦我。"},{type:"narration",text:"也没有再叫我的名字。"}]},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/DialogueManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueData.ts","./CharacterAnimation.ts"],(function(i){var e,t,n,a,o,r,s,h,l,u,c,g,d,f,p,v,C,m,b,I,y;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,n=i.initializerDefineProperty,a=i.assertThisInitialized},function(i){o=i.cclegacy,r=i._decorator,s=i.Node,h=i.Label,l=i.RichText,u=i.SpriteFrame,c=i.Sprite,g=i.Prefab,d=i.UIOpacity,f=i.tween,p=i.instantiate,v=i.UITransform,C=i.Color,m=i.Button,b=i.Component},function(i){I=i.DialogueData},function(i){y=i.CharacterAnimation}],execute:function(){var x,w,D,k,A,T,E,U,N,S,B,z,R,O,L,M,P,_,H,F,j,K,Q,V,W,Y,q,G,J,X,Z,$,ii,ei,ti;o._RF.push({},"6de0bjbfp1N05Yh6Qf54/OA","DialogueManager",void 0);var ni=r.ccclass,ai=r.property;i("DialogueManager",(x=ni("DialogueManager"),w=ai(s),D=ai(h),k=ai(l),A=ai(s),T=ai(s),E=ai(s),U=ai(u),N=ai(u),S=ai(u),B=ai(u),z=ai(s),R=ai(c),O=ai({type:[u],tooltip:"插图列表"}),L=ai(s),M=ai(g),P=ai(y),x((F=e((H=function(i){function e(){for(var e,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return e=i.call.apply(i,[this].concat(o))||this,n(e,"dialogueUI",F,a(e)),n(e,"speakerLabel",j,a(e)),n(e,"contentRichText",K,a(e)),n(e,"speakerAvatar",Q,a(e)),n(e,"background",V,a(e)),n(e,"dialogueNextButton",W,a(e)),n(e,"huangAvatar",Y,a(e)),n(e,"liRouAvatar",q,a(e)),n(e,"custumerAvatar",G,a(e)),n(e,"youAvatar",J,a(e)),n(e,"imageContainer",X,a(e)),n(e,"imageDisplay",Z,a(e)),n(e,"images",$,a(e)),n(e,"choiceContainer",ii,a(e)),n(e,"choiceButtonPrefab",ei,a(e)),n(e,"animationManager",ti,a(e)),e.currentIndex=0,e.dialogues=[],e.dialogueMap=new Map,e.isTyping=!1,e.typingScheduleId=null,e.canProceed=!1,e.isDialogueActive=!1,e.onDialogueEndCallback=null,e.isClickCooldown=!1,e.isShowingChoice=!1,e}t(e,i);var o=e.prototype;return o.start=function(){this.hideAll()},o.onDestroy=function(){this.unscheduleAllCallbacks(),this.removeClickListener()},o.hideAll=function(){this.dialogueUI&&(this.dialogueUI.active=!1),this.dialogueNextButton&&(this.dialogueNextButton.active=!1),this.imageContainer&&(this.imageContainer.active=!1),this.choiceContainer&&(this.choiceContainer.active=!1)},o.startDialogue=function(i,e){if(this.isDialogueActive)console.warn("[Dialogue] 对话已在进行中");else{if(this.isDialogueActive=!0,this.onDialogueEndCallback=e,this.isShowingChoice=!1,this.dialogues=I.getDialogues(i),0===this.dialogues.length)return console.warn("[Dialogue] 没有对话数据"),void this.endDialogue();this.buildDialogueMap(),this.currentIndex=0,this.addClickListener(),this.showCurrentEntry(),console.log("[Dialogue] 对话开始")}},o.buildDialogueMap=function(){this.dialogueMap.clear();for(var i=0;i<this.dialogues.length;i++){var e=this.dialogues[i];e.id&&this.dialogueMap.set(e.id,i)}},o.getIsDialogueActive=function(){return this.isDialogueActive},o.forceEndDialogue=function(){this.isDialogueActive&&this.endDialogue()},o.addClickListener=function(){this.background&&this.background.on(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.on(s.EventType.TOUCH_END,this.onNextClick,this),this.imageContainer&&this.imageContainer.on(s.EventType.TOUCH_END,this.onNextClick,this)},o.removeClickListener=function(){this.background&&this.background.off(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.off(s.EventType.TOUCH_END,this.onNextClick,this),this.imageContainer&&this.imageContainer.off(s.EventType.TOUCH_END,this.onNextClick,this)},o.onNextClick=function(){var i=this;!this.isDialogueActive||this.isClickCooldown||this.isShowingChoice||(this.isClickCooldown=!0,this.scheduleOnce((function(){i.isClickCooldown=!1}),.2),this.isTyping?(this.unschedule(this.typingScheduleId),this.showFullText(),this.isTyping=!1,this.canProceed=!1,this.scheduleOnce((function(){i.canProceed=!0,i.showDialogueNextButton()}),.1)):this.canProceed&&(this.canProceed=!1,this.goToNextEntry()))},o.fadeOutDialogueUIThen=function(i){var e=this;if(this.dialogueUI&&this.dialogueUI.active){var t=this.dialogueUI.getComponent(d);t?f(t).to(.2,{opacity:0}).call((function(){e.dialogueUI.active=!1,e.contentRichText.string="",e.speakerLabel.string="",i()})).start():(this.dialogueUI.active=!1,this.contentRichText.string="",this.speakerLabel.string="",i())}else i()},o.showCurrentEntry=function(){var i=this;if(this.currentIndex>=this.dialogues.length)this.endDialogue();else{var e=this.dialogues[this.currentIndex],t=e.type||"dialogue";switch(this.hideDialogueNextButton(),t){case"choice":this.fadeOutDialogueUIThen((function(){i.hideImage(),i.showChoices(e.choices)}));break;case"narration":this.hideChoices(),e.image?this.fadeOutDialogueUIThen((function(){i.showImage(e.image,e.text)})):(this.hideImage(),this.showNarration(e.text,e.highlight));break;case"dialogue":default:this.hideChoices(),e.image?this.fadeOutDialogueUIThen((function(){i.showImage(e.image,e.text)})):(this.hideImage(),this.showDialogue(e))}e.animation&&this.animationManager&&this.animationManager.playAnimation(e.animation.character,e.animation.action,e.animation.duration)}},o.goToNextEntry=function(){var i=this.dialogues[this.currentIndex];if(i.nextId){var e=this.dialogueMap.get(i.nextId);void 0!==e?this.currentIndex=e:this.currentIndex++}else this.currentIndex++;this.showCurrentEntry()},o.showDialogue=function(i){var e=this;this.dialogueUI&&(this.speakerLabel.string=i.speaker||"",this.speakerAvatar&&(this.speakerAvatar.active=!0,this.updateSpeakerAvatar(i.speaker)),this.dialogueUI.active?this.typewriterEffect(i.text,i.highlight):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){e.typewriterEffect(i.text,i.highlight)}))))},o.showNarration=function(i,e){var t=this;this.dialogueUI&&(this.speakerLabel.string="",this.speakerAvatar&&(this.speakerAvatar.active=!1),this.dialogueUI.active?this.typewriterEffect(i,e):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){t.typewriterEffect(i,e)}))))},o.hideDialogueUI=function(){if(this.dialogueUI){this.dialogueUI.active=!1,this.contentRichText.string="",this.speakerLabel.string="";var i=this.dialogueUI.getComponent(d);i&&(i.opacity=255)}},o.updateSpeakerAvatar=function(i){var e,t=null==(e=this.speakerAvatar)?void 0:e.getComponent(c);if(t)switch(i){case"黄超雄":t.spriteFrame=this.huangAvatar;break;case"李柔":t.spriteFrame=this.liRouAvatar;break;case"你":t.spriteFrame=this.youAvatar||this.huangAvatar;break;default:t.spriteFrame=this.custumerAvatar}},o.showImage=function(i,e){var t=this;if(this.imageContainer&&this.imageDisplay){var n=this.getImageIndex(i);n>=0&&n<this.images.length&&(this.imageDisplay.spriteFrame=this.images[n]),this.imageContainer.active=!0,this.fadeIn(this.imageContainer,(function(){t.canProceed=!0,t.showDialogueNextButton()}))}},o.getImageIndex=function(i){var e=i.match(/image(\d+)/);return e?parseInt(e[1])-1:-1},o.hideImage=function(){this.imageContainer&&(this.imageContainer.active=!1)},o.showChoices=function(i){var e=this;this.choiceContainer&&i&&0!==i.length&&(this.isShowingChoice=!0,this.choiceContainer.removeAllChildren(),i.forEach((function(i,t){e.createChoiceButton(i,t)})),this.choiceContainer.active=!0,this.fadeIn(this.choiceContainer))},o.createChoiceButton=function(i,e){var t,n=this;if((t=this.choiceButtonPrefab?p(this.choiceButtonPrefab):this.createDefaultButton(i.text,e)).parent=this.choiceContainer,this.choiceButtonPrefab){var a=t.getComponentInChildren(h);a&&(a.string=i.text)}t.on(s.EventType.TOUCH_END,(function(){n.onChoiceSelected(i)}),this)},o.createDefaultButton=function(i,e){var t=new s("Choice_"+e);t.addComponent(v).setContentSize(500,60),t.addComponent(c).color=new C(50,50,50,200);var n=t.addComponent(m);n.transition=m.Transition.SCALE,n.zoomScale=.95;var a=new s("Label");a.parent=t,a.addComponent(v).setContentSize(480,50);var o=a.addComponent(h);return o.string=i,o.fontSize=28,o.color=C.WHITE,o.horizontalAlign=h.HorizontalAlign.CENTER,o.verticalAlign=h.VerticalAlign.CENTER,o.overflow=h.Overflow.SHRINK,t},o.onChoiceSelected=function(i){if(console.log("[Dialogue] 选择: "+i.text),this.isShowingChoice=!1,this.hideChoices(),i.nextId){var e=this.dialogueMap.get(i.nextId);if(void 0!==e)return this.currentIndex=e,void this.showCurrentEntry()}this.currentIndex++,this.showCurrentEntry()},o.hideChoices=function(){this.choiceContainer&&(this.choiceContainer.active=!1,this.choiceContainer.removeAllChildren()),this.isShowingChoice=!1},o.typewriterEffect=function(i,e){var t=this;this.typingScheduleId&&this.unschedule(this.typingScheduleId),this.isTyping=!0,this.canProceed=!1,this.contentRichText.string="";var n=e?"<b>"+i+"</b>":i,a=0,o=function i(){if(a<n.length){if("<"===n[a]){var e=n.indexOf(">",a);if(-1!==e)return t.contentRichText.string+=n.substring(a,e+1),void(a=e+1)}t.contentRichText.string+=n[a],a++}else t.isTyping=!1,t.unschedule(i),t.scheduleOnce((function(){t.canProceed=!0,t.showDialogueNextButton()}),.1)};this.typingScheduleId=o,this.schedule(o,.05)},o.showFullText=function(){var i=this.dialogues[this.currentIndex];if(i&&i.text){var e=i.highlight?"<b>"+i.text+"</b>":i.text;this.contentRichText.string=e}},o.showDialogueNextButton=function(){this.dialogueNextButton&&!this.isShowingChoice&&(this.dialogueNextButton.active=!0)},o.hideDialogueNextButton=function(){this.dialogueNextButton&&(this.dialogueNextButton.active=!1)},o.fadeIn=function(i,e){var t=i.getComponent(d);t||(t=i.addComponent(d)),t.opacity=0,i.active=!0,f(t).to(.3,{opacity:255}).call((function(){null==e||e()})).start()},o.endDialogue=function(){console.log("[Dialogue] 对话结束"),this.isDialogueActive=!1,this.isShowingChoice=!1,this.removeClickListener(),this.hideAll(),this.onDialogueEndCallback&&(this.onDialogueEndCallback(),this.onDialogueEndCallback=null)},e}(b)).prototype,"dialogueUI",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(H.prototype,"speakerLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(H.prototype,"contentRichText",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=e(H.prototype,"speakerAvatar",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(H.prototype,"background",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(H.prototype,"dialogueNextButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=e(H.prototype,"huangAvatar",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(H.prototype,"liRouAvatar",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(H.prototype,"custumerAvatar",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=e(H.prototype,"youAvatar",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=e(H.prototype,"imageContainer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=e(H.prototype,"imageDisplay",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=e(H.prototype,"images",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ii=e(H.prototype,"choiceContainer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ei=e(H.prototype,"choiceButtonPrefab",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ti=e(H.prototype,"animationManager",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=H))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AfterOrderSceneController.ts","./CharacterAnimation.ts","./DialogueData.ts","./DialogueManager.ts","./StreetWalkController.ts","./WalkAnimationController.ts","./OrderGameManager.ts","./Chapter1OpeningController.ts","./Scene1_Controller.ts","./Scene1_DialogueData.ts","./Scene1_DialogueManager.ts","./Scene1_UIController.ts","./Scene1_WalkController.ts","./SceneManager.ts","./StartSceneController.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/OrderGameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,r,o,a,s,c,u,l,d,h,g,f,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.initializerDefineProperty,i=e.inheritsLoose,r=e.createForOfIteratorHelperLoose,o=e.assertThisInitialized},function(e){a=e.cclegacy,s=e._decorator,c=e.Node,u=e.RichText,l=e.UIOpacity,d=e.tween,h=e.randomRangeInt,g=e.director,f=e.Vec3,p=e.Component}],execute:function(){var m,y,v,I,b,O,k,x,B,T,N,w,S,C,R,G,D,E,z,M,U,F,_,A,P,L,W,H,Y,V,j,J,q,K,Q,X,Z,$,ee,te,ne,ie;a._RF.push({},"4dcba163MJFIq9JdYN3/y7e","OrderGameManager",void 0);var re=s.ccclass,oe=s.property,ae=(m=re("IngredientButton"),y=oe(c),v=oe({tooltip:"配料名称"}),I=oe(c),m((k=t((O=function(){n(this,"node",k,this),n(this,"ingredientName",x,this),n(this,"checkMark",B,this)}).prototype,"node",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(O.prototype,"ingredientName",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),B=t(O.prototype,"checkMark",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=O))||b);e("OrderGameManager",(T=re("OrderGameManager"),N=oe(u),w=oe(c),S=oe(c),C=oe({tooltip:"下一个场景名称"}),R=oe({tooltip:"场景淡入时长（秒）"}),G=oe(c),D=oe({type:[ae],tooltip:"配料按钮列表"}),E=oe({tooltip:"游戏开始延迟（秒）"}),z=oe({tooltip:"最少配料数"}),M=oe({tooltip:"最多配料数"}),U=oe({tooltip:"总订单数"}),F=oe({tooltip:"打字速度（秒/字）"}),_=oe({tooltip:"淡入淡出时长（秒）"}),A=oe({tooltip:"场景过渡时长（秒）"}),P=oe({tooltip:"配料高亮颜色（十六进制，如 FF6600）"}),T((H=t((W=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"orderRichText",H,o(t)),n(t,"orderBackground",Y,o(t)),n(t,"sceneTransition",V,o(t)),n(t,"nextSceneName",j,o(t)),n(t,"sceneEnterDuration",J,o(t)),n(t,"ingredientButtonsContainer",q,o(t)),n(t,"ingredientButtons",K,o(t)),n(t,"gameStartDelay",Q,o(t)),n(t,"minIngredients",X,o(t)),n(t,"maxIngredients",Z,o(t)),n(t,"totalOrders",$,o(t)),n(t,"typingSpeed",ee,o(t)),n(t,"fadeDuration",te,o(t)),n(t,"transitionDuration",ne,o(t)),n(t,"highlightColor",ie,o(t)),t.INGREDIENT_POOL=["豆腐串","酸笋","青菜","炸蛋","猪脚","鸡脚"],t.state="READY",t.currentOrderIndex=0,t.currentIngredients=[],t.clickedIngredients=new Set,t.typingScheduleId=null,t}i(t,e);var a=t.prototype;return a.start=function(){var e=this;this.initUI(),this.bindEvents(),this.playSceneEnter((function(){e.scheduleOnce((function(){e.startGame()}),e.gameStartDelay)}))},a.onDestroy=function(){this.unscheduleAllCallbacks(),this.typingScheduleId&&(this.unschedule(this.typingScheduleId),this.typingScheduleId=null),this.unbindEvents()},a.initUI=function(){this.orderBackground&&(this.setOpacity(this.orderBackground,0),this.orderBackground.active=!1),this.orderRichText&&(this.orderRichText.string="");for(var e,t=r(this.ingredientButtons);!(e=t()).done;){var n=e.value;n.checkMark&&(n.checkMark.active=!1)}this.hideIngredientButtons(),this.sceneTransition&&(this.sceneTransition.active=!0,this.setOpacity(this.sceneTransition,255))},a.bindEvents=function(){var e=this;if(this.ingredientButtons)for(var t,n=function(){var n=t.value;n&&n.node&&n.node.isValid&&n.node.on(c.EventType.TOUCH_END,(function(){e.onIngredientClick(n)}),e)},i=r(this.ingredientButtons);!(t=i()).done;)n()},a.unbindEvents=function(){if(this.ingredientButtons)for(var e,t=r(this.ingredientButtons);!(e=t()).done;){var n=e.value;n&&n.node&&n.node.isValid&&n.node.off(c.EventType.TOUCH_END)}},a.playSceneEnter=function(e){var t=this;if(this.sceneTransition){var n=this.sceneTransition.getComponent(l);n||(n=this.sceneTransition.addComponent(l)),n.opacity=255,d(n).to(this.sceneEnterDuration,{opacity:0},{easing:"sineOut"}).call((function(){t.sceneTransition.active=!1,console.log("[OrderGame] 场景淡入完成"),null==e||e()})).start()}else null==e||e()},a.startGame=function(){console.log("[OrderGame] 游戏开始"),this.currentOrderIndex=0,this.state="RUNNING",this.orderBackground&&(this.orderBackground.active=!0),this.nextOrder()},a.nextOrder=function(){var e=this;if(this.currentOrderIndex++,this.currentOrderIndex>this.totalOrders)this.onGameWin();else{this.currentIngredients=this.generateRandomIngredients(),this.clickedIngredients.clear(),this.resetIngredientButtons();var t=this.formatOrderText(this.currentIngredients);1==this.currentOrderIndex?this.fadeInBackground((function(){e.typewriterEffect(t,(function(){e.showIngredientButtons((function(){e.state="RUNNING"}))}))})):this.fadeInBackground((function(){e.typewriterEffect(t,(function(){e.state="RUNNING"}))})),console.log("[OrderGame] 第 "+this.currentOrderIndex+" 单:",this.currentIngredients)}},a.generateRandomIngredients=function(){for(var e=this.INGREDIENT_POOL.slice(),t=h(this.minIngredients,this.maxIngredients+1),n=[],i=0;i<t;i++){var r=h(0,e.length);n.push(e.splice(r,1)[0])}return n},a.formatOrderText=function(e){var t=this;return"老板，来一份加"+e.map((function(e){return"<color=#"+t.highlightColor+"><b>"+e+"</b></color>"})).join("<color=#000000>、</color>")+"的螺蛳粉！"},a.resetIngredientButtons=function(){for(var e,t=r(this.ingredientButtons);!(e=t()).done;){var n=e.value;n.checkMark&&(n.checkMark.active=!1)}},a.onIngredientClick=function(e){if("RUNNING"===this.state){var t=e.ingredientName;-1!==this.currentIngredients.indexOf(t)?this.clickedIngredients.has(t)||(this.clickedIngredients.add(t),e.checkMark&&(e.checkMark.active=!0),this.playCorrectAnimation(e.node),this.checkOrderComplete()):this.playWrongAnimation(e.node)}},a.checkOrderComplete=function(){var e=this;this.currentIngredients.every((function(t){return e.clickedIngredients.has(t)}))&&this.onOrderComplete()},a.onOrderComplete=function(){var e=this;console.log("[OrderGame] 第 "+this.currentOrderIndex+" 单完成！"),this.state="TYPING",this.fadeOutBackground((function(){e.scheduleOnce((function(){e.nextOrder()}),.3)}))},a.showIngredientButtons=function(e){var t=0,n=this.ingredientButtons.length;if(0!==n)for(var i,o=r(this.ingredientButtons);!(i=o()).done;){var a=i.value;if(a&&a.node){a.node.active=!0;var s=a.node.getComponent(l);s||(s=a.node.addComponent(l)),s.opacity=0,d(s).to(.3,{opacity:255},{easing:"sineOut"}).call((function(){++t>=n&&(null==e||e())})).start()}else++t>=n&&(null==e||e())}else null==e||e()},a.hideIngredientButtons=function(){for(var e,t=r(this.ingredientButtons);!(e=t()).done;){var n=e.value;n&&n.node&&(this.setOpacity(n.node,0),n.node.active=!1)}},a.onGameWin=function(){var e=this;console.log("[OrderGame] 游戏胜利！"),this.state="WIN",this.fadeOutBackground((function(){e.transitionToNextScene()}))},a.transitionToNextScene=function(){var e=this;if(!this.sceneTransition)return console.log("[OrderGame] 切换到场景: "+this.nextSceneName),void g.loadScene(this.nextSceneName);this.sceneTransition.active=!0;var t=this.sceneTransition.getComponent(l);t||(t=this.sceneTransition.addComponent(l)),t.opacity=0,d(t).to(this.transitionDuration,{opacity:255},{easing:"sineIn"}).call((function(){console.log("[OrderGame] 切换到场景: "+e.nextSceneName),g.loadScene(e.nextSceneName)})).start()},a.typewriterEffect=function(e,t){var n=this;this.typingScheduleId&&(this.unschedule(this.typingScheduleId),this.typingScheduleId=null),this.state="TYPING",this.orderRichText.string="";var i=0,r=function r(){if(i<e.length){if("<"===e[i]){var o=e.indexOf(">",i);if(-1!==o)return n.orderRichText.string+=e.substring(i,o+1),void(i=o+1)}n.orderRichText.string+=e[i],i++}else n.unschedule(r),n.typingScheduleId=null,null==t||t()};this.typingScheduleId=r,this.schedule(r,this.typingSpeed)},a.fadeInBackground=function(e){if(this.orderBackground){this.orderRichText&&(this.orderRichText.string=""),this.orderBackground.active=!0;var t=this.orderBackground.getComponent(l);t||(t=this.orderBackground.addComponent(l)),t.opacity=0,d(t).to(this.fadeDuration,{opacity:255},{easing:"sineOut"}).call((function(){null==e||e()})).start()}else null==e||e()},a.fadeOutBackground=function(e){var t=this;if(this.orderBackground){var n=this.orderBackground.getComponent(l);n||((n=this.orderBackground.addComponent(l)).opacity=255),d(n).to(this.fadeDuration,{opacity:0},{easing:"sineIn"}).call((function(){t.orderRichText&&(t.orderRichText.string=""),null==e||e()})).start()}else null==e||e()},a.setOpacity=function(e,t){var n=e.getComponent(l);n||(n=e.addComponent(l)),n.opacity=t},a.playCorrectAnimation=function(e){var t=e.scale.clone();d(e).to(.1,{scale:new f(1.2,1.2,1)}).to(.1,{scale:t}).start()},a.playWrongAnimation=function(e){var t=e.position.clone();d(e).to(.05,{position:new f(t.x-10,t.y,0)}).to(.05,{position:new f(t.x+10,t.y,0)}).to(.05,{position:new f(t.x-10,t.y,0)}).to(.05,{position:t}).start()},t}(p)).prototype,"orderRichText",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(W.prototype,"orderBackground",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(W.prototype,"sceneTransition",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(W.prototype,"nextSceneName",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Scene1"}}),J=t(W.prototype,"sceneEnterDuration",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q=t(W.prototype,"ingredientButtonsContainer",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(W.prototype,"ingredientButtons",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=t(W.prototype,"gameStartDelay",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),X=t(W.prototype,"minIngredients",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Z=t(W.prototype,"maxIngredients",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),$=t(W.prototype,"totalOrders",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),ee=t(W.prototype,"typingSpeed",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),te=t(W.prototype,"fadeDuration",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ne=t(W.prototype,"transitionDuration",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ie=t(W.prototype,"highlightColor",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"FF6600"}}),L=W))||L));a._RF.pop()}}}));

System.register("chunks:///_virtual/Scene1_Controller.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Scene1_DialogueManager.ts","./Scene1_WalkController.ts"],(function(e){var n,t,i,o,a,r,l,s,u,c,p,g;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){a=e.cclegacy,r=e._decorator,l=e.Node,s=e.UIOpacity,u=e.tween,c=e.Component},function(e){p=e.DialogueManager},function(e){g=e.Scene1WalkController}],execute:function(){var h,f,d,y,b,C,S,w,R,m,k,v,N,D,Y,z,A,M,P,B,O,T,_,E,I,X,x,F,L,U,q,W,j;a._RF.push({},"849aaJahhhDnqbm1AfUI62K","Scene1_Controller",void 0);var G=r.ccclass,H=r.property;e("Scene1Controller",(h=G("Scene1Controller"),f=H(p),d=H({tooltip:"CG 停留时长（秒）"}),y=H(g),b=H({tooltip:"李柔出现淡入时长（秒）"}),C=H(l),S=H(l),w=H({tooltip:"场景淡入时长（秒）"}),R=H(l),m=H(l),k=H({tooltip:"Chapter 1 结束后杨洋洋的位置 X"}),v=H({tooltip:"Chapter 1 结束后杨洋洋的位置 Y"}),N=H({tooltip:"闪烁时长（秒）"}),D=H({tooltip:"李柔入场目标位置 X"}),Y=H({tooltip:"李柔入场目标位置 Y"}),z=H({tooltip:"李柔移动速度"}),h((P=n((M=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return n=e.call.apply(e,[this].concat(a))||this,i(n,"dialogueManager",P,o(n)),i(n,"cgStayDuration",B,o(n)),i(n,"walkController",O,o(n)),i(n,"liRouAppearDuration",T,o(n)),i(n,"sceneBackground",_,o(n)),i(n,"sceneTransition",E,o(n)),i(n,"sceneEnterDuration",I,o(n)),i(n,"liRouNode",X,o(n)),i(n,"yangYangNode",x,o(n)),i(n,"yangYangNewPosX",F,o(n)),i(n,"yangYangNewPosY",L,o(n)),i(n,"flashDuration",U,o(n)),i(n,"liRouEnterPosX",q,o(n)),i(n,"liRouEnterPosY",W,o(n)),i(n,"liRouMoveSpeed",j,o(n)),n.liRouOriginalScale=null,n}t(n,e);var a=n.prototype;return a.start=function(){this.liRouNode&&(this.liRouOriginalScale=this.liRouNode.scale.clone(),console.log("[Scene1] 保存李柔原始 scale.x="+this.liRouOriginalScale.x)),this.registerDialogueActions(),this.initUI(),this.playSceneEnter()},a.onDestroy=function(){this.dialogueManager&&(this.dialogueManager.unregisterAction("flash_transition"),this.dialogueManager.unregisterAction("lirou_appear"))},a.registerDialogueActions=function(){var e=this;this.dialogueManager&&(this.dialogueManager.registerAction("flash_transition",(function(n){e.playFlashTransition(n)})),this.dialogueManager.registerAction("lirou_appear",(function(n){e.playLiRouAppear(n)})))},a.playLiRouAppear=function(e){var n=this;this.dialogueManager.hideDialogueUI((function(){console.log("[Scene1] 对话框已关闭，开始淡入李柔"),n.fadeInLiRou((function(){console.log("[Scene1] 李柔淡入完成"),null==e||e()}))}))},a.fadeInLiRou=function(e){if(this.liRouNode){this.liRouOriginalScale&&this.liRouNode.setScale(this.liRouOriginalScale);var n=this.liRouNode.getComponent(s);n||(n=this.liRouNode.addComponent(s)),n.opacity=0,this.liRouNode.active=!0,this.walkController&&this.walkController.refreshAllScales(),console.log("[Scene1] 李柔开始淡入，scale.x="+this.liRouNode.scale.x),u(n).to(this.liRouAppearDuration,{opacity:255},{easing:"sineOut"}).call((function(){null==e||e()})).start()}else null==e||e()},a.initUI=function(){this.sceneBackground&&(this.sceneBackground.active=!1),this.sceneTransition&&(this.sceneTransition.active=!0,this.setOpacity(this.sceneTransition,255)),this.walkController&&this.walkController.setTouchEnabled(!1)},a.playSceneEnter=function(){var e=this;this.fadeFromBlack((function(){e.playOpeningSequence()}))},a.playOpeningSequence=function(){var e=this;this.showSceneBackground((function(){e.playSceneDialogue()}))},a.showSceneBackground=function(e){if(this.sceneBackground){this.setOpacity(this.sceneBackground,0),this.sceneBackground.active=!0;var n=this.sceneBackground.getComponent(s);n||(n=this.sceneBackground.addComponent(s)),u(n).to(.8,{opacity:255},{easing:"sineOut"}).call((function(){console.log("[Scene1] 场景背景显示完成"),null==e||e()})).start()}else null==e||e()},a.playSceneDialogue=function(){var e=this;this.dialogueManager.startDialogue("chapter1_scene",(function(){console.log("[Scene1] 场景对话结束"),e.onChapter1Complete()}))},a.onChapter1Complete=function(){console.log("[Scene1] Chapter 1 完成"),this.startChapter2()},a.playFlashTransition=function(e){this.applySceneChanges(),null==e||e()},a.applySceneChanges=function(){if(this.liRouNode&&this.liRouNode.setPosition(this.liRouEnterPosX,this.liRouEnterPosY,0),this.yangYangNode){var e=this.yangYangNode.scale;this.yangYangNode.setScale(-e.x,e.y,e.z),this.yangYangNode.setPosition(this.yangYangNewPosX,this.yangYangNewPosY,0)}this.walkController&&this.walkController.refreshAllScales()},a.startChapter2=function(){var e=this;console.log("[Scene1] 开始 Chapter 2"),this.dialogueManager.startDialogue("chapter2_opening",(function(){console.log("[Scene1] Chapter 2 开场对话结束"),e.onChapter2Complete()}))},a.onChapter2Complete=function(){console.log("[Scene1] Chapter 2 完成"),this.walkController.refreshAllScales(),this.walkController&&this.walkController.setTouchEnabled(!0)},a.fadeFromBlack=function(e){var n=this;if(this.sceneTransition){var t=this.sceneTransition.getComponent(s);t||(t=this.sceneTransition.addComponent(s)),t.opacity=255,u(t).to(this.sceneEnterDuration,{opacity:0},{easing:"sineOut"}).call((function(){n.sceneTransition.active=!1,null==e||e()})).start()}else null==e||e()},a.setOpacity=function(e,n){var t=e.getComponent(s);t||(t=e.addComponent(s)),t.opacity=n},n}(c)).prototype,"dialogueManager",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(M.prototype,"cgStayDuration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O=n(M.prototype,"walkController",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(M.prototype,"liRouAppearDuration",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_=n(M.prototype,"sceneBackground",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(M.prototype,"sceneTransition",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(M.prototype,"sceneEnterDuration",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),X=n(M.prototype,"liRouNode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(M.prototype,"yangYangNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(M.prototype,"yangYangNewPosX",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L=n(M.prototype,"yangYangNewPosY",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U=n(M.prototype,"flashDuration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),q=n(M.prototype,"liRouEnterPosX",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),W=n(M.prototype,"liRouEnterPosY",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j=n(M.prototype,"liRouMoveSpeed",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),A=M))||A));a._RF.pop()}}}));

System.register("chunks:///_virtual/Scene1_DialogueData.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"86d8fG1EuNBgKIHenXyJb+q","Scene1_DialogueData",void 0);t("DialogueData",function(){function t(){}return t.getDialogues=function(t){switch(t){case"chapter1_opening":return this.getChapter1OpeningDialogues();case"chapter1_scene":return this.getChapter1SceneDialogues();case"chapter2_opening":return this.getChapter2OpeningDialogues();case"npc_yangyang":return this.getYangYangDialogues();case"npc_lirou":return this.getLiRouDialogues();default:return[]}},t.getItemDescription=function(t){return null},t.getChapter1OpeningDialogues=function(){return[{id:"cg_start",type:"narration",text:""},{type:"narration",text:"他们都叫我卖螺蛳粉的黄老板。"},{type:"narration",text:"没人知道我背后的故事，也没人敢盯着我的右眼。"},{type:"narration",text:"三年前，我从监狱出来。"},{type:"narration",text:"两年前，我和妹妹一起，把这个摊子支在了我们的老家布鑫街。"},{type:"narration",text:"每天布鑫街都被慕名而来的顾客堵得水泄不通。"}]},t.getChapter1SceneDialogues=function(){return[{id:"yangyang_appear",type:"narration",text:"队伍里，一个穿花衬衫的男人朝你挥手。"},{speaker:"？？？",text:"黄超雄？"},{speaker:"黄超雄",text:"（这声音是……）",avatar:"calm"},{type:"narration",text:"回来以后也在布鑫街偶尔遇见过同学，都是远远打个招呼，点头，客气。"},{type:"narration",text:"似乎都在躲着我，不想跟我叙旧深交。"},{type:"narration",text:"没想到，两年过去了，还是头一次听到这么熟悉的声音。"},{type:"narration",text:"还能用旧语气喊出我的名字，好像我并没有彻底变成另一个人。"},{speaker:"黄超雄",text:"杨洋洋？",avatar:"calm"},{speaker:"杨洋洋",text:"黄超雄！居然真的是你！"},{speaker:"黄超雄",text:"（他还是和以前一样，没想到越来越像个算命的。）",avatar:"calm"},{speaker:"黄超雄",text:"好久不见！",avatar:"smile"},{speaker:"杨洋洋",text:"我就知道你会回来。"},{id:"choice_1",type:"choice",choices:[{text:"你还是老样子。",nextId:"choice_1_a"},{text:"少来这套，算命的老老实实排队！",nextId:"choice_1_b"},{text:"来！请你吃一碗螺蛳粉。",nextId:"choice_1_c"}]},{id:"choice_1_a",speaker:"杨洋洋",text:"你倒是变化挺大的。",nextId:"after_choice_1"},{id:"choice_1_b",speaker:"杨洋洋",text:"都是老同学，别这么见外嘛。",nextId:"after_choice_1"},{id:"choice_1_c",speaker:"杨洋洋",text:"那我就不客气了。",nextId:"after_choice_1"},{id:"after_choice_1",speaker:"黄超雄",text:"你现在在哪发财？不会真在给人算命吧？",avatar:"smile"},{speaker:"杨洋洋",text:"我也在外流浪了一段时间了。"},{speaker:"杨洋洋",text:"刚回布鑫街没多久，白天在这摆摊。"},{speaker:"杨洋洋",text:"帮人算卦，顺便看看，抓点不干净的东西。"},{speaker:"黄超雄",text:"（这家伙还是和高中一样啊，神神叨叨的。）",avatar:"calm"},{speaker:"黄超雄",text:"难怪。我在这里摆摊两年了，居然头一回遇见你。",avatar:"calm"},{speaker:"杨洋洋",text:"我也是听人说，布鑫街晚上有一个炒螺蛳粉特别好吃。"},{speaker:"杨洋洋",text:"正好下班了来尝尝，谁知道……"},{type:"narration",text:"虽然以前觉得他不太正常，但是时隔多年遇到和以前一样的高中同学的感觉还是很亲切。"},{type:"narration",text:"特别是他不像其他人那样疏远我。"},{speaker:"杨洋洋",text:"对了，这条街最近来了个新城管。"},{id:"choice_2",type:"choice",choices:[{text:"我们这的规矩，我会告诉他的。",nextId:"choice_2_a"},{text:"谁来都没用，这条街没人敢惹我的。",nextId:"choice_2_b"}]},{id:"choice_2_a",speaker:"杨洋洋",text:"那个新城管叫李柔！",nextId:"lirou_mention"},{id:"choice_2_b",speaker:"杨洋洋",text:"那个新城管叫李柔！",nextId:"lirou_mention"},{id:"lirou_mention",speaker:"黄超雄",text:"（我不敢相信，但是听他的语气很肯定，不像是骗人的。）",avatar:"sad"},{speaker:"黄超雄",text:"哪个李柔？",avatar:"sad"},{speaker:"黄超雄",text:"他不是……高中毕业就出国了吗？",avatar:"sad"},{speaker:"杨洋洋",text:"他又回来了。"},{speaker:"黄超雄",text:"你见到他了？",avatar:"sad"},{speaker:"杨洋洋",text:"白天见过了。他……"},{speaker:"黄超雄",text:"他现在怎么样？",avatar:"sad"},{type:"narration",text:"我很急，根本没有耐心听完就问下一个问题。"},{speaker:"杨洋洋",text:"他刚来就当城管队长了，厉害吧。"},{speaker:"杨洋洋",text:"我只告诉你一件事。"},{speaker:"杨洋洋",text:"今晚，他大概率会来查这条街。",highlight:!0},{speaker:"杨洋洋",text:"叫他李队，别叫他名字，记住了！"},{type:"narration",text:"我愣住了。"}]},t.getChapter2OpeningDialogues=function(){return[{id:"chapter2_start",type:"narration",text:"我内心不安地等待着。"},{type:"narration",text:"这些年我想过无数次重逢，好的、坏的、最坏的。"},{type:"narration",text:"可真到这一刻，我发现自己连第一句话都没准备好。"},{type:"narration",text:"这种感觉就像马上轮到我上台表演，灯已经亮了，但是我还没准备好。"},{type:"narration",text:"我假装很忙的样子，翻炒、装碗、找零，掩饰自己内心的不安。"},{type:"narration",text:"……"},{type:"narration",text:"人群忽然安静下来。"},{speaker:"黄超雄",text:"（来了吗？）",avatar:"sad"},{speaker:"杨洋洋",text:"来了。"},{type:"narration",text:"我和杨洋洋同时抬起头。",cgImage:"cg_3",action:"lirou_appear"},{type:"narration",text:"只见一个穿城管制服的男人走来，黑黑的身影高大挺拔，步子不急不缓。",cgImage:"cg_3"},{type:"narration",text:"我心跳加速，愣愣地看着他，他也在往我这边看。",cgImage:"cg_3"},{type:"narration",text:"他走近了。",cgImage:"cg_3"},{type:"narration",text:"他的眼神冷冷的，没有一丝柔情。",cgImage:"cg_3"},{type:"narration",text:"我竟下意识地躲开他的眼神。",cgImage:"cg_3"},{type:"narration",text:"我已经很久没有躲开过别人的眼神了。",cgImage:"cg_3"},{speaker:"黄超雄",text:"（他有认出我吗？）",avatar:"sad",cgImage:"cg_3"},{speaker:"黄超雄",text:"（不对……他怎么可能认不出。）",avatar:"sad",cgImage:"cg_3"},{type:"narration",text:"李柔走近时，我感觉到他视线极短地扫过我的右眼。",cgImage:"cg_3",action:"flash_transition"},{type:"narration",text:"只有一瞬间，下一秒，他重新摆出一副冷冷的表情。",cgImage:"cg_3",cgHide:!0},{speaker:"李柔",text:"黄老板，这里不允许摆摊。"},{speaker:"黄超雄",text:"（好久没听到他的声音了。）",avatar:"sad"},{speaker:"黄超雄",text:"（没想到这是见面的第一句话。）",avatar:"sad"},{speaker:"黄超雄",text:"李……李队，你应该知道的，布鑫街的规矩……",avatar:"sad"},{speaker:"李柔",text:"以前不管，不代表现在还能这么摆。"},{speaker:"李柔",text:"今天起，这条街我负责。"},{type:"narration",text:"李柔的目光又在我右眼上停了半拍，似乎闪过一丝复杂的情绪，随即移开。"},{type:"narration",text:"我犹豫了一下，终于忍不住，声音发紧。"},{speaker:"黄超雄",text:"李柔？",avatar:"sad"},{speaker:"黄超雄",text:"（我好希望他有一点点过去熟悉的样子。）",avatar:"sad"},{speaker:"黄超雄",text:"来吃一碗螺蛳粉吧，我请你。",avatar:"smile"},{type:"narration",text:"我几乎是抢着装了一碗，递过去。"},{type:"narration",text:"李柔看也没看。"},{type:"narration",text:"下一秒……"},{type:"narration",text:"他抬手。"},{type:"narration",text:"摊子被掀翻。",cgImage:"cg_4"},{type:"narration",text:"人群哗然。",cgImage:"cg_4"},{type:"narration",text:"那一瞬间我脑子空了。",cgImage:"cg_4"},{type:"narration",text:"李柔招手，示意同事上前。",cgImage:"cg_4"},{speaker:"李柔",text:"违规摆摊。",cgImage:"cg_4"},{speaker:"李柔",text:"收。",cgImage:"cg_4"},{type:"narration",text:"换作别人，我早就还手了。",cgImage:"cg_4"},{type:"narration",text:"可偏偏是他。",cgImage:"cg_4",cgHide:!0}]},t.getYangYangDialogues=function(){return[{speaker:"杨洋洋",text:"有什么需要帮忙的吗？"},{speaker:"黄超雄",text:"没事，你继续吃吧。"}]},t.getLiRouDialogues=function(){return[{speaker:"黄超雄",text:"李柔。"},{speaker:"李柔",text:"……"}]},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/Scene1_DialogueManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Scene1_DialogueData.ts"],(function(e){var t,i,n,a,o,l,r,s,c,u,h,g,d,f,p,C,v,m,b,I;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.createForOfIteratorHelperLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){l=e.cclegacy,r=e._decorator,s=e.Node,c=e.Label,u=e.RichText,h=e.SpriteFrame,g=e.Sprite,d=e.Prefab,f=e.UIOpacity,p=e.tween,C=e.instantiate,v=e.UITransform,m=e.Vec3,b=e.Component},function(e){I=e.DialogueData}],execute:function(){var y,k,D,P,w,x,T,E,U,B,A,N,S,O,z,G,R,_,H,F,L,M,V,Y,j,Q,q,J,K,W,X,Z,$,ee,te,ie,ne,ae,oe,le,re,se,ce,ue,he,ge,de,fe,pe,Ce,ve;l._RF.push({},"cfbc2P/xQRB+rHFfwx1OTjA","Scene1_DialogueManager",void 0);var me=r.ccclass,be=r.property;e("DialogueManager",(y=me("DialogueManager"),k=be(s),D=be(c),P=be(u),w=be(s),x=be(s),T=be(s),E=be({type:h,tooltip:"黄超雄-微笑"}),U=be({type:h,tooltip:"黄超雄-平静"}),B=be({type:h,tooltip:"黄超雄-悲伤"}),A=be({type:s,tooltip:"SceneUI 节点"}),N=be({tooltip:"CG 首次显示停留时长（秒）"}),S=be(s),O=be(g),z=be({type:[h],tooltip:"CG图像列表"}),G=be(s),R=be(s),_=be(u),H=be(u),F=be(s),L=be(d),M=be({tooltip:"选项按钮之间的间距"}),V=be(h),Y=be(h),j=be(h),y((J=t((q=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,a(t,"dialogueUI",J,o(t)),a(t,"speakerLabel",K,o(t)),a(t,"contentRichText",W,o(t)),a(t,"speakerAvatar",X,o(t)),a(t,"background",Z,o(t)),a(t,"dialogueNextButton",$,o(t)),a(t,"avatarSmile",ee,o(t)),a(t,"avatarCalm",te,o(t)),a(t,"avatarSad",ie,o(t)),a(t,"sceneUINode",ne,o(t)),a(t,"cgFirstShowDuration",ae,o(t)),a(t,"cgContainer",oe,o(t)),a(t,"cgImage",le,o(t)),a(t,"cgImages",re,o(t)),a(t,"itemPanelBackground",se,o(t)),a(t,"itemPanel",ce,o(t)),a(t,"itemTitleRichText",ue,o(t)),a(t,"itemTextRichText",he,o(t)),a(t,"choicePanel",ge,o(t)),a(t,"choiceButtonPrefab",de,o(t)),a(t,"choiceSpacing",fe,o(t)),a(t,"huangAvatar",pe,o(t)),a(t,"liRouAvatar",Ce,o(t)),a(t,"yangYangAvatar",ve,o(t)),t.actionCallbacks=new Map,t.currentIndex=0,t.dialogues=[],t.dialogueMap=new Map,t.isTyping=!1,t.typingScheduleId=null,t.canProceed=!1,t.isDialogueActive=!1,t.isItemPanelActive=!1,t.isShowingChoice=!1,t.onDialogueEndCallback=null,t.onItemPanelCloseCallback=null,t.isClickCooldown=!1,t.shownCGs=new Set,t.currentChoiceButtons=[],t.currentChoices=[],t}i(t,e);var l=t.prototype;return l.start=function(){this.hideAll(),this.bindItemPanelEvents()},l.onDestroy=function(){this.unscheduleAllCallbacks(),this.typingScheduleId&&(this.unschedule(this.typingScheduleId),this.typingScheduleId=null),this.removeClickListener(),this.unbindItemPanelEvents(),this.clearChoiceButtons()},l.hideAll=function(){this.dialogueUI&&(this.dialogueUI.active=!1),this.dialogueNextButton&&(this.dialogueNextButton.active=!1),this.itemPanelBackground&&(this.itemPanelBackground.active=!1),this.itemPanel&&(this.itemPanel.active=!1),this.cgContainer&&(this.cgContainer.active=!1),this.choicePanel&&(this.choicePanel.active=!1),this.speakerAvatar&&(this.speakerAvatar.active=!1)},l.bindItemPanelEvents=function(){this.itemPanelBackground&&this.itemPanelBackground.on(s.EventType.TOUCH_END,this.onItemPanelBackgroundClick,this),this.itemPanel&&this.itemPanel.on(s.EventType.TOUCH_END,this.onItemPanelClick,this)},l.unbindItemPanelEvents=function(){this.itemPanelBackground&&this.itemPanelBackground.isValid&&this.itemPanelBackground.off(s.EventType.TOUCH_END,this.onItemPanelBackgroundClick,this),this.itemPanel&&this.itemPanel.isValid&&this.itemPanel.off(s.EventType.TOUCH_END,this.onItemPanelClick,this)},l.onItemPanelBackgroundClick=function(){this.closeItemPanel()},l.onItemPanelClick=function(e){e.propagationStopped=!0},l.startDialogue=function(e,t){if(this.isDialogueActive||this.isItemPanelActive)console.warn("[Dialogue] 已有对话或面板在进行中");else{if(console.log("[Dialogue] startDialogue 开始, key="+e),console.log("[Dialogue] onComplete 是否存在: "+!!t),this.isDialogueActive=!0,this.isShowingChoice=!1,this.onDialogueEndCallback=t,this.dialogues=I.getDialogues(e),0===this.dialogues.length)return console.warn("[Dialogue] 没有对话数据"),void this.endDialogue();this.buildDialogueMap(),this.currentIndex=0,this.addClickListener(),this.showCurrentEntry(),console.log("[Dialogue] 对话开始"),console.log("[Dialogue] onDialogueEndCallback 已设置: "+!!this.onDialogueEndCallback)}},l.getIsDialogueActive=function(){return this.isDialogueActive},l.getIsItemPanelActive=function(){return this.isItemPanelActive},l.forceEndDialogue=function(){this.isDialogueActive&&this.endDialogue()},l.showItemPanel=function(e,t){if(this.isDialogueActive||this.isItemPanelActive)console.warn("[ItemPanel] 已有对话或面板在进行中");else{var i=I.getItemDescription(e);if(!i)return console.warn("[ItemPanel] 未找到物体数据: "+e),void(null==t||t());this.isItemPanelActive=!0,this.onItemPanelCloseCallback=t,this.itemTitleRichText&&(this.itemTitleRichText.string=i.title),this.itemTextRichText&&(this.itemTextRichText.string=i.text),this.itemPanelBackground&&(this.itemPanelBackground.active=!0,this.fadeIn(this.itemPanelBackground)),this.itemPanel&&(this.itemPanel.active=!0,this.fadeIn(this.itemPanel)),console.log("[ItemPanel] 显示物体面板: "+e)}},l.closeItemPanel=function(){var e=this;this.isItemPanelActive&&(this.fadeOut(this.itemPanel,(function(){e.itemPanel&&(e.itemPanel.active=!1)})),this.fadeOut(this.itemPanelBackground,(function(){e.itemPanelBackground&&(e.itemPanelBackground.active=!1),e.isItemPanelActive=!1,e.onItemPanelCloseCallback&&(e.onItemPanelCloseCallback(),e.onItemPanelCloseCallback=null),console.log("[ItemPanel] 面板关闭")})))},l.showCG=function(e){if(this.cgContainer&&this.cgImage){var t=this.getCGIndex(e);t<0||t>=this.cgImages.length?console.warn("[CG] 未找到CG: "+e):(this.cgImage.spriteFrame=this.cgImages[t],this.cgContainer.active||(this.cgContainer.active=!0,this.fadeIn(this.cgContainer)),console.log("[CG] 显示CG: "+e))}},l.hideDialogueUI=function(e){var t=this;this.dialogueUI&&this.dialogueUI.active?(this.hideDialogueNextButton(),this.fadeOut(this.dialogueUI,(function(){t.dialogueUI&&(t.dialogueUI.active=!1),null==e||e()}))):null==e||e()},l.showCGPublic=function(e){this.showCG(e)},l.waitForClick=function(e){var t=this,i=!1,n=function n(){i||(i=!0,t.background&&t.background.off(s.EventType.TOUCH_END,n),t.cgContainer&&t.cgContainer.off(s.EventType.TOUCH_END,n),e())};this.background&&this.background.on(s.EventType.TOUCH_END,n),this.cgContainer&&this.cgContainer.on(s.EventType.TOUCH_END,n)},l.hideCG=function(e){var t=this;if(!this.cgContainer||!this.cgContainer.active)return console.log("[CG] CG 已经隐藏或不存在"),void(null==e||e());var i=this.cgContainer.getComponent(f);if(!i)return this.cgContainer.active=!1,console.log("[CG] 隐藏CG（直接）"),void(null==e||e());p(i).to(.3,{opacity:0},{easing:"sineIn"}).call((function(){t.cgContainer.active=!1,console.log("[CG] 隐藏CG（淡出完成）"),null==e||e()})).start()},l.getCGIndex=function(e){var t=e.match(/cg_(\d+)/);return t?parseInt(t[1])-1:-1},l.showChoices=function(e){var t=this;if(e&&0!==e.length)if(this.choicePanel&&this.choiceButtonPrefab){this.isShowingChoice=!0,this.currentChoices=e,this.hideDialogueNextButton(),this.clearChoiceButtons(),this.choicePanel.active=!0;var i=C(this.choiceButtonPrefab),n=i.getComponent(v),a=n?n.height:60;i.destroy();for(var o=(e.length*a+(e.length-1)*this.choiceSpacing)/2-a/2,l=function(){var i=C(t.choiceButtonPrefab);i.parent=t.choicePanel;var n=o-r*(a+t.choiceSpacing);i.setPosition(new m(0,n,0));var l=i.getComponentInChildren(c);l&&(l.string=e[r].text);var h=i.getComponentInChildren(u);h&&(h.string=e[r].text);var g=r;i.on(s.EventType.TOUCH_END,(function(){t.onChoiceClick(g)}),t),t.currentChoiceButtons.push(i)},r=0;r<e.length;r++)l();this.fadeIn(this.choicePanel),console.log("[Dialogue] 显示 "+e.length+" 个选项")}else console.warn("[Dialogue] 选项面板或预制件未设置")},l.clearChoiceButtons=function(){for(var e,t=n(this.currentChoiceButtons);!(e=t()).done;){var i=e.value;i&&i.isValid&&(i.off(s.EventType.TOUCH_END),i.destroy())}this.currentChoiceButtons=[]},l.hideChoices=function(){this.clearChoiceButtons(),this.choicePanel&&(this.choicePanel.active=!1),this.isShowingChoice=!1,this.currentChoices=[]},l.onChoiceClick=function(e){var t=this;if(this.isShowingChoice&&!(e<0||e>=this.currentChoices.length)){var i=this.currentChoices[e],n=this.currentChoiceButtons[e];if(console.log("[Dialogue] 选择: "+i.text),this.isShowingChoice=!1,n&&n.isValid){for(var a=n.scale.clone(),o=0;o<this.currentChoiceButtons.length;o++)if(o!==e){var l=this.currentChoiceButtons[o];if(l&&l.isValid){var r=l.getComponent(f);r||(r=l.addComponent(f)),p(r).to(.15,{opacity:100}).start()}}p(n).to(.05,{scale:a}).delay(.1).call((function(){t.proceedAfterChoice(i)})).start()}else this.proceedAfterChoice(i)}},l.proceedAfterChoice=function(e){if(this.hideChoices(),e.nextId){var t=this.dialogueMap.get(e.nextId);void 0!==t?this.currentIndex=t:this.currentIndex++}else this.currentIndex++;this.showCurrentEntry()},l.buildDialogueMap=function(){this.dialogueMap.clear();for(var e=0;e<this.dialogues.length;e++){var t=this.dialogues[e];t.id&&this.dialogueMap.set(t.id,e)}},l.addClickListener=function(){this.background&&this.background.on(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.on(s.EventType.TOUCH_END,this.onNextClick,this),this.cgContainer&&this.cgContainer.active&&this.cgContainer.on(s.EventType.TOUCH_END,this.onNextClick,this)},l.removeClickListener=function(){this.background&&this.background.isValid&&this.background.off(s.EventType.TOUCH_END,this.onNextClick,this),this.dialogueUI&&this.dialogueUI.isValid&&this.dialogueUI.off(s.EventType.TOUCH_END,this.onNextClick,this),this.cgContainer&&this.cgContainer.isValid&&this.cgContainer.off(s.EventType.TOUCH_END,this.onNextClick,this)},l.onNextClick=function(){var e=this;!this.isDialogueActive||this.isClickCooldown||this.isShowingChoice||(this.isClickCooldown=!0,this.scheduleOnce((function(){e.isClickCooldown=!1}),.2),this.isTyping?(this.unschedule(this.typingScheduleId),this.showFullText(),this.isTyping=!1,this.canProceed=!1,this.scheduleOnce((function(){e.canProceed=!0,e.showDialogueNextButton()}),.1)):this.canProceed&&(this.canProceed=!1,this.goToNextEntry()))},l.showCurrentEntry=function(){var e=this;if(console.log("[Dialogue] showCurrentEntry, index="+this.currentIndex+", total="+this.dialogues.length),this.currentIndex>=this.dialogues.length)return console.log("[Dialogue] 对话结束，调用 endDialogue"),void this.endDialogue();var t=this.dialogues[this.currentIndex];if(console.log("[Dialogue] 当前条目:",t),t.action){console.log("[Dialogue] 检测到 action: "+t.action);var i=this.actionCallbacks.get(t.action);if(i)return console.log("[Dialogue] 执行 action: "+t.action),void i((function(){console.log("[Dialogue] action "+t.action+" 完成，继续显示"),e.displayCurrentEntry(t)}));console.log("[Dialogue] action "+t.action+" 未注册")}this.displayCurrentEntry(t)},l.goToNextEntry=function(){var e=this.dialogues[this.currentIndex];if(e.nextId){var t=this.dialogueMap.get(e.nextId);void 0!==t?this.currentIndex=t:this.currentIndex++}else this.currentIndex++;this.showCurrentEntry()},l.showDialogue=function(e){var t=this;this.dialogueUI&&(this.speakerLabel.string=e.speaker||"",this.updateSpeakerAvatar(e.speaker,e.avatar),this.dialogueUI.active?this.typewriterEffect(e.text,e.highlight):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){t.typewriterEffect(e.text,e.highlight)}))))},l.showNarration=function(e,t){var i=this;this.dialogueUI&&(this.speakerLabel.string="",this.speakerAvatar&&(this.speakerAvatar.active=!1),this.dialogueUI.active?this.typewriterEffect(e,t):(this.contentRichText.string="",this.dialogueUI.active=!0,this.fadeIn(this.dialogueUI,(function(){i.typewriterEffect(e,t)}))))},l.registerAction=function(e,t){this.actionCallbacks.set(e,t)},l.unregisterAction=function(e){this.actionCallbacks.delete(e)},l.displayCurrentEntry=function(e){var t=this,i=e.type||"dialogue";if(this.hideDialogueNextButton(),e.cgHide)return this.hideCG(),void this.displayEntryContent(e,i);if(e.cgImage){var n=!this.shownCGs.has(e.cgImage);if(this.showCG(e.cgImage),this.shownCGs.add(e.cgImage),n)return console.log("[CG] 首次显示 "+e.cgImage+"，隐藏UI，停留 "+this.cgFirstShowDuration+" 秒"),this.dialogueUI&&(this.dialogueUI.active=!1),this.sceneUINode&&(this.sceneUINode.active=!1),void this.scheduleOnce((function(){t.sceneUINode&&(t.sceneUINode.active=!0),t.displayEntryContent(e,i)}),this.cgFirstShowDuration)}this.displayEntryContent(e,i)},l.displayEntryContent=function(e,t){if(!e.text)return this.isTyping=!1,void(this.canProceed=!0);switch(t){case"choice":this.showChoices(e.choices);break;case"narration":this.showNarration(e.text,e.highlight);break;case"dialogue":default:this.showDialogue(e)}},l.updateSpeakerAvatar=function(e,t){if(this.speakerAvatar){var i=this.speakerAvatar.getComponent(g);if(i)switch(e){case"黄超雄":switch(this.speakerAvatar.active=!0,t){case"smile":this.avatarSmile&&(i.spriteFrame=this.avatarSmile);break;case"sad":this.avatarSad&&(i.spriteFrame=this.avatarSad);break;case"calm":default:this.avatarCalm&&(i.spriteFrame=this.avatarCalm)}break;case"李柔":i.spriteFrame=this.liRouAvatar,this.speakerAvatar.active=!0;break;case"杨洋洋":i.spriteFrame=this.yangYangAvatar,this.speakerAvatar.active=!0;break;default:this.speakerAvatar.active=!1}}},l.typewriterEffect=function(e,t){var i=this;this.typingScheduleId&&this.unschedule(this.typingScheduleId),this.isTyping=!0,this.canProceed=!1,this.contentRichText.string="";var n=t?"<b>"+e+"</b>":e,a=0,o=function e(){if(a<n.length){if("<"===n[a]){var t=n.indexOf(">",a);if(-1!==t)return i.contentRichText.string+=n.substring(a,t+1),void(a=t+1)}i.contentRichText.string+=n[a],a++}else i.isTyping=!1,i.unschedule(e),i.scheduleOnce((function(){i.canProceed=!0,i.showDialogueNextButton()}),.1)};this.typingScheduleId=o,this.schedule(o,.05)},l.showFullText=function(){var e=this.dialogues[this.currentIndex];if(e&&e.text){var t=e.highlight?"<b>"+e.text+"</b>":e.text;this.contentRichText.string=t}},l.showDialogueNextButton=function(){this.dialogueNextButton&&!this.isShowingChoice&&(this.dialogueNextButton.active=!0)},l.hideDialogueNextButton=function(){this.dialogueNextButton&&(this.dialogueNextButton.active=!1)},l.fadeIn=function(e,t){var i=e.getComponent(f);i||(i=e.addComponent(f)),i.opacity=0,e.active=!0,p(i).to(.3,{opacity:255}).call((function(){null==t||t()})).start()},l.fadeOut=function(e,t){var i=e.getComponent(f);i?p(i).to(.2,{opacity:0}).call((function(){null==t||t()})).start():null==t||t()},l.endDialogue=function(){var e=this;console.log("[Dialogue] 对话结束"),console.log("[Dialogue] ========== endDialogue 开始 =========="),console.log("[Dialogue] onDialogueEndCallback 存在: "+!!this.onDialogueEndCallback),this.isDialogueActive=!1,this.isShowingChoice=!1,this.removeClickListener(),this.hideChoices(),this.hideCG(),this.fadeOut(this.dialogueUI,(function(){var t;e.dialogueUI&&(e.dialogueUI.active=!1),e.hideDialogueNextButton(),e.contentRichText.string="",e.speakerLabel.string="",e.speakerAvatar&&(e.speakerAvatar.active=!1);var i=null==(t=e.dialogueUI)?void 0:t.getComponent(f);if(i&&(i.opacity=255),e.onDialogueEndCallback){console.log("[Dialogue] 准备调用 onDialogueEndCallback");var n=e.onDialogueEndCallback;e.onDialogueEndCallback=null,n(),console.log("[Dialogue] onDialogueEndCallback 调用完成")}else console.log("[Dialogue] onDialogueEndCallback 为空，无法调用")}))},t}(b)).prototype,"dialogueUI",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(q.prototype,"speakerLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(q.prototype,"contentRichText",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(q.prototype,"speakerAvatar",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(q.prototype,"background",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(q.prototype,"dialogueNextButton",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=t(q.prototype,"avatarSmile",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(q.prototype,"avatarCalm",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=t(q.prototype,"avatarSad",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=t(q.prototype,"sceneUINode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=t(q.prototype,"cgFirstShowDuration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),oe=t(q.prototype,"cgContainer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=t(q.prototype,"cgImage",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=t(q.prototype,"cgImages",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),se=t(q.prototype,"itemPanelBackground",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=t(q.prototype,"itemPanel",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ue=t(q.prototype,"itemTitleRichText",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),he=t(q.prototype,"itemTextRichText",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=t(q.prototype,"choicePanel",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(q.prototype,"choiceButtonPrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=t(q.prototype,"choiceSpacing",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),pe=t(q.prototype,"huangAvatar",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=t(q.prototype,"liRouAvatar",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=t(q.prototype,"yangYangAvatar",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=q))||Q));l._RF.pop()}}}));

System.register("chunks:///_virtual/Scene1_UIController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,o,e,s,r,u,a,l,c,p,h,m,f,g,b,y;return{setters:[function(t){i=t.applyDecoratedDescriptor,n=t.initializerDefineProperty,o=t.inheritsLoose,e=t.createForOfIteratorHelperLoose,s=t.assertThisInitialized},function(t){r=t.cclegacy,u=t._decorator,a=t.Node,l=t.SpriteFrame,c=t.AudioSource,p=t.AudioClip,h=t.sys,m=t.Sprite,f=t.UIOpacity,g=t.tween,b=t.Vec3,y=t.Component}],execute:function(){var d,S,v,I,B,O,C,T,k,A,L,M,P,U,_,E,w,D,z,N,H,R,V,F,x,K,Y,Z,j,q,G,J,Q,W;r._RF.push({},"fdca6ARZ0lFxZ5BxungDzPL","Scene1_UIController",void 0);var X=u.ccclass,$=u.property,tt=(d=X("SocialLinkConfig"),S=$(a),d((B=i((I=function(){n(this,"iconNode",B,this),n(this,"name",O,this),n(this,"url",C,this)}).prototype,"iconNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=i(I.prototype,"name",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C=i(I.prototype,"url",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),v=I))||v);t("Scene1_UIController",(T=X("Scene1_UIController"),k=$({type:a,tooltip:"音乐开关按钮节点"}),A=$({type:l,tooltip:"音乐开启图标"}),L=$({type:l,tooltip:"音乐关闭图标"}),M=$({type:c,tooltip:"背景音乐 AudioSource"}),P=$({type:p,tooltip:"背景音乐"}),U=$({tooltip:"背景音乐音量 (0-1)"}),_=$({tooltip:"是否自动播放背景音乐"}),E=$({type:a,tooltip:"介绍按钮节点"}),w=$({type:a,tooltip:"介绍面板"}),D=$({type:[tt],tooltip:"社交链接列表"}),z=$({type:a,tooltip:"遮罩层（点击关闭面板）"}),N=$({tooltip:"面板动画时长"}),T((V=i((R=function(t){function i(){for(var i,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return i=t.call.apply(t,[this].concat(e))||this,n(i,"musicButton",V,s(i)),n(i,"musicOnIcon",F,s(i)),n(i,"musicOffIcon",x,s(i)),n(i,"bgmAudioSource",K,s(i)),n(i,"bgmClip",Y,s(i)),n(i,"bgmVolume",Z,s(i)),n(i,"autoPlayBgm",j,s(i)),n(i,"introButton",q,s(i)),n(i,"introPanel",G,s(i)),n(i,"socialLinks",J,s(i)),n(i,"maskLayer",Q,s(i)),n(i,"panelAnimDuration",W,s(i)),i.isMusicOn=!0,i.MUSIC_KEY="game_music_enabled",i.isIntroOpen=!1,i}o(i,t);var r=i.prototype;return r.start=function(){this.initMusicState(),this.initButtons(),this.initPanels(),this.initSocialLinks(),this.ensureTopLayer(),this.autoPlayBgm&&this.playBgm()},r.ensureTopLayer=function(){this.node.parent&&this.node.setSiblingIndex(this.node.parent.children.length-1)},r.onDestroy=function(){this.removeButtonListeners(),this.removeSocialLinkListeners()},r.initMusicState=function(){var t=h.localStorage.getItem(this.MUSIC_KEY);null!==t&&(this.isMusicOn="true"===t),console.log("[UI] 音乐状态: "+(this.isMusicOn?"开启":"关闭"))},r.setupButton=function(t,i){var n=this;t&&(t.on(a.EventType.TOUCH_END,(function(o){o.propagationStopped=!0,i.call(n),console.log("[UI] 按钮点击: "+t.name)})),t.on(a.EventType.TOUCH_START,(function(t){t.propagationStopped=!0})))},r.initButtons=function(){this.setupButton(this.musicButton,this.onMusicButtonClick),this.setupButton(this.introButton,this.onIntroButtonClick),this.maskLayer&&(this.maskLayer.on(a.EventType.TOUCH_END,this.onMaskClick,this),this.maskLayer.on(a.EventType.TOUCH_START,(function(t){t.propagationStopped=!0}))),this.updateMusicButtonIcon()},r.initPanels=function(){this.introPanel&&(this.introPanel.active=!1),this.maskLayer&&(this.maskLayer.active=!1)},r.initSocialLinks=function(){for(var t,i=this,n=function(){var n=t.value;if(!n.iconNode||!n.url)return 1;n.iconNode.on(a.EventType.TOUCH_END,(function(t){t.propagationStopped=!0,i.openLink(n.url,n.name)})),n.iconNode.on(a.EventType.TOUCH_START,(function(t){t.propagationStopped=!0})),console.log("[UI] 社交链接注册: "+n.name+" -> "+n.url)},o=e(this.socialLinks);!(t=o()).done;)n()},r.removeButtonListeners=function(){for(var t=0,i=[this.musicButton,this.introButton];t<i.length;t++){var n=i[t];n&&(n.off(a.EventType.TOUCH_START),n.off(a.EventType.TOUCH_END))}this.maskLayer&&(this.maskLayer.off(a.EventType.TOUCH_END,this.onMaskClick,this),this.maskLayer.off(a.EventType.TOUCH_START)),this.introPanel&&(this.introPanel.off(a.EventType.TOUCH_START),this.introPanel.off(a.EventType.TOUCH_END))},r.removeSocialLinkListeners=function(){for(var t,i=e(this.socialLinks);!(t=i()).done;){var n=t.value;n.iconNode&&(n.iconNode.off(a.EventType.TOUCH_START),n.iconNode.off(a.EventType.TOUCH_END))}},r.onMusicButtonClick=function(){this.toggleMusic()},r.toggleMusic=function(){this.isMusicOn=!this.isMusicOn,h.localStorage.setItem(this.MUSIC_KEY,this.isMusicOn.toString()),this.updateMusicButtonIcon(),this.isMusicOn?this.playBgm():this.pauseBgm(),console.log("[UI] 音乐: "+(this.isMusicOn?"开启":"关闭"))},r.updateMusicButtonIcon=function(){if(this.musicButton){var t=this.musicButton.getComponent(m);t&&(this.isMusicOn?this.musicOnIcon&&(t.spriteFrame=this.musicOnIcon):this.musicOffIcon&&(t.spriteFrame=this.musicOffIcon))}},r.playBgm=function(){this.isMusicOn&&(this.bgmAudioSource||(this.bgmAudioSource=this.node.getComponent(c),this.bgmAudioSource||(this.bgmAudioSource=this.node.addComponent(c))),this.bgmClip&&(this.bgmAudioSource.clip=this.bgmClip),this.bgmAudioSource.loop=!0,this.bgmAudioSource.volume=this.bgmVolume,this.bgmAudioSource.playing||(this.bgmAudioSource.play(),console.log("[UI] 背景音乐播放")))},r.pauseBgm=function(){this.bgmAudioSource&&this.bgmAudioSource.playing&&(this.bgmAudioSource.pause(),console.log("[UI] 背景音乐暂停"))},r.stopBgm=function(){this.bgmAudioSource&&(this.bgmAudioSource.stop(),console.log("[UI] 背景音乐停止"))},r.openLink=function(t,i){t&&(console.log("[UI] 打开链接: "+i+" -> "+t),h.isBrowser?window.open(t,"_blank"):(h.isMobile,h.openURL(t)))},r.onIntroButtonClick=function(){this.isIntroOpen?this.closeIntroPanel():this.openIntroPanel()},r.onMaskClick=function(){this.closeIntroPanel()},r.openIntroPanel=function(){if(this.introPanel&&!this.isIntroOpen){console.log("[UI] 打开介绍面板"),this.isIntroOpen=!0,this.maskLayer&&(this.maskLayer.active=!0,this.fadeIn(this.maskLayer)),this.introPanel.active=!0,this.introPanel.setScale(.8,.8,1);var t=this.introPanel.getComponent(f);t||(t=this.introPanel.addComponent(f)),t.opacity=0,g(this.introPanel).to(this.panelAnimDuration,{scale:new b(1,1,1)},{easing:"backOut"}).start(),g(t).to(this.panelAnimDuration,{opacity:255}).start()}},r.closeIntroPanel=function(){var t=this;if(this.introPanel&&this.isIntroOpen){console.log("[UI] 关闭介绍面板");var i=this.introPanel.getComponent(f);i||(i=this.introPanel.addComponent(f)),g(this.introPanel).to(.5*this.panelAnimDuration,{scale:new b(.8,.8,1)},{easing:"backIn"}).call((function(){t.introPanel.active=!1,t.introPanel.setScale(1,1,1),i.opacity=255})).start(),g(i).to(.5*this.panelAnimDuration,{opacity:0}).start(),this.maskLayer&&this.fadeOut(this.maskLayer,(function(){t.maskLayer.active=!1})),this.isIntroOpen=!1}},r.fadeIn=function(t,i){if(t){var n=t.getComponent(f);n||(n=t.addComponent(f)),n.opacity=0,t.active=!0,g(n).to(this.panelAnimDuration,{opacity:255}).call((function(){null==i||i()})).start()}else null==i||i()},r.fadeOut=function(t,i){if(t){var n=t.getComponent(f);n?g(n).to(.5*this.panelAnimDuration,{opacity:0}).call((function(){null==i||i()})).start():null==i||i()}else null==i||i()},r.setMusicEnabled=function(t){this.isMusicOn!==t&&this.toggleMusic()},r.getMusicEnabled=function(){return this.isMusicOn},r.setBgmVolume=function(t){this.bgmVolume=Math.max(0,Math.min(1,t)),this.bgmAudioSource&&(this.bgmAudioSource.volume=this.bgmVolume)},r.playNewBgm=function(t){this.stopBgm(),this.bgmClip=t,this.playBgm()},r.isPanelOpen=function(){return this.isIntroOpen},r.setButtonVisible=function(t,i){switch(t){case"music":this.musicButton&&(this.musicButton.active=i);break;case"intro":this.introButton&&(this.introButton.active=i)}},r.setAllButtonsVisible=function(t){this.musicButton&&(this.musicButton.active=t),this.introButton&&(this.introButton.active=t)},i}(y)).prototype,"musicButton",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=i(R.prototype,"musicOnIcon",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=i(R.prototype,"musicOffIcon",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=i(R.prototype,"bgmAudioSource",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=i(R.prototype,"bgmClip",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=i(R.prototype,"bgmVolume",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),j=i(R.prototype,"autoPlayBgm",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q=i(R.prototype,"introButton",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(R.prototype,"introPanel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=i(R.prototype,"socialLinks",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=i(R.prototype,"maskLayer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=i(R.prototype,"panelAnimDuration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),H=R))||H));r._RF.pop()}}}));

System.register("chunks:///_virtual/Scene1_WalkController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Scene1_DialogueManager.ts","./WalkAnimationController.ts"],(function(t){var e,i,n,a,o,r,l,c,s,h,u,p,f,d,g,m,b,y,v,w;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty,n=t.inheritsLoose,a=t.createForOfIteratorHelperLoose,o=t.assertThisInitialized},function(t){r=t.cclegacy,l=t.Enum,c=t._decorator,s=t.Node,h=t.SpriteFrame,u=t.UIOpacity,p=t.tween,f=t.Vec3,d=t.Sprite,g=t.UITransform,m=t.Graphics,b=t.Color,y=t.Component},function(t){v=t.DialogueManager},function(t){w=t.WalkAnimationController}],execute:function(){var I,T,k,S,C,M,N,A,D,P,z,O,E,x,H,F,B,R,W,L,Y,_,U,X,K,Z,G,j,J,V,q,Q,$,tt,et,it,nt,at,ot,rt,lt,ct,st,ht,ut,pt,ft,dt,gt,mt,bt,yt,vt,wt,It,Tt,kt,St,Ct,Mt,Nt,At,Dt,Pt,zt,Ot,Et,xt,Ht,Ft,Bt,Rt,Wt,Lt,Yt,_t,Ut,Xt,Kt,Zt,Gt,jt,Jt,Vt,qt,Qt,$t,te,ee,ie,ne,ae,oe,re,le,ce,se,he,ue,pe,fe,de,ge;r._RF.push({},"1389bR54LxIxoOGtJrxdoBO","Scene1_WalkController",void 0);var me=function(t){return t[t.Panel=0]="Panel",t[t.Dialogue=1]="Dialogue",t[t.Event=2]="Event",t[t.Pickup=3]="Pickup",t}(me||{});l(me);var be=c.ccclass,ye=c.property,ve=(I=be("NpcConfig"),T=ye(s),k=ye({tooltip:"NPC 名称（用于识别）"}),S=ye({tooltip:"对话数据 key"}),C=ye({type:h,tooltip:"默认图像"}),M=ye({type:h,tooltip:"高亮图像"}),N=ye({tooltip:"碰撞范围宽度"}),A=ye({tooltip:"碰撞范围高度"}),D=ye({tooltip:"碰撞范围 X 偏移"}),P=ye({tooltip:"碰撞范围 Y 偏移"}),z=ye({tooltip:"对话距离"}),I((x=e((E=function(){i(this,"node",x,this),i(this,"name",H,this),i(this,"dialogueKey",F,this),i(this,"normalSprite",B,this),i(this,"highlightSprite",R,this),i(this,"hitWidth",W,this),i(this,"hitHeight",L,this),i(this,"hitOffsetX",Y,this),i(this,"hitOffsetY",_,this),i(this,"dialogueDistance",U,this)}).prototype,"node",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(E.prototype,"name",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"NPC"}}),F=e(E.prototype,"dialogueKey",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),B=e(E.prototype,"normalSprite",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(E.prototype,"highlightSprite",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(E.prototype,"hitWidth",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),L=e(E.prototype,"hitHeight",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1800}}),Y=e(E.prototype,"hitOffsetX",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_=e(E.prototype,"hitOffsetY",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),U=e(E.prototype,"dialogueDistance",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),O=E))||O),we=(X=be("InteractableConfig"),K=ye(s),Z=ye({tooltip:"物体名称"}),G=ye({type:me,tooltip:"交互类型"}),j=ye({tooltip:"对话数据 key（如果是对话类型）"}),J=ye({type:h,tooltip:"默认图像"}),V=ye({type:h,tooltip:"高亮图像"}),q=ye({tooltip:"碰撞范围宽度"}),Q=ye({tooltip:"碰撞范围高度"}),$=ye({tooltip:"碰撞范围 X 偏移"}),tt=ye({tooltip:"碰撞范围 Y 偏移"}),et=ye({tooltip:"交互距离（0表示不需要走过去）"}),it=ye({tooltip:"交互后是否消失"}),nt=ye({type:s,tooltip:"面板节点（编辑器中预设内容）"}),at=ye({tooltip:"Z排序Y偏移（正值=排在更后面，负值=排在更前面）"}),X((lt=e((rt=function(){i(this,"node",lt,this),i(this,"name",ct,this),i(this,"interactType",st,this),i(this,"dialogueKey",ht,this),i(this,"normalSprite",ut,this),i(this,"highlightSprite",pt,this),i(this,"hitWidth",ft,this),i(this,"hitHeight",dt,this),i(this,"hitOffsetX",gt,this),i(this,"hitOffsetY",mt,this),i(this,"interactDistance",bt,this),i(this,"destroyAfterInteract",yt,this),i(this,"panelNode",vt,this),i(this,"zOrderOffsetY",wt,this)}).prototype,"node",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(rt.prototype,"name",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Item"}}),st=e(rt.prototype,"interactType",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return me.Panel}}),ht=e(rt.prototype,"dialogueKey",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ut=e(rt.prototype,"normalSprite",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(rt.prototype,"highlightSprite",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=e(rt.prototype,"hitWidth",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),dt=e(rt.prototype,"hitHeight",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),gt=e(rt.prototype,"hitOffsetX",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mt=e(rt.prototype,"hitOffsetY",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bt=e(rt.prototype,"interactDistance",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yt=e(rt.prototype,"destroyAfterInteract",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vt=e(rt.prototype,"panelNode",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wt=e(rt.prototype,"zOrderOffsetY",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ot=rt))||ot);t("Scene1WalkController",(It=be("Scene1WalkController"),Tt=ye(s),kt=ye(s),St=ye({type:[ve],tooltip:"NPC 配置列表"}),Ct=ye({type:[we],tooltip:"可交互物体列表"}),Mt=ye({type:h,tooltip:"点击反馈圆圈图片"}),Nt=ye({tooltip:"圆圈显示时长（秒）"}),At=ye({tooltip:"圆圈初始大小"}),Dt=ye({tooltip:"左边界"}),Pt=ye({tooltip:"右边界"}),zt=ye({tooltip:"上边界（远处）"}),Ot=ye({tooltip:"下边界（近处）"}),Et=ye({tooltip:"最远处（top）的缩放乘数"}),xt=ye({tooltip:"最近处（bottom）的缩放乘数"}),Ht=ye({tooltip:"移动速度（像素/秒）"}),Ft=ye({tooltip:"是否根据移动方向翻转角色"}),Bt=ye({tooltip:"翻转动画时长（秒）"}),Rt=ye({tooltip:"NPC 翻转动画时长（秒）"}),Wt=ye({tooltip:"是否绘制可行走区域边框"}),Lt=ye({tooltip:"是否绘制碰撞区域"}),Yt=ye(v),_t=ye(w),Ut=ye({type:s,tooltip:"物体面板遮罩层"}),Xt=ye({tooltip:"面板动画时长"}),It((Gt=e((Zt=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return e=t.call.apply(t,[this].concat(a))||this,i(e,"character",Gt,o(e)),i(e,"touchArea",jt,o(e)),i(e,"npcs",Jt,o(e)),i(e,"interactables",Vt,o(e)),i(e,"clickIndicatorSprite",qt,o(e)),i(e,"clickIndicatorDuration",Qt,o(e)),i(e,"clickIndicatorScale",$t,o(e)),i(e,"leftBound",te,o(e)),i(e,"rightBound",ee,o(e)),i(e,"topBound",ie,o(e)),i(e,"bottomBound",ne,o(e)),i(e,"minScaleMultiplier",ae,o(e)),i(e,"maxScaleMultiplier",oe,o(e)),i(e,"moveSpeed",re,o(e)),i(e,"flipOnMove",le,o(e)),i(e,"flipDuration",ce,o(e)),i(e,"npcFlipDuration",se,o(e)),i(e,"debugDraw",he,o(e)),i(e,"debugDrawHitAreas",ue,o(e)),i(e,"dialogueManager",pe,o(e)),i(e,"walkAnimation",fe,o(e)),i(e,"itemMaskLayer",de,o(e)),i(e,"itemPanelAnimDuration",ge,o(e)),e.currentTween=null,e.flipTween=null,e.npcFlipTweens=new Map,e.isMoving=!1,e.isFlipping=!1,e.touchEnabled=!0,e.isFacingRight=!0,e.characterInitialScale=new f(1,1,1),e.npcInitialScales=new Map,e.npcFacingRight=new Map,e.npcFlipping=new Map,e.highlightedTarget=null,e.currentInteractTarget=null,e.clickIndicatorNode=null,e.clickIndicatorTween=null,e.opacityTween=null,e.currentItemPanel=null,e.isItemPanelOpen=!1,e}n(e,t);var r=e.prototype;return r.start=function(){this.initCharacterInfo(),this.initNpcs(),this.initInteractables(),this.initClickIndicator(),this.initItemPanels(),this.updateAllCharacters(),this.touchArea.on(s.EventType.TOUCH_END,this.onTouchEnd,this),this.debugDraw&&this.drawDebugRect(),this.debugDrawHitAreas&&this.drawAllHitAreas()},r.initItemPanels=function(){for(var t,e=this,i=a(this.interactables);!(t=i()).done;){var n=t.value;n.panelNode&&(n.panelNode.active=!1)}this.itemMaskLayer&&(this.itemMaskLayer.active=!1,this.itemMaskLayer.on(s.EventType.TOUCH_START,(function(t){t.propagationStopped=!0})),this.itemMaskLayer.on(s.EventType.TOUCH_END,(function(t){t.propagationStopped=!0,e.closeItemPanel()})))},r.showItemPanel=function(t){if(t.panelNode&&!this.isItemPanelOpen){if(console.log("[Item] 打开面板: "+t.name),this.isItemPanelOpen=!0,this.currentItemPanel=t.panelNode,this.setTouchEnabled(!1),this.itemMaskLayer){this.itemMaskLayer.active=!0;var e=this.itemMaskLayer.getComponent(u);e||(e=this.itemMaskLayer.addComponent(u)),e.opacity=0,p(e).to(this.itemPanelAnimDuration,{opacity:150}).start()}t.panelNode.active=!0,t.panelNode.setScale(.8,.8,1);var i=t.panelNode.getComponent(u);i||(i=t.panelNode.addComponent(u)),i.opacity=0,t.panelNode.on(s.EventType.TOUCH_START,this.onItemPanelTouch,this),t.panelNode.on(s.EventType.TOUCH_END,this.onItemPanelTouch,this),p(t.panelNode).to(this.itemPanelAnimDuration,{scale:new f(1,1,1)},{easing:"backOut"}).start(),p(i).to(this.itemPanelAnimDuration,{opacity:255}).start()}},r.closeItemPanel=function(){var t=this;if(this.currentItemPanel&&this.isItemPanelOpen){console.log("[Item] 关闭面板");var e=this.currentItemPanel;e.off(s.EventType.TOUCH_START,this.onItemPanelTouch,this),e.off(s.EventType.TOUCH_END,this.onItemPanelTouch,this);var i=e.getComponent(u);if(i||(i=e.addComponent(u)),p(e).to(.5*this.itemPanelAnimDuration,{scale:new f(.8,.8,1)},{easing:"backIn"}).call((function(){e.active=!1,e.setScale(1,1,1),i.opacity=255})).start(),p(i).to(.5*this.itemPanelAnimDuration,{opacity:0}).start(),this.itemMaskLayer){var n=this.itemMaskLayer.getComponent(u);n?p(n).to(.5*this.itemPanelAnimDuration,{opacity:0}).call((function(){t.itemMaskLayer.active=!1})).start():this.itemMaskLayer.active=!1}this.isItemPanelOpen=!1,this.currentItemPanel=null,this.resetHighlight(),this.currentInteractTarget=null,this.setTouchEnabled(!0)}},r.onItemPanelTouch=function(t){t.propagationStopped=!0},r.onDestroy=function(){var t;this.stopMoving(),this.stopFlip(),null==(t=this.touchArea)||t.off(s.EventType.TOUCH_END,this.onTouchEnd,this),this.clickIndicatorNode&&this.clickIndicatorNode.destroy(),this.itemMaskLayer&&(this.itemMaskLayer.off(s.EventType.TOUCH_START),this.itemMaskLayer.off(s.EventType.TOUCH_END)),this.currentItemPanel&&(this.currentItemPanel.off(s.EventType.TOUCH_START,this.onItemPanelTouch,this),this.currentItemPanel.off(s.EventType.TOUCH_END,this.onItemPanelTouch,this))},r.initCharacterInfo=function(){this.isFacingRight=this.character.scale.x>=0,this.characterInitialScale=new f(Math.abs(this.character.scale.x),Math.abs(this.character.scale.y),Math.abs(this.character.scale.z)),console.log("[Walk] 玩家朝向: "+(this.isFacingRight?"右":"左"))},r.initNpcs=function(){for(var t,e=a(this.npcs);!(t=e()).done;){var i=t.value;if(i.node){var n=i.node.scale.x>=0;if(this.npcFacingRight.set(i.node,n),this.npcInitialScales.set(i.node,new f(Math.abs(i.node.scale.x),Math.abs(i.node.scale.y),Math.abs(i.node.scale.z))),this.npcFlipping.set(i.node,!1),i.normalSprite){var o=i.node.getComponent(d);o&&(o.spriteFrame=i.normalSprite)}console.log('[Walk] NPC "'+i.name+'" 初始化完成，朝向: '+(n?"右":"左"))}}},r.initInteractables=function(){for(var t,e=a(this.interactables);!(t=e()).done;){var i=t.value;if(i.node){if(i.normalSprite){var n=i.node.getComponent(d);n&&(n.spriteFrame=i.normalSprite)}console.log('[Walk] 物体 "'+i.name+'" 初始化完成')}}},r.initClickIndicator=function(){this.clickIndicatorSprite&&(this.clickIndicatorNode=new s("ClickIndicator"),this.clickIndicatorNode.parent=this.touchArea,this.clickIndicatorNode.addComponent(g),this.clickIndicatorNode.addComponent(d).spriteFrame=this.clickIndicatorSprite,this.clickIndicatorNode.addComponent(u),this.clickIndicatorNode.active=!1)},r.drawDebugRect=function(){var t=this.node.getComponent(m);t||(t=this.node.addComponent(m)),t.clear(),t.strokeColor=new b(255,0,0,255),t.lineWidth=4,t.moveTo(this.leftBound,this.topBound),t.lineTo(this.rightBound,this.topBound),t.lineTo(this.rightBound,this.bottomBound),t.lineTo(this.leftBound,this.bottomBound),t.close(),t.stroke()},r.drawAllHitAreas=function(){for(var t,e=a(this.npcs);!(t=e()).done;){var i=t.value;i.node&&this.drawHitArea(i.node,i.hitWidth,i.hitHeight,i.hitOffsetX,i.hitOffsetY,new b(0,255,0,150))}for(var n,o=a(this.interactables);!(n=o()).done;){var r=n.value;r.node&&this.drawHitArea(r.node,r.hitWidth,r.hitHeight,r.hitOffsetX,r.hitOffsetY,new b(0,0,255,150))}},r.drawHitArea=function(t,e,i,n,a,o){var r=t.getChildByName("HitAreaDebug");r||((r=new s("HitAreaDebug")).parent=t,r.addComponent(g));var l=r.getComponent(m);l||(l=r.addComponent(m)),l.clear(),l.strokeColor=o,l.fillColor=new b(o.r,o.g,o.b,50),l.lineWidth=2;var c=e/2,h=i/2;l.rect(n-c,a-h,e,i),l.fill(),l.stroke()},r.onTouchEnd=function(t){if(this.touchEnabled){var e=this.touchArea.getComponent(g),i=t.getUILocation(),n=e.convertToNodeSpaceAR(new f(i.x,i.y,0)),a=this.getClickedNpc(n);if(a)this.onNpcClicked(a);else{var o=this.getClickedInteractable(n);if(o)this.onInteractableClicked(o);else{this.resetHighlight(),this.currentInteractTarget=null,this.showClickIndicator(n);var r=this.clampToRect(n);this.moveCharacterTo(r)}}}},r.getClickedNpc=function(t){for(var e,i=a(this.npcs);!(e=i()).done;){var n=e.value;if(n.node&&this.isPointInHitArea(t,n.node,n.hitWidth,n.hitHeight,n.hitOffsetX,n.hitOffsetY))return n}return null},r.getClickedInteractable=function(t){for(var e,i=a(this.interactables);!(e=i()).done;){var n=e.value;if(n.node&&this.isPointInHitArea(t,n.node,n.hitWidth,n.hitHeight,n.hitOffsetX,n.hitOffsetY))return n}return null},r.isPointInHitArea=function(t,e,i,n,a,o){var r=e.position,l=e.scale,c=i*Math.abs(l.x),s=n*Math.abs(l.y),h=a*l.x,u=o*Math.abs(l.y),p=r.x+h,f=r.y+u,d=p-c/2,g=p+c/2,m=f-s/2,b=f+s/2;return t.x>=d&&t.x<=g&&t.y>=m&&t.y<=b},r.onNpcClicked=function(t){var e=this;console.log('[NPC] 点击了 "'+t.name+'"'),this.resetHighlight(),this.setHighlight(t.node,t.highlightSprite),this.currentInteractTarget=t;var i=this.calculateDialoguePosition(t.node,t.dialogueDistance);this.moveCharacterTo(i,(function(){e.faceEachOther(t.node,(function(){e.triggerNpcDialogue(t)}))}))},r.calculateDialoguePosition=function(t,e){var i,n=t.position;i=this.character.position.x<n.x?n.x-e:n.x+e;var a=n.y;return this.clampToRect(new f(i,a,0))},r.faceEachOther=function(t,e){var i=this.character.position,n=t.position,a=i.x<n.x,o=!a,r=!1,l=!1,c=function(){r&&l&&(null==e||e())},s=this.character.scale.x>=0,h=t.scale.x>=0;s!==a?this.flipCharacter(a,(function(){r=!0,c()})):r=!0,h!==o?this.flipNpc(t,o,(function(){l=!0,c()})):l=!0,c()},r.triggerNpcDialogue=function(t){var e=this;if(console.log('[NPC] 触发 "'+t.name+'" 的对话'),!this.dialogueManager)return console.warn("[NPC] 未设置 DialogueManager"),void this.node.emit("npc-dialogue-start",t.node,t.name);this.setTouchEnabled(!1),this.dialogueManager.startDialogue(t.dialogueKey,(function(){e.onDialogueEnd()}))},r.onInteractableClicked=function(t){var e=this;if(console.log('[Item] 点击了 "'+t.name+'"'),this.resetHighlight(),this.setHighlight(t.node,t.highlightSprite),this.currentInteractTarget=t,t.interactDistance>0){var i=this.calculateDialoguePosition(t.node,t.interactDistance);this.moveCharacterTo(i,(function(){e.triggerInteraction(t)}))}else this.triggerInteraction(t)},r.triggerInteraction=function(t){var e=this;switch(console.log('[Item] 触发 "'+t.name+'"，类型: '+t.interactType+"，panelNode: "+!!t.panelNode),t.interactType){case me.Panel:t.panelNode?this.showItemPanel(t):(console.warn('[Item] "'+t.name+'" 未设置 panelNode'),this.onInteractionEnd(t));break;case me.Dialogue:this.dialogueManager&&t.dialogueKey?(this.setTouchEnabled(!1),this.dialogueManager.startDialogue(t.dialogueKey,(function(){e.onInteractionEnd(t)}))):this.onInteractionEnd(t);break;case me.Event:this.node.emit("item-interact",t.node,t.name),this.onInteractionEnd(t);break;case me.Pickup:if(this.node.emit("item-pickup",t.node,t.name),t.destroyAfterInteract){t.node.destroy();var i=this.interactables.indexOf(t);i>-1&&this.interactables.splice(i,1)}this.onInteractionEnd(t);break;default:console.warn("[Item] 未知交互类型: "+t.interactType),this.onInteractionEnd(t)}},r.onInteractionEnd=function(t){this.resetHighlight(),this.currentInteractTarget=null,this.setTouchEnabled(!0)},r.setHighlight=function(t,e){if(t&&e){var i=t.getComponent(d);i&&(i.spriteFrame=e),this.highlightedTarget=t}},r.resetHighlight=function(){if(this.highlightedTarget){for(var t,e=a(this.npcs);!(t=e()).done;){var i=t.value;if(i.node===this.highlightedTarget&&i.normalSprite){var n=i.node.getComponent(d);n&&(n.spriteFrame=i.normalSprite);break}}for(var o,r=a(this.interactables);!(o=r()).done;){var l=o.value;if(l.node===this.highlightedTarget&&l.normalSprite){var c=l.node.getComponent(d);c&&(c.spriteFrame=l.normalSprite);break}}this.highlightedTarget=null}},r.flipNpc=function(t,e,i){var n=this;if(t.scale.x>=0!==e){var a=this.npcFlipTweens.get(t);a&&a.stop(),this.npcFlipping.set(t,!0);var o=this.npcInitialScales.get(t);o||(o=new f(Math.abs(t.scale.x),Math.abs(t.scale.y),Math.abs(t.scale.z)),this.npcInitialScales.set(t,o));var r=t.position.y,l=this.getScaleMultiplier(r),c=o.x*l*(e?1:-1),s=o.y*l,h=this.npcFlipDuration/2,u=p(t).to(h,{scale:new f(0,s,1)},{easing:"sineIn"}).call((function(){n.npcFacingRight.set(t,e)})).to(h,{scale:new f(c,s,1)},{easing:"sineOut"}).call((function(){n.npcFlipping.set(t,!1),n.npcFlipTweens.delete(t),null==i||i()})).start();this.npcFlipTweens.set(t,u)}else null==i||i()},r.showClickIndicator=function(t){var e=this;if(this.clickIndicatorNode){this.clickIndicatorTween&&(this.clickIndicatorTween.stop(),this.clickIndicatorTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.clickIndicatorNode.setPosition(t),this.clickIndicatorNode.setScale(this.clickIndicatorScale,this.clickIndicatorScale,1);var i=this.clickIndicatorNode.getComponent(u);i.opacity=255,this.clickIndicatorNode.active=!0;var n=this.clickIndicatorDuration,a=1.5*this.clickIndicatorScale;this.clickIndicatorTween=p(this.clickIndicatorNode).to(n,{scale:new f(a,a,1)},{easing:"sineOut"}).call((function(){e.clickIndicatorNode.active=!1})).start(),this.opacityTween=p(i).to(n,{opacity:0},{easing:"sineIn"}).start()}},r.clampToRect=function(t){return new f(Math.max(this.leftBound,Math.min(this.rightBound,t.x)),Math.max(this.bottomBound,Math.min(this.topBound,t.y)),0)},r.getScaleMultiplier=function(t){if(this.topBound===this.bottomBound)return this.maxScaleMultiplier;var e=(t-this.bottomBound)/(this.topBound-this.bottomBound),i=Math.max(0,Math.min(1,e));return this.maxScaleMultiplier-i*(this.maxScaleMultiplier-this.minScaleMultiplier)},r.updateAllCharacters=function(){this.updateCharacterScale(),this.updateAllNpcScales(),this.updateZOrder()},r.updateCharacterScale=function(){if(this.isFacingRight=this.character.scale.x>=0,this.isFlipping){var t=this.character.position.y,e=this.getScaleMultiplier(t),i=this.characterInitialScale.y*e,n=this.character.scale.x;this.character.setScale(n,i,1)}else{var a=this.character.position.y,o=this.getScaleMultiplier(a),r=this.characterInitialScale.x*o*(this.isFacingRight?1:-1),l=this.characterInitialScale.y*o;this.character.setScale(r,l,1)}},r.updateAllNpcScales=function(){for(var t,e=a(this.npcs);!(t=e()).done;){var i=t.value;if(i.node&&!this.npcFlipping.get(i.node)){var n=this.npcInitialScales.get(i.node);if(n){var o=i.node.scale.x>=0;this.npcFacingRight.set(i.node,o);var r=i.node.position.y,l=this.getScaleMultiplier(r),c=n.x*l*(o?1:-1),s=n.y*l;i.node.setScale(c,s,1)}}}},r.updateZOrder=function(){var t=[];t.push({node:this.character,sortY:this.character.position.y});for(var e,i=a(this.npcs);!(e=i()).done;){var n=e.value;n.node&&t.push({node:n.node,sortY:n.node.position.y})}for(var o,r=a(this.interactables);!(o=r()).done;){var l=o.value;l.node&&t.push({node:l.node,sortY:l.node.position.y+l.zOrderOffsetY})}t.sort((function(t,e){return e.sortY-t.sortY})),t.forEach((function(t,e){t.node.setSiblingIndex(e)}))},r.flipCharacter=function(t,e){var i=this;if(this.character.scale.x>=0!==t){this.stopFlip(),this.isFlipping=!0;var n=this.character.position.y,a=this.getScaleMultiplier(n),o=this.characterInitialScale.x*a*(t?1:-1),r=this.characterInitialScale.y*a,l=this.flipDuration/2;this.flipTween=p(this.character).to(l,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){i.isFacingRight=t})).to(l,{scale:new f(o,r,1)},{easing:"sineOut"}).call((function(){i.isFlipping=!1,null==e||e()})).start()}else null==e||e()},r.stopFlip=function(){this.flipTween&&(this.flipTween.stop(),this.flipTween=null),this.isFlipping=!1},r.moveCharacterTo=function(t,e){var i=this;this.stopMovingKeepAnimation();var n=this.character.position,a=f.distance(n,t);if(a<1)return this.walkAnimation&&this.walkAnimation.stopWalk(),void(null==e||e());var o=a/this.moveSpeed,r=this.flipOnMove&&t.x!==n.x,l=t.x>n.x,c=function(){i.isMoving=!0,i.walkAnimation&&i.walkAnimation.startWalk(),i.currentTween=p(i.character).to(o,{position:t},{easing:"linear",onUpdate:function(){return i.updateAllCharacters()}}).call((function(){i.isMoving=!1,i.walkAnimation&&i.walkAnimation.stopWalk(),null==e||e()})).start()};r&&l!==this.isFacingRight?this.flipCharacter(l,c):c()},r.stopMovingKeepAnimation=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1},r.stopMoving=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1,this.walkAnimation&&this.walkAnimation.stopWalk()},r.setTouchEnabled=function(t){this.touchEnabled=t},r.onDialogueEnd=function(){console.log("[Scene2] 对话结束，重置状态"),this.resetHighlight(),this.currentInteractTarget=null,this.setTouchEnabled(!0)},r.getIsMoving=function(){return this.isMoving},r.getNpcByName=function(t){return this.npcs.find((function(e){return e.name===t}))||null},r.getInteractableByName=function(t){return this.interactables.find((function(e){return e.name===t}))||null},r.refreshAllScales=function(){this.updateAllCharacters()},e}(y)).prototype,"character",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jt=e(Zt.prototype,"touchArea",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jt=e(Zt.prototype,"npcs",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vt=e(Zt.prototype,"interactables",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qt=e(Zt.prototype,"clickIndicatorSprite",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qt=e(Zt.prototype,"clickIndicatorDuration",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$t=e(Zt.prototype,"clickIndicatorScale",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),te=e(Zt.prototype,"leftBound",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),ee=e(Zt.prototype,"rightBound",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),ie=e(Zt.prototype,"topBound",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ne=e(Zt.prototype,"bottomBound",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-300}}),ae=e(Zt.prototype,"minScaleMultiplier",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),oe=e(Zt.prototype,"maxScaleMultiplier",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),re=e(Zt.prototype,"moveSpeed",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),le=e(Zt.prototype,"flipOnMove",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ce=e(Zt.prototype,"flipDuration",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),se=e(Zt.prototype,"npcFlipDuration",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),he=e(Zt.prototype,"debugDraw",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ue=e(Zt.prototype,"debugDrawHitAreas",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pe=e(Zt.prototype,"dialogueManager",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=e(Zt.prototype,"walkAnimation",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=e(Zt.prototype,"itemMaskLayer",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=e(Zt.prototype,"itemPanelAnimDuration",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Kt=Zt))||Kt));r._RF.pop()}}}));

System.register("chunks:///_virtual/SceneManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,e,i,o,a,s,r,c,d,u,l,h,f;return{setters:[function(n){t=n.extends,e=n.createClass},function(n){i=n.cclegacy,o=n._decorator,a=n.UIOpacity,s=n.tween,r=n.director,c=n.Node,d=n.UITransform,u=n.view,l=n.Sprite,h=n.Color,f=n.game}],execute:function(){var g,N;i._RF.push({},"db79bgguDlMR5KodT3N+jyi","SceneManager",void 0);var S=o.ccclass,p=(o.property,n("TransitionType",function(n){return n.FADE_BLACK="fade_black",n.FADE_WHITE="fade_white",n.NONE="none",n}({}))),T=n("SceneManager",S("SceneManager")(((N=function(){function n(){this.defaultConfig={fadeInDuration:.5,fadeOutDuration:.5,transitionType:p.FADE_BLACK},this.isTransitioning=!1,this.transitionNode=null,this.currentSceneName=""}var i=n.prototype;return i.loadScene=function(n,e){if(this.isTransitioning)console.warn("[SceneManager] 正在切换场景中，请稍候");else{var i=t({},this.defaultConfig,e);console.log("[SceneManager] 切换场景: "+this.currentSceneName+" → "+n),this.isTransitioning=!0,null==i.onExit||i.onExit(),i.transitionType===p.NONE?this.doLoadScene(n,i):this.fadeOutAndLoad(n,i)}},i.loadSceneImmediate=function(n){this.loadScene(n,{transitionType:p.NONE})},i.getCurrentSceneName=function(){return this.currentSceneName},i.getIsTransitioning=function(){return this.isTransitioning},i.setDefaultConfig=function(n){this.defaultConfig=t({},this.defaultConfig,n)},i.onSceneEnter=function(n,e){var i=this;this.currentSceneName=n;var o=t({},this.defaultConfig,e);o.transitionType===p.NONE?(this.isTransitioning=!1,null==o.onEnter||o.onEnter()):this.fadeIn(o,(function(){i.isTransitioning=!1,null==o.onEnter||o.onEnter()}))},i.fadeOutAndLoad=function(n,t){var e=this;if(this.createTransitionNode(t.transitionType),this.transitionNode){var i=this.transitionNode.getComponent(a);i||(i=this.transitionNode.addComponent(a)),i.opacity=0,s(i).to(t.fadeOutDuration,{opacity:255},{easing:"sineIn"}).call((function(){e.doLoadScene(n,t)})).start()}else this.doLoadScene(n,t)},i.doLoadScene=function(n,t){var e=this;window.__sceneConfig=t,window.__targetSceneName=n,r.loadScene(n,(function(t){if(t)return console.error("[SceneManager] 加载场景失败: "+n,t),void(e.isTransitioning=!1)}))},i.fadeIn=function(n,t){var e=this;if(this.createTransitionNode(n.transitionType),this.transitionNode){var i=this.transitionNode.getComponent(a);i||(i=this.transitionNode.addComponent(a)),i.opacity=255,s(i).to(n.fadeInDuration,{opacity:0},{easing:"sineOut"}).call((function(){e.destroyTransitionNode(),null==t||t()})).start()}else null==t||t()},i.createTransitionNode=function(n){var t=r.getScene().getChildByName("Canvas");if(t){this.destroyTransitionNode(),this.transitionNode=new c("SceneTransition"),this.transitionNode.parent=t,this.transitionNode.setSiblingIndex(9999);var e=this.transitionNode.addComponent(d),i=u.getVisibleSize();e.setContentSize(2*i.width,2*i.height);var o=this.transitionNode.addComponent(l);switch(o.sizeMode=l.SizeMode.CUSTOM,n){case p.FADE_WHITE:o.color=new h(255,255,255,255);break;case p.FADE_BLACK:default:o.color=new h(0,0,0,255)}this.transitionNode.addComponent(a),f.addPersistRootNode(this.transitionNode)}else console.warn("[SceneManager] 未找到 Canvas")},i.destroyTransitionNode=function(){this.transitionNode&&this.transitionNode.isValid&&(f.removePersistRootNode(this.transitionNode),this.transitionNode.destroy(),this.transitionNode=null)},e(n,null,[{key:"instance",get:function(){return this._instance||(this._instance=new n),this._instance}}]),n}())._instance=null,g=N))||g);n("sceneManager",T.instance);i._RF.pop()}}}));

System.register("chunks:///_virtual/StartSceneController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,i,e,a,o,r,l,u,s,c,p,b,f;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,l=t.Node,u=t.SpriteFrame,s=t.Sprite,c=t.UIOpacity,p=t.tween,b=t.director,f=t.Component}],execute:function(){var g,h,d,y,S,m,k,T,B,D,C,v,O,w,z,F,N,I,M,E,_,U,q,H,P,A,L,R,j,x,G,Q,X;o._RF.push({},"37f86XY1CdPc7AI/iaQNB72","StartSceneController",void 0);var Y=r.ccclass,J=r.property;t("StartSceneController",(g=Y("StartSceneController"),h=J(l),d=J(l),y=J(l),S=J(l),m=J(l),k=J(u),T=J(u),B=J({tooltip:"标题淡入延迟（秒）"}),D=J({tooltip:"标题淡入时长（秒）"}),C=J({tooltip:"开始按钮淡入延迟（秒）"}),v=J({tooltip:"开始按钮淡入时长（秒）"}),O=J({tooltip:"背景切换时长（秒）"}),w=J({tooltip:"黑屏淡入时长（秒）"}),z=J({tooltip:"切换场景前等待时间（秒）"}),F=J({tooltip:"目标场景名称"}),g((M=n((I=function(t){function n(){for(var n,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return n=t.call.apply(t,[this].concat(o))||this,e(n,"background",M,a(n)),e(n,"title",E,a(n)),e(n,"startButton",_,a(n)),e(n,"bgTransitionNode",U,a(n)),e(n,"blackMask",q,a(n)),e(n,"bgStart",H,a(n)),e(n,"bgTransition",P,a(n)),e(n,"titleDelay",A,a(n)),e(n,"titleFadeDuration",L,a(n)),e(n,"startButtonDelay",R,a(n)),e(n,"startButtonFadeDuration",j,a(n)),e(n,"bgTransitionDuration",x,a(n)),e(n,"blackFadeDuration",G,a(n)),e(n,"sceneChangeDelay",Q,a(n)),e(n,"targetSceneName",X,a(n)),n.isTransitioning=!1,n}i(n,t);var o=n.prototype;return o.start=function(){this.initUI(),this.playOpeningSequence()},o.initUI=function(){if(this.background&&this.bgStart){var t=this.background.getComponent(s);t&&(t.spriteFrame=this.bgStart)}if(this.title&&this.setOpacity(this.title,0),this.startButton&&this.setOpacity(this.startButton,0),this.bgTransitionNode&&(this.setOpacity(this.bgTransitionNode,0),this.bgTransition)){var n=this.bgTransitionNode.getComponent(s);n&&(n.spriteFrame=this.bgTransition)}this.blackMask&&(this.setOpacity(this.blackMask,0),this.blackMask.active=!1)},o.playOpeningSequence=function(){var t=this;this.scheduleOnce((function(){t.fadeIn(t.title,t.titleFadeDuration,(function(){console.log("[Start] 标题显示完成")}))}),this.titleDelay),this.scheduleOnce((function(){t.fadeIn(t.startButton,t.startButtonFadeDuration,(function(){console.log("[Start] 开始按钮显示完成"),t.bindStartButtonEvent()}))}),this.startButtonDelay)},o.bindStartButtonEvent=function(){this.startButton&&this.startButton.on(l.EventType.TOUCH_END,this.onStartButtonClick,this)},o.onStartButtonClick=function(){this.isTransitioning||(this.isTransitioning=!0,console.log("[Start] 点击开始游戏"),this.startButton.off(l.EventType.TOUCH_END,this.onStartButtonClick,this),this.playTransitionSequence())},o.playTransitionSequence=function(){var t=this;this.fadeOut(this.title,.5),this.fadeOut(this.startButton,.5),this.crossFadeBackground((function(){t.fadeToBlack((function(){t.scheduleOnce((function(){t.loadTargetScene()}),t.sceneChangeDelay)}))}))},o.crossFadeBackground=function(t){if(this.bgTransitionNode)this.fadeIn(this.bgTransitionNode,this.bgTransitionDuration,(function(){console.log("[Start] 背景切换完成"),null==t||t()}));else{if(this.background&&this.bgTransition){var n=this.background.getComponent(s);n&&(n.spriteFrame=this.bgTransition)}null==t||t()}},o.fadeToBlack=function(t){if(this.blackMask){this.blackMask.active=!0;var n=this.blackMask.getComponent(c);n||(n=this.blackMask.addComponent(c)),n.opacity=0,p(n).to(this.blackFadeDuration,{opacity:255},{easing:"sineIn"}).call((function(){console.log("[Start] 黑屏完成"),null==t||t()})).start()}else null==t||t()},o.loadTargetScene=function(){console.log("[Start] 切换到场景: "+this.targetSceneName),b.loadScene(this.targetSceneName)},o.setOpacity=function(t,n){if(t){var i=t.getComponent(c);i||(i=t.addComponent(c)),i.opacity=n}},o.fadeIn=function(t,n,i){if(t){var e=t.getComponent(c);e||(e=t.addComponent(c)),e.opacity=0,p(e).to(n,{opacity:255},{easing:"sineOut"}).call((function(){null==i||i()})).start()}else null==i||i()},o.fadeOut=function(t,n,i){if(t){var e=t.getComponent(c);e||((e=t.addComponent(c)).opacity=255),p(e).to(n,{opacity:0},{easing:"sineIn"}).call((function(){null==i||i()})).start()}else null==i||i()},n}(f)).prototype,"background",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(I.prototype,"title",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(I.prototype,"startButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=n(I.prototype,"bgTransitionNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=n(I.prototype,"blackMask",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=n(I.prototype,"bgStart",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=n(I.prototype,"bgTransition",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(I.prototype,"titleDelay",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),L=n(I.prototype,"titleFadeDuration",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),R=n(I.prototype,"startButtonDelay",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),j=n(I.prototype,"startButtonFadeDuration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),x=n(I.prototype,"bgTransitionDuration",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),G=n(I.prototype,"blackFadeDuration",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Q=n(I.prototype,"sceneChangeDelay",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),X=n(I.prototype,"targetSceneName",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"OrderGameScene"}}),N=I))||N));o._RF.pop()}}}));

System.register("chunks:///_virtual/StreetWalkController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DialogueManager.ts","./WalkAnimationController.ts"],(function(i){var t,e,n,a,c,r,o,l,s,h,p,u,g,f,d,b,m,N;return{setters:[function(i){t=i.applyDecoratedDescriptor,e=i.inheritsLoose,n=i.initializerDefineProperty,a=i.assertThisInitialized},function(i){c=i.cclegacy,r=i._decorator,o=i.Node,l=i.SpriteFrame,s=i.UITransform,h=i.Sprite,p=i.UIOpacity,u=i.Graphics,g=i.Color,f=i.Vec3,d=i.tween,b=i.Component},function(i){m=i.DialogueManager},function(i){N=i.WalkAnimationController}],execute:function(){var w,S,I,y,C,v,k,H,T,A,F,M,D,x,z,B,P,R,O,G,W,E,U,_,X,Y,L,Z,j,K,V,q,J,Q,$,ii,ti,ei,ni,ai,ci,ri,oi,li,si,hi,pi,ui,gi,fi,di,bi,mi,Ni,wi,Si,Ii;c._RF.push({},"2ae864vzZBC273s6gaj29ll","StreetWalkController",void 0);var yi=r.ccclass,Ci=r.property;i("StreetWalkController",(w=yi("StreetWalkController"),S=Ci(o),I=Ci(o),y=Ci(o),C=Ci({type:l,tooltip:"NPC 默认图像"}),v=Ci({type:l,tooltip:"NPC 高亮图像"}),k=Ci({tooltip:"NPC 碰撞范围宽度"}),H=Ci({tooltip:"NPC 碰撞范围高度"}),T=Ci({tooltip:"NPC 碰撞范围 X 偏移"}),A=Ci({tooltip:"NPC 碰撞范围 Y 偏移"}),F=Ci({tooltip:"对话距离（玩家与NPC的间隔）"}),M=Ci({tooltip:"是否绘制 NPC 碰撞范围（调试用）"}),D=Ci({type:l,tooltip:"点击反馈圆圈图片"}),x=Ci({tooltip:"圆圈显示时长（秒）"}),z=Ci({tooltip:"圆圈初始大小"}),B=Ci({tooltip:"左边界"}),P=Ci({tooltip:"右边界"}),R=Ci({tooltip:"上边界（远处）"}),O=Ci({tooltip:"下边界（近处）"}),G=Ci({tooltip:"最远处（top）的缩放乘数"}),W=Ci({tooltip:"最近处（bottom）的缩放乘数"}),E=Ci({tooltip:"移动速度（像素/秒）"}),U=Ci({tooltip:"是否根据移动方向翻转角色"}),_=Ci({tooltip:"翻转动画时长（秒）"}),X=Ci({tooltip:"NPC 翻转动画时长（秒）"}),Y=Ci({tooltip:"是否绘制可行走区域边框"}),L=Ci(m),Z=Ci(N),w((V=t((K=function(i){function t(){for(var t,e=arguments.length,c=new Array(e),r=0;r<e;r++)c[r]=arguments[r];return t=i.call.apply(i,[this].concat(c))||this,n(t,"character",V,a(t)),n(t,"npc",q,a(t)),n(t,"touchArea",J,a(t)),n(t,"npcNormalSprite",Q,a(t)),n(t,"npcHighlightSprite",$,a(t)),n(t,"npcHitWidth",ii,a(t)),n(t,"npcHitHeight",ti,a(t)),n(t,"npcHitOffsetX",ei,a(t)),n(t,"npcHitOffsetY",ni,a(t)),n(t,"dialogueDistance",ai,a(t)),n(t,"debugDrawNpcHitArea",ci,a(t)),n(t,"clickIndicatorSprite",ri,a(t)),n(t,"clickIndicatorDuration",oi,a(t)),n(t,"clickIndicatorScale",li,a(t)),n(t,"leftBound",si,a(t)),n(t,"rightBound",hi,a(t)),n(t,"topBound",pi,a(t)),n(t,"bottomBound",ui,a(t)),n(t,"minScaleMultiplier",gi,a(t)),n(t,"maxScaleMultiplier",fi,a(t)),n(t,"moveSpeed",di,a(t)),n(t,"flipOnMove",bi,a(t)),n(t,"flipDuration",mi,a(t)),n(t,"npcFlipDuration",Ni,a(t)),n(t,"debugDraw",wi,a(t)),n(t,"dialogueManager",Si,a(t)),n(t,"walkAnimation",Ii,a(t)),t.currentTween=null,t.flipTween=null,t.npcFlipTween=null,t.isMoving=!1,t.isFlipping=!1,t.isNpcFlipping=!1,t.isFacingRight=!0,t.isNpcFacingRight=!1,t.characterInitialScale=new f(1,1,1),t.npcInitialScale=new f(1,1,1),t.clickIndicatorNode=null,t.clickIndicatorTween=null,t.opacityTween=null,t.npcHitAreaGraphics=null,t.isNpcHighlighted=!1,t.isGoingToNpc=!1,t.touchEnabled=!0,t}e(t,i);var c=t.prototype;return c.start=function(){this.initCharactersInfo(),this.initClickIndicator(),this.initNpcSprite(),this.updateAllCharacters(),this.touchArea.on(o.EventType.TOUCH_END,this.onTouchEnd,this),this.debugDraw&&this.drawDebugRect(),this.debugDrawNpcHitArea&&this.drawNpcHitArea()},c.onDestroy=function(){var i;this.stopMoving(),this.stopFlip(),this.stopNpcFlip(),null==(i=this.touchArea)||i.off(o.EventType.TOUCH_END,this.onTouchEnd,this),this.clickIndicatorNode&&this.clickIndicatorNode.destroy()},c.initCharactersInfo=function(){this.characterInitialScale=this.character.scale.clone(),this.isFacingRight=this.characterInitialScale.x>=0,this.characterInitialScale.x=Math.abs(this.characterInitialScale.x),this.characterInitialScale.y=Math.abs(this.characterInitialScale.y),this.characterInitialScale.z=Math.abs(this.characterInitialScale.z),this.npc&&(this.npcInitialScale=this.npc.scale.clone(),this.isNpcFacingRight=this.npcInitialScale.x>=0,this.npcInitialScale.x=Math.abs(this.npcInitialScale.x),this.npcInitialScale.y=Math.abs(this.npcInitialScale.y),this.npcInitialScale.z=Math.abs(this.npcInitialScale.z)),console.log("[Walk] 玩家朝向: "+(this.isFacingRight?"右":"左")),console.log("[Walk] NPC朝向: "+(this.isNpcFacingRight?"右":"左"))},c.initClickIndicator=function(){this.clickIndicatorSprite&&(this.clickIndicatorNode=new o("ClickIndicator"),this.clickIndicatorNode.parent=this.touchArea,this.clickIndicatorNode.addComponent(s),this.clickIndicatorNode.addComponent(h).spriteFrame=this.clickIndicatorSprite,this.clickIndicatorNode.addComponent(p),this.clickIndicatorNode.active=!1)},c.initNpcSprite=function(){if(this.npc&&this.npcNormalSprite){var i=this.npc.getComponent(h);i&&(i.spriteFrame=this.npcNormalSprite)}},c.drawDebugRect=function(){var i=this.node.getComponent(u);i||(i=this.node.addComponent(u)),i.clear(),i.strokeColor=new g(255,0,0,255),i.lineWidth=4,i.moveTo(this.leftBound,this.topBound),i.lineTo(this.rightBound,this.topBound),i.lineTo(this.rightBound,this.bottomBound),i.lineTo(this.leftBound,this.bottomBound),i.close(),i.stroke()},c.drawNpcHitArea=function(){if(this.npc){var i=this.npc.getChildByName("HitAreaDebug");i||((i=new o("HitAreaDebug")).parent=this.npc,i.addComponent(s)),this.npcHitAreaGraphics=i.getComponent(u),this.npcHitAreaGraphics||(this.npcHitAreaGraphics=i.addComponent(u)),this.updateNpcHitAreaDebug()}},c.updateNpcHitAreaDebug=function(){if(this.npcHitAreaGraphics){this.npcHitAreaGraphics.clear(),this.npcHitAreaGraphics.strokeColor=new g(0,255,0,200),this.npcHitAreaGraphics.fillColor=new g(0,255,0,50),this.npcHitAreaGraphics.lineWidth=2;var i=this.npcHitWidth/2,t=this.npcHitHeight/2,e=this.npcHitOffsetX,n=this.npcHitOffsetY;this.npcHitAreaGraphics.rect(e-i,n-t,this.npcHitWidth,this.npcHitHeight),this.npcHitAreaGraphics.fill(),this.npcHitAreaGraphics.stroke()}},c.setTouchEnabled=function(i){this.touchEnabled=i},c.onTouchEnd=function(i){if(this.touchEnabled){var t=this.touchArea.getComponent(s),e=i.getUILocation(),n=t.convertToNodeSpaceAR(new f(e.x,e.y,0));if(this.isPointInNpcHitArea(n))this.onNpcClicked();else{this.resetNpcHighlight(),this.isGoingToNpc=!1,this.showClickIndicator(n);var a=this.clampToRect(n);this.moveCharacterTo(a)}}},c.isPointInNpcHitArea=function(i){if(!this.npc)return!1;var t=this.npc.position,e=this.npc.scale,n=this.npcHitWidth*Math.abs(e.x),a=this.npcHitHeight*Math.abs(e.y),c=this.npcHitOffsetX*e.x,r=this.npcHitOffsetY*Math.abs(e.y),o=t.x+c,l=t.y+r,s=o-n/2,h=o+n/2,p=l-a/2,u=l+a/2;return i.x>=s&&i.x<=h&&i.y>=p&&i.y<=u},c.onNpcClicked=function(){var i=this;console.log("[NPC] NPC 被点击"),this.setNpcHighlight(!0),this.isGoingToNpc=!0;var t=this.calculateDialoguePosition();this.moveCharacterTo(t,(function(){i.faceEachOther((function(){i.triggerNpcDialogue()}))}))},c.calculateDialoguePosition=function(){var i,t=this.npc.position;i=this.character.position.x<t.x?t.x-this.dialogueDistance:t.x+this.dialogueDistance;var e=t.y+25;return this.clampToRect(new f(i,e,0))},c.faceEachOther=function(i){var t=this.character.position,e=this.npc.position,n=t.x<e.x,a=n,c=!1,r=!1,o=function(){c&&r&&(null==i||i())};this.isFacingRight!==n?this.flipCharacter(n,(function(){c=!0,o()})):c=!0,this.isNpcFacingRight!==a?this.flipNpc(a,(function(){r=!0,o()})):r=!0,o()},c.setNpcHighlight=function(i){if(this.npc){this.isNpcHighlighted=i;var t=this.npc.getComponent(h);t&&(i&&this.npcHighlightSprite?(t.spriteFrame=this.npcHighlightSprite,console.log("[NPC] 高亮开启")):!i&&this.npcNormalSprite&&(t.spriteFrame=this.npcNormalSprite,console.log("[NPC] 高亮关闭")))}},c.resetNpcHighlight=function(){this.isNpcHighlighted&&this.setNpcHighlight(!1)},c.triggerNpcDialogue=function(){var i=this;if(console.log("[NPC] 触发对话"),!this.dialogueManager)return console.warn("[NPC] 未设置 DialogueManager"),void this.node.emit("npc-dialogue-start",this.npc);this.setTouchEnabled(!1),this.dialogueManager.startDialogue("main",(function(){i.onDialogueEnd()}))},c.flipNpc=function(i,t){var e=this;if(this.npc)if(i!==this.isNpcFacingRight){this.stopNpcFlip(),this.isNpcFlipping=!0;var n=this.npc.position.y,a=this.getScaleMultiplier(n),c=this.npcInitialScale.x*a*(i?1:-1),r=this.npcInitialScale.y*a,o=this.npcFlipDuration/2;this.npcFlipTween=d(this.npc).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isNpcFacingRight=i})).to(o,{scale:new f(c,r,1)},{easing:"sineOut"}).call((function(){e.isNpcFlipping=!1,null==t||t()})).start()}else null==t||t();else null==t||t()},c.stopNpcFlip=function(){this.npcFlipTween&&(this.npcFlipTween.stop(),this.npcFlipTween=null),this.isNpcFlipping=!1},c.showClickIndicator=function(i){var t=this;if(this.clickIndicatorNode){this.clickIndicatorTween&&(this.clickIndicatorTween.stop(),this.clickIndicatorTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.clickIndicatorNode.setPosition(i),this.clickIndicatorNode.setScale(this.clickIndicatorScale,this.clickIndicatorScale,1);var e=this.clickIndicatorNode.getComponent(p);e.opacity=255,this.clickIndicatorNode.active=!0;var n=this.clickIndicatorDuration,a=1.5*this.clickIndicatorScale;this.clickIndicatorTween=d(this.clickIndicatorNode).to(n,{scale:new f(a,a,1)},{easing:"sineOut"}).call((function(){t.clickIndicatorNode.active=!1})).start(),this.opacityTween=d(e).to(n,{opacity:0},{easing:"sineIn"}).start()}},c.clampToRect=function(i){return new f(Math.max(this.leftBound,Math.min(this.rightBound,i.x)),Math.max(this.bottomBound,Math.min(this.topBound,i.y)),0)},c.getScaleMultiplier=function(i){if(this.topBound===this.bottomBound)return this.maxScaleMultiplier;var t=(i-this.bottomBound)/(this.topBound-this.bottomBound),e=Math.max(0,Math.min(1,t));return this.maxScaleMultiplier-e*(this.maxScaleMultiplier-this.minScaleMultiplier)},c.updateAllCharacters=function(){this.updateCharacterScale(),this.updateNpcScale(),this.updateCharactersZOrder()},c.updateCharacterScale=function(){if(this.isFlipping){var i=this.character.position.y,t=this.getScaleMultiplier(i),e=this.characterInitialScale.y*t,n=this.character.scale.x;this.character.setScale(n,e,1)}else{var a=this.character.position.y,c=this.getScaleMultiplier(a),r=this.characterInitialScale.x*c*(this.isFacingRight?1:-1),o=this.characterInitialScale.y*c;this.character.setScale(r,o,1)}},c.updateNpcScale=function(){if(this.npc&&!this.isNpcFlipping){var i=this.npc.position.y,t=this.getScaleMultiplier(i),e=this.npcInitialScale.x*t*(this.isNpcFacingRight?1:-1),n=this.npcInitialScale.y*t;this.npc.setScale(e,n,1)}},c.updateCharactersZOrder=function(){this.npc&&(this.character.position.y<this.npc.position.y+28?this.ensureOrder(this.npc,this.character):this.ensureOrder(this.character,this.npc))},c.ensureOrder=function(i,t){var e=i.parent;if(e&&t.parent===e){var n=i.getSiblingIndex();n>t.getSiblingIndex()&&t.setSiblingIndex(n)}},c.flipCharacter=function(i,t){var e=this;if(i!==this.isFacingRight){this.stopFlip(),this.isFlipping=!0;var n=this.character.position.y,a=this.getScaleMultiplier(n),c=this.characterInitialScale.x*a*(i?1:-1),r=this.characterInitialScale.y*a,o=this.flipDuration/2;this.flipTween=d(this.character).to(o,{scale:new f(0,r,1)},{easing:"sineIn"}).call((function(){e.isFacingRight=i})).to(o,{scale:new f(c,r,1)},{easing:"sineOut"}).call((function(){e.isFlipping=!1,null==t||t()})).start()}else null==t||t()},c.stopFlip=function(){this.flipTween&&(this.flipTween.stop(),this.flipTween=null),this.isFlipping=!1},c.moveCharacterTo=function(i,t){var e=this;this.stopMovingKeepAnimation();var n=this.character.position,a=f.distance(n,i);if(a<1)return this.walkAnimation&&this.walkAnimation.stopWalk(),void(null==t||t());var c=a/this.moveSpeed,r=this.flipOnMove&&i.x!==n.x,o=i.x>n.x,l=function(){e.isMoving=!0,e.walkAnimation&&e.walkAnimation.startWalk(),e.currentTween=d(e.character).to(c,{position:i},{easing:"linear",onUpdate:function(){return e.updateAllCharacters()}}).call((function(){e.isMoving=!1,e.walkAnimation&&e.walkAnimation.stopWalk(),null==t||t()})).start()};r&&o!==this.isFacingRight?this.flipCharacter(o,l):l()},c.stopMovingKeepAnimation=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1},c.stopMoving=function(){this.currentTween&&(this.currentTween.stop(),this.currentTween=null),this.isMoving=!1,this.walkAnimation&&this.walkAnimation.stopWalk()},c.getIsMoving=function(){return this.isMoving},c.setCharacterPosition=function(i){var t=this.clampToRect(i);this.character.setPosition(t),this.updateAllCharacters()},c.setNpcPosition=function(i){if(this.npc){var t=this.clampToRect(i);this.npc.setPosition(t),this.updateAllCharacters()}},c.setFacingDirection=function(i){this.flipCharacter(i)},c.setFacingDirectionImmediate=function(i){this.isFacingRight=i,this.updateCharacterScale()},c.setNpcFacingDirection=function(i){this.flipNpc(i)},c.setNpcFacingDirectionImmediate=function(i){this.isNpcFacingRight=i,this.updateNpcScale()},c.refreshAllCharacters=function(){this.updateAllCharacters()},c.getIsNpcHighlighted=function(){return this.isNpcHighlighted},c.getIsGoingToNpc=function(){return this.isGoingToNpc},c.onDialogueEnd=function(){console.log("[NPC] 对话结束，重置状态"),this.resetNpcHighlight(),this.isGoingToNpc=!1,this.setTouchEnabled(!0)},t}(b)).prototype,"character",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(K.prototype,"npc",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(K.prototype,"touchArea",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=t(K.prototype,"npcNormalSprite",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(K.prototype,"npcHighlightSprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=t(K.prototype,"npcHitWidth",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ti=t(K.prototype,"npcHitHeight",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),ei=t(K.prototype,"npcHitOffsetX",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ni=t(K.prototype,"npcHitOffsetY",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ai=t(K.prototype,"dialogueDistance",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),ci=t(K.prototype,"debugDrawNpcHitArea",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ri=t(K.prototype,"clickIndicatorSprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=t(K.prototype,"clickIndicatorDuration",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),li=t(K.prototype,"clickIndicatorScale",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),si=t(K.prototype,"leftBound",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),hi=t(K.prototype,"rightBound",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),pi=t(K.prototype,"topBound",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ui=t(K.prototype,"bottomBound",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-300}}),gi=t(K.prototype,"minScaleMultiplier",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),fi=t(K.prototype,"maxScaleMultiplier",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),di=t(K.prototype,"moveSpeed",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),bi=t(K.prototype,"flipOnMove",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mi=t(K.prototype,"flipDuration",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Ni=t(K.prototype,"npcFlipDuration",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),wi=t(K.prototype,"debugDraw",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Si=t(K.prototype,"dialogueManager",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ii=t(K.prototype,"walkAnimation",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=K))||j));c._RF.pop()}}}));

System.register("chunks:///_virtual/WalkAnimationController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,a,n,l,s,o,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,s=e.Sprite,o=e.SpriteFrame,m=e.Component}],execute:function(){var u,h,c,p,F,k,f,w,g,d,b,W,y,x,I,D,C;n._RF.push({},"c3339T38jNCeLCcoWDbueEs","WalkAnimationController",void 0);var v=l.ccclass,S=l.property;e("WalkAnimationController",(u=v("WalkAnimationController"),h=S(s),c=S({type:o,tooltip:"站立（默认姿势）"}),p=S({type:o,tooltip:"左脚向前迈"}),F=S({type:o,tooltip:"并步1"}),k=S({type:o,tooltip:"右脚向前迈"}),f=S({type:o,tooltip:"并步2"}),w=S({tooltip:"每帧持续时间（秒）"}),u((b=t((d=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,i(t,"characterSprite",b,a(t)),i(t,"idleFrame",W,a(t)),i(t,"walkFrame1",y,a(t)),i(t,"walkFrame2",x,a(t)),i(t,"walkFrame3",I,a(t)),i(t,"walkFrame4",D,a(t)),i(t,"frameDuration",C,a(t)),t.walkFrames=[],t.currentFrameIndex=0,t.isWalking=!1,t.frameTimer=0,t}r(t,e);var n=t.prototype;return n.start=function(){this.initWalkFrames(),this.showIdle()},n.update=function(e){this.isWalking&&(this.frameTimer+=e,this.frameTimer>=this.frameDuration&&(this.frameTimer=0,this.nextFrame()))},n.initWalkFrames=function(){this.walkFrames=[],this.walkFrame1&&this.walkFrames.push(this.walkFrame1),this.walkFrame2&&this.walkFrames.push(this.walkFrame2),this.walkFrame3&&this.walkFrames.push(this.walkFrame3),this.walkFrame4&&this.walkFrames.push(this.walkFrame4),console.log("[WalkAnim] 初始化完成，共 "+this.walkFrames.length+" 帧")},n.showIdle=function(){this.isWalking=!1,this.frameTimer=0,this.currentFrameIndex=0,this.characterSprite&&this.idleFrame&&(this.characterSprite.spriteFrame=this.idleFrame)},n.startWalk=function(){this.isWalking||0!==this.walkFrames.length&&(this.isWalking=!0,this.frameTimer=0,this.currentFrameIndex=0,this.showCurrentFrame(),console.log("[WalkAnim] 开始步行动画"))},n.continueWalk=function(){0!==this.walkFrames.length&&(this.isWalking||(this.isWalking=!0,this.frameTimer=0,this.showCurrentFrame()))},n.stopWalk=function(){this.isWalking&&(this.showIdle(),console.log("[WalkAnim] 停止步行动画"))},n.nextFrame=function(){this.currentFrameIndex++,this.currentFrameIndex>=this.walkFrames.length&&(this.currentFrameIndex=0),this.showCurrentFrame()},n.showCurrentFrame=function(){this.characterSprite&&this.walkFrames[this.currentFrameIndex]&&(this.characterSprite.spriteFrame=this.walkFrames[this.currentFrameIndex])},n.getIsWalking=function(){return this.isWalking},n.setFrameDuration=function(e){this.frameDuration=Math.max(.05,e)},n.adjustSpeedByMovement=function(e,t){void 0===t&&(t=250);var r=e/t;this.frameDuration=.15/r,this.frameDuration=Math.max(.08,Math.min(.25,this.frameDuration))},t}(m)).prototype,"characterSprite",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(d.prototype,"idleFrame",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(d.prototype,"walkFrame1",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(d.prototype,"walkFrame2",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=t(d.prototype,"walkFrame3",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(d.prototype,"walkFrame4",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(d.prototype,"frameDuration",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),g=d))||g));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});